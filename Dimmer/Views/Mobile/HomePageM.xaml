<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Dimmer_MAUI.Views.Mobile.HomePageM"
            
            xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
            xmlns:converters="clr-namespace:Dimmer_MAUI.Utilities.TypeConverters" 
            xmlns:vm="clr-namespace:Dimmer_MAUI.ViewModels"
            xmlns:models="clr-namespace:Dimmer_MAUI.Utilities.Models"
            xmlns:viewsM="clr-namespace:Dimmer_MAUI.Views.Mobile"  
            xmlns:cv="clr-namespace:Dimmer_MAUI.Views.Mobile.CustomViewsM"
            x:DataType="vm:HomePageVM"
            xmlns:dx="http://schemas.devexpress.com/maui"
            x:Name="myPage" 
            Shell.FlyoutItemIsVisible="True"
            Shell.TabBarIsVisible="True"
             xmlns:contextPopUp="clr-namespace:Dimmer_MAUI.CustomPopUpViews"
            Shell.NavBarIsVisible="False">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style TargetType="Label">
                <Setter Property="TextColor" Value="{AppThemeBinding Dark=White, Light=White}"/>
            </Style>
            <converters:DurationConverterFromMsToTimeSpan x:Key="DurationConverter"/>
            <converters:BytesToMegabytesConverter x:Key="FileSizeConverter"/>
            <converters:BytesArrayToImageSource x:Key="BytesToImageConverter"/>
            
            <converters:BoolToInverseConverter x:Key="BoolToInverse"/>
    
        </ResourceDictionary>
 

    </ContentPage.Resources>

    <Grid x:Name="MainPage" Margin="5,0">
        
        <Grid BackgroundColor="#1E1E1E" x:Name="MainDock"
          Margin="5,5" RowDefinitions="*,auto">


            <dx:DXDockLayout IsVisible="True" StretchLastItem="False" x:Name="NormalNowPlayingUI"
                             Loaded="NormalNowPlayingUI_Loaded" Grid.Row="0"
                             Unloaded="NormalNowPlayingUI_Unloaded">
            <dx:TabView IsSelectedItemIndicatorVisible="False" SwipeEnabled="True"
                        x:Name="HomeTabView">
                <dx:TabViewItem>                    
                    <dx:DXCollectionView SelectionMode="Single"
    dx:DXDockLayout.Dock ="Top"
    Orientation="Vertical" 
    x:Name="SongsColView" 
    ItemsSource="{Binding DisplayedSongs}"
    Tap="SongsColView_Tap" 
    ItemSpacing="8"
    >
                        <dx:DXCollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:SongModelView">
                                <Grid ColumnDefinitions="*, 120" 
                  ColumnSpacing="10">
                                    <dx:DXStackLayout Grid.Column="0" Orientation="Horizontal"
                                  ItemSpacing="5">
                                        <dx:DXImage Source="{Binding CoverImagePath}"
                                WidthRequest="60"/>
                                        <dx:DXStackLayout >
                                            <Label Text="{Binding Title}" 
                               FontSize="19" />
                                            <Label Text="{Binding ArtistName}" 
                               FontSize="14" FontAttributes="Italic"/>
                                            <Label Text="{Binding AlbumName}" 
                               FontSize="10" FontAttributes="Italic"/>
                                        </dx:DXStackLayout>
                                    </dx:DXStackLayout>
                                    <dx:DXButton Grid.Column="1" BackgroundColor="Transparent"
                         HorizontalOptions="End" Clicked="ShowMoreBtn_Clicked"
                         PressedBackgroundColor="DarkSlateBlue"
                         AnimationDuration="1000" HorizontalContentAlignment="End">
                                        <dx:DXButton.Content>
                                            <dx:DXStackLayout Orientation="Horizontal" 
                                      HorizontalOptions="Start">
                                                <dx:DXStackLayout Orientation="Vertical" 
                                              Grid.Column="0"
                                              VerticalOptions="Center">
                                                    <Label 
                                    Text="{Binding DurationInSeconds, Converter={StaticResource DurationConverter}}" 
                                FontSize="16"/>

                                                </dx:DXStackLayout>

                                                <dx:DXImage Source="more1.png" 
                                         WidthRequest="40" HeightRequest="40" 
                                         x:Name="ShowMoreBtn" 
                                         Rotation="90"/>

                                            </dx:DXStackLayout>
                                        </dx:DXButton.Content>
                                    </dx:DXButton>


                                </Grid>
                            </DataTemplate>
                        </dx:DXCollectionView.ItemTemplate>

                    </dx:DXCollectionView>
                </dx:TabViewItem>
                <dx:TabViewItem x:Name="NowPlayingView">
                    <dx:DXScrollView Orientation="Vertical">
                        <dx:DXStackLayout Orientation="Vertical">
                            
                            <dx:DXImage Source="{Binding TemporarilyPickedSong.CoverImagePath}"
                                        Aspect="AspectFit"/>
                            
                            
                        </dx:DXStackLayout>
                    </dx:DXScrollView>
                </dx:TabViewItem>

                    <dx:TabViewItem x:Name="UpSertPlayListView">
                        <dx:DXStackLayout Orientation="Vertical">
                            
                        </dx:DXStackLayout>            
                    </dx:TabViewItem>            
            </dx:TabView>

            </dx:DXDockLayout>

        <dx:DXButton  Grid.Row="1" HeightRequest="80"
                      CornerRadius="15" 
                      BackgroundColor="#1E1E1E"
                      HorizontalContentAlignment="Fill"
                      
                      x:Name="BtmBar" Tap="BtmBar_Tap">
            <dx:DXButton.GestureRecognizers>
                <PanGestureRecognizer x:Name="PanGesture" PanUpdated="PanGesture_PanUpdated" />
            </dx:DXButton.GestureRecognizers>
            <dx:DXButton.Content>

                <Grid ColumnDefinitions="*,Auto" >
                    <dx:DXStackLayout Orientation="Vertical"  Grid.Column="0"
        
        >
                        <Label Text="{Binding TemporarilyPickedSong.Title}" FontSize="20"/>
                        <Label Text="{Binding TemporarilyPickedSong.ArtistName}" FontSize="14"/>
                    </dx:DXStackLayout>
                    <dx:DXStackLayout Orientation="Horizontal" 
         Grid.Column="1" Margin="15">

                            <dx:Chip Icon="vinyl.png" WidthRequest="45"
    x:Name="ViewNowPlayPage"
    Tap="ViewNowPlayPage_Tap"
    BorderColor="Transparent"
    IsIconVisible="True"
    IconColor="MediumPurple"
    IconSize="35,35"
    />
                        <dx:Chip Icon="songfind.png" WidthRequest="45"
    x:Name="SearchSong"
    Tap="SearchSong_Tap"
    BorderColor="Transparent"
    IsIconVisible="True"
    IconColor="MediumPurple"
    IconSize="35,35"
    />
                        <dx:Chip Icon="eye.png" BorderColor="Transparent" WidthRequest="45"
    IsIconVisible="True" 
    IconSize="40,40"
    x:Name="ScrollToSong"
        IconColor="MediumPurple"
    Tap="ScrollToSong_Tap"
    >
                        </dx:Chip>
                    </dx:DXStackLayout>

                </Grid>
            </dx:DXButton.Content>
        </dx:DXButton>


        <dx:DXStackLayout x:Name="SearchModeUI" 
                              IsVisible="False">
            <dx:TextEdit x:Name="SearchBy" TextChanged="SearchBy_TextChanged"
                         LabelText="Search by"
                         TextChangedCommandParameter="Title"/>
        </dx:DXStackLayout>

           
        </Grid>
        <dx:BottomSheet x:Name="OptionsBtmSheet"
             IsVisible="False">

        </dx:BottomSheet>

        <dx:DXPopup x:Name="SongsMenuPopup" PlacementTarget="{x:Reference myPage}"
         AllowScrim="True" CloseOnScrimTap="True" 
         WidthRequest="{Binding Width,Source={x:Reference MainPage}}">
            <Grid>
                <dx:DXImage Source="{Binding MySelectedSong.CoverImagePath}"
                 Opacity="0.1"/>
                <dx:DXStackLayout Orientation="Vertical" BackgroundColor="Transparent">
                    <dx:DXStackLayout.Resources>
                        <ResourceDictionary>
                            <Style TargetType="dx:DXButton">
                                <Setter Property="ButtonType" Value="ToolButton"/>
                                <Setter Property="HorizontalContentAlignment" Value="Start"/>

                            </Style>
                            <Style TargetType="Label">
                                <Setter Property="FontSize" Value="24"/>
                                <Setter Property="FontAttributes" Value="Bold"/>

                            </Style>
                        </ResourceDictionary>
                    </dx:DXStackLayout.Resources>
                    <dx:DXStackLayout Orientation="Horizontal" HorizontalOptions="Center" VerticalOptions="Center"
                             ItemSpacing="10" BackgroundColor="Transparent">
                        <!--<toolkit:AvatarView ImageSource="{Binding MySelectedSong.CoverImagePath}"
                     HeightRequest="100" WidthRequest="100"
                     CornerRadius="15" BorderWidth="0"/>-->
                        <dx:DXStackLayout Orientation="Vertical" VerticalOptions="Center" >

                            <Label Text="{Binding MySelectedSong.Title}" HorizontalTextAlignment="Center"
                 LineBreakMode="NoWrap" FontSize="30"/>
                            <Label Text="{Binding MySelectedSong.ArtistName}" 
                 FontSize="22"
                 HorizontalTextAlignment="Center"/>
                        </dx:DXStackLayout>
                    </dx:DXStackLayout>

                    <dx:DXSeparator />
                    <dx:DXButton Content="Set Play Repeat Count" BackgroundColor="Transparent"
             Command="{Binding OpenRepeatSetterPopupCommand}" 
                     Icon="repone.png">

                    </dx:DXButton>
                    <dx:DXButton Content="Add to Playlist**"
                  Icon="playlistminimalistic.png">

                    </dx:DXButton>
                    <dx:DXButton Content="Go to Album" Command="{Binding NavigateToSpecificAlbumPageFromBtmSheetCommand}"
                     CommandParameter="{Binding MySelectedSong}"  
                     Icon="album.png"
             x:Name="GoToAlbumBtn">

                    </dx:DXButton>
                    <dx:DXButton Content="Go to Artist" x:Name="GotoArtistBtn" Clicked="GotoArtistBtn_Clicked"
                     Icon="artist.png">

                    </dx:DXButton>
                    <dx:DXButton Content="Tag Editor" CommandParameter="{Binding MySelectedSong}" 
                     Icon="clapperboardedit.png"
             Command="{Binding OpenEditSongPopupCommand}">

                    </dx:DXButton>
                    <dx:DXButton Content="Song Info"  Icon="fileinfo.png"
             Command="{Binding OpenViewSongDetailsPopupCommand}">

                    </dx:DXButton>
                    <dx:DXButton Content="Share" Clicked="ClosePopup" Icon="squareforward.png"
             Command="{Binding NavigateToShareStoryPageCommand}">

                    </dx:DXButton>
                    <dx:DXButton Content="Delete" CommandParameter="{Binding MySelectedSong}" Icon="delete.png"
             Command="{Binding DeleteFileCommand}">

                    </dx:DXButton>

                </dx:DXStackLayout>
            </Grid>

        </dx:DXPopup>
    </Grid>
</ContentPage>