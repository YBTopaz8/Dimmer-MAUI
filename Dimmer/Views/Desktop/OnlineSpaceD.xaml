<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Dimmer_MAUI.Views.Desktop.OnlineSpaceD"
            xmlns:vm="clr-namespace:Dimmer_MAUI.ViewModels"
            xmlns:models="clr-namespace:Dimmer_MAUI.Utilities.Models"
            xmlns:cw="clr-namespace:Dimmer_MAUI.Views.CustomViews"
            xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit"               
            xmlns:btmSheet="clr-namespace:Syncfusion.Maui.Toolkit.BottomSheet;assembly=Syncfusion.Maui.Toolkit"
            xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"             
            xmlns:converters="clr-namespace:Dimmer_MAUI.Utilities.TypeConverters"
            xmlns:ratingsView="clr-namespace:Dimmer_MAUI.Utilities.OtherUtils.CustomControl.RatingsView.Views"
            x:DataType="vm:HomePageVM"
             xmlns:Parse ="clr-namespace:Parse;assembly=YBParseLiveQuery"
            x:Name="myPage"
            xmlns:sys="clr-namespace:System;assembly=netstandard"
            xmlns:viewsD="clr-namespace:Dimmer_MAUI.Views.Desktop"
            xmlns:customControl="clr-namespace:Dimmer_MAUI.Utilities.OtherUtils.CustomControl"
            >

    
    <Grid RowDefinitions="*,Auto">

        <VerticalStackLayout Grid.Row="1"
            toolkit:DockLayout.DockPosition="Bottom">
            <Border x:Name="OGSenderView" BackgroundColor="Transparent">
                <VerticalStackLayout  IsVisible="True" BackgroundColor="Transparent">
                    <Button BackgroundColor="Transparent" Text="x" Clicked="Button_Clicked"/>
                    <Label x:Name="OGSenderUserName" FontAttributes="Bold" />
                    <Label x:Name="OGSenderLabel" FontSize="18"
                           />
                    
                </VerticalStackLayout>
            </Border>
            <Border Stroke="DarkSlateBlue" VerticalOptions="Start"
                    
                    StrokeThickness="1" BackgroundColor="#222529"
                    Margin="10">
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="5">
                    <Editor Placeholder="{OnPlatform WinUI='Leave a note.. (Tip: Press Windows Key + . for Emojis)'
                        ,Android='Leave a note..'} " x:Name="ChatMsgView" Keyboard="Chat"
                                Grid.Column="0" FontSize="20"/>
                    <HorizontalStackLayout Grid.Column="1" 
                                           x:Name="SendView"
                                           BackgroundColor="Transparent" 
                                           Padding="5">
                        <ImageButton Source="multipleforwardright.png" ToolTipProperties.Text="Send"
                                     x:Name="SendTextMsgBtn" Clicked="SendTextMsgBtn_Clicked"/>
                    </HorizontalStackLayout>

                </Grid>
            </Border>
            <cw:MediaPlaybackControlsView 
                
                toolkit:DockLayout.DockPosition="Bottom"
          x:Name="MediaPlayBackCW" />
        </VerticalStackLayout>
        
        <Grid ColumnDefinitions="300,*" Grid.Row="0"
              RowDefinitions="Auto,*" >

            <Grid RowDefinitions="Auto,*" Grid.Column="0" 
                  Grid.Row="0"
                  Margin="5,0">
                <VerticalStackLayout >
                    <SearchBar Placeholder="..."/>
                </VerticalStackLayout>
                <CollectionView ItemsSource="{Binding AllUsersAvailable}" Grid.Row="1">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="Parse:ParseUser">
                            <Border VerticalOptions="Center">
                            <syncf:SfEffectsView TouchDown="SepecificUserVew_TouchDown" x:Name="SepecificUserVew"
                                                 >
                                <VerticalStackLayout HeightRequest="60"
                                                     VerticalOptions="Center">
                                    <Label Text="{Binding Username}" VerticalTextAlignment="Center"/>
                                </VerticalStackLayout>
                            </syncf:SfEffectsView>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            </Grid>
            
            <CollectionView Grid.Column="1" VerticalOptions="Start"
                            
                            ItemsSource="{Binding ChatMessages}" x:Name="UserChatColView"
                            EmptyView="Nothing yet..." Grid.Row="1">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:UserActivity">
                        <Border x:Name="MsgBorder" Stroke="DarkSlateBlue" BackgroundColor="Transparent">
                                <Border.Triggers>
                                    <DataTrigger TargetType="Border" Binding="{Binding ActivityType}" Value="0">
                                        <Setter Property="Stroke" Value="DarkSlateBlue"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Border" Binding="{Binding ActivityType}" Value="1">
                                        <Setter Property="Stroke" Value="#252526"/>
                                    </DataTrigger>
                                </Border.Triggers>
                            <Border.GestureRecognizers>
                                <PointerGestureRecognizer x:Name="MsgBorderPointerRecog"
                                                  PointerEntered="MsgBorderPointerRecog_PointerEntered"
                                                  PointerExited="MsgBorderPointerRecog_PointerExited"
                                                  />
                            </Border.GestureRecognizers>

                            <Grid Margin="5,0" RowDefinitions="*,Auto" BackgroundColor="Transparent">

                                <Image  Grid.Column="0"/>
                                <VerticalStackLayout Grid.Column="1">
                                    <HorizontalStackLayout HorizontalOptions="Center">
                                        <Label Text="{Binding CreatedAt}" />
                                        <Label Text="(edited)" IsVisible="{Binding ChatMessage.IsEdited}" />
                                    </HorizontalStackLayout>
                                    <Label 
                                        FontSize="20"
                                        Text="{Binding ChatMessage.Content}" />
                                    <Label 
                                        FontSize="20"
                                        Text="{Binding ChatMessage.Sender.Username}" />

                                    <HorizontalStackLayout>
                                            <ImageButton  
                                                Opacity="0.7" CommandParameter="{Binding .}"
                                                Source="multipleforwardleft.png" x:Name="AddReaction" Clicked="AddReaction_Clicked">
                                                
                                            <ImageButton.Behaviors>
                                                    <toolkit:IconTintColorBehavior TintColor="DarkSlateBlue" />
                                            </ImageButton.Behaviors>
                                        </ImageButton>
                                        <!--<ImageButton Source="reaction.png" x:Name="EditRemoveReaction" Clicked="EditRemoveReaction_Clicked"/>-->

                                    </HorizontalStackLayout>
                                </VerticalStackLayout>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
                      
        </Grid>


    </Grid>
    
</ContentPage>