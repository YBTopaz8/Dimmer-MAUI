<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Dimmer_MAUI.Views.Desktop.MainPageD"              
             xmlns:vm="clr-namespace:Dimmer_MAUI.ViewModels"
             xmlns:models="clr-namespace:Dimmer_MAUI.Utilities.Models"
             xmlns:cw="clr-namespace:Dimmer_MAUI.Views.CustomViews"
             xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit"               
             xmlns:btmSheet="clr-namespace:Syncfusion.Maui.Toolkit.BottomSheet;assembly=Syncfusion.Maui.Toolkit"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"             
             xmlns:converters="clr-namespace:Dimmer_MAUI.Utilities.TypeConverters"
             xmlns:ratingsView="clr-namespace:Dimmer_MAUI.Utilities.OtherUtils.CustomControl.RatingsView.Views"
             x:DataType="vm:HomePageVM"
             x:Name="myPage"  
             xmlns:sys="clr-namespace:System;assembly=netstandard"
             >

    <ContentPage.Resources>
        <converters:DurationConverterFromMsToTimeSpan x:Key="DurationConverter"/>

        <converters:BoolToInverseConverter x:Key="BoolToInverse"/>
        <converters:BytesToMegabytesConverter x:Key="FileSizeConverter"/>


    </ContentPage.Resources>

    
    <Grid x:Name="MainDock" RowDefinitions="*,Auto"
        IsEnabled="True">
        <Grid.GestureRecognizers >
            <DropGestureRecognizer AllowDrop="True" x:Name="mainDockDropGest" 
                                DragOver="DropGestureRecognizer_DragOver"
                                DragLeave="DropGestureRecognizer_DragLeave"
                                Drop="DropGestureRecognizer_Drop"/>
        </Grid.GestureRecognizers>

        <cw:MediaPlaybackControlsView toolkit:DockLayout.DockPosition="Bottom"
                x:Name="MediaPlayBackCW" Grid.Row="1"/>
        <toolkit:DockLayout x:Name="MainBody" Grid.Row="0" >

            <VerticalStackLayout toolkit:DockLayout.DockPosition="Top" >

                <FlexLayout JustifyContent="SpaceBetween" toolkit:DockLayout.DockPosition="Top" 
                    Margin="10,0,10,0" x:Name="NormalMiniUtilBar">
                    <Label Text="{Binding DisplayedSongs.Count, StringFormat='{0} Songs'}" FontSize="18"
                FontAttributes="Bold" TextColor="DarkSlateBlue" VerticalTextAlignment="End"/>

                    <HorizontalStackLayout Spacing="10">

                        <ImageButton Clicked="ScrollToSong_Clicked" ToolTipProperties.Text="Scroll To Currently Playing Song"
                            Source="eyelocatedark.png">

                        </ImageButton>
                        <ImageButton HeightRequest="40" BackgroundColor="#1e1e1e"
                            Clicked="SortBtn_Clicked" x:Name="SortBtn" Grid.Column="1" 
                            Source="sortvertical.png">
                        </ImageButton>

                        <Button Text="Toggle Drawer" x:Name="toggleDrawer" Clicked="ToggleDrawer_Clicked" />
                    </HorizontalStackLayout>

                </FlexLayout>

                <FlexLayout JustifyContent="SpaceBetween" toolkit:DockLayout.DockPosition="Top" 
                        Margin="10,0,10,0" x:Name="MultiSelectUtilBar" IsVisible="False">
                    <HorizontalStackLayout>
                        <ImageButton WidthRequest="30" Clicked="CancelMultiSelect_Clicked">

                        </ImageButton>
                        <Label Text="{Binding MultiSelectText}" FontSize="28" VerticalTextAlignment="End"
                            FontAttributes="Bold" TextColor="DarkSlateBlue"/>
                    </HorizontalStackLayout>


                    <HorizontalStackLayout Spacing="10">

                        <ImageButton Command="{Binding MultiSelectUtilClickedCommand}" IsVisible="{Binding IsMultiSelectOn}">

                            <ImageButton.CommandParameter>
                                <x:Int32>0</x:Int32>
                            </ImageButton.CommandParameter>
                        </ImageButton>
                    </HorizontalStackLayout>

                </FlexLayout>
            </VerticalStackLayout>
            <Grid toolkit:DockLayout.DockPosition="Top" >
                <CollectionView ItemsSource="{Binding DisplayedSongs}" 
                            VerticalScrollBarVisibility="Default" RemainingItemsThreshold="15" 
                            RemainingItemsThresholdReached="SongsColView_RemainingItemsThresholdReached"
                            x:Name="SongsColView" ItemsUpdatingScrollMode="KeepScrollOffset" 
                            Loaded="SongsColView_Loaded" Margin="5,0">

                    <CollectionView.EmptyView>
                        <VerticalStackLayout HorizontalOptions="Center">
                            <Label Text="No Songs Found, Please Scan Songs In Settings Tab "
                        HorizontalOptions="Center"
                        FontSize="25"/>
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="3"/>
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:SongModelView">
                            <Border>
                                <syncf:SfEffectsView ToolTipProperties.Text="{Binding Title}"
                    TouchDown="SfEffectsView_TouchDown" >
                                    <Grid ColumnDefinitions="*,*,*,*,*,*,*" RowDefinitions="70" ColumnSpacing="15">
                                        <Grid.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="PlaySong_Tapped" x:Name="PlaySong" NumberOfTapsRequired="2"/>

                                            <PointerGestureRecognizer PointerEntered="PointerGestureRecognizer_PointerEntered" 
                                            PointerExited="PointerGestureRecognizer_PointerExited"
                                            />
                                        </Grid.GestureRecognizers>
                                        <VerticalStackLayout Grid.Column="0" Margin="5,0,0,0"
                                        VerticalOptions="Center">

                                            <Label Text="{Binding Title}" Grid.Column="1"
                                            FontSize="18" 
                                            LineBreakMode="TailTruncation"/>

                                            <Image WidthRequest="25" HeightRequest="25" HorizontalOptions="Start"  
                                            IsVisible="{Binding HasLyrics}" Source="lyrics.png" Opacity="1">
                                                <Image.Behaviors>
                                                    <toolkit:IconTintColorBehavior TintColor="#A2B5E2"/>
                                                </Image.Behaviors>
                                            </Image>


                                        </VerticalStackLayout>

                                        <syncf:SfEffectsView Grid.Column="1" 
                                                        TouchUp="ShowCntxtMenuBtn_Clicked"
                                                        RippleAnimationDuration="500" BackgroundColor="Transparent"
                                                        Opacity="0.31" WidthRequest="90"
                                                        ToolTipProperties.Text="View More">
                                            <Image Source="more1.png" Rotation="90" >
                                            </Image>
                                        </syncf:SfEffectsView>
                                        <Label Grid.Column="2" 
                                    Text="{Binding ArtistName}" LineBreakMode="TailTruncation"/>

                                        <Label Grid.Column="3" Text="{Binding AlbumName}" LineBreakMode="TailTruncation" />

                                        <Label Grid.Column="4" HorizontalOptions="Center" LineBreakMode="TailTruncation"
                                Text="{Binding GenreName}" />

                                        <Label Grid.Column="5" Text="{Binding DurationInSeconds, Converter={StaticResource DurationConverter}}" 
                            HorizontalOptions="Center" />
                                        <Label Grid.Column="6" HorizontalOptions="Center" Text="{Binding FileFormat}" />

                                    </Grid>

                                </syncf:SfEffectsView>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </toolkit:DockLayout>

    </Grid>
        
        
</ContentPage>