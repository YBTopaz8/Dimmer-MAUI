<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Name="myPage"
             x:Class="Dimmer.Views.HomePage" xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" xmlns:converters="clr-namespace:Dimmer.Utilities.TypeConverters;assembly=Dimmer"
             xmlns:dx="http://schemas.devexpress.com/maui" xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer" xmlns:navDrawer="clr-namespace:Syncfusion.Maui.Toolkit.NavigationDrawer;assembly=Syncfusion.Maui.Toolkit"
             xmlns:progressBar="clr-namespace:Syncfusion.Maui.Toolkit;assembly=Syncfusion.Maui.Toolkit" xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit" xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
             xmlns:vm="clr-namespace:Dimmer.ViewModels" Title="HomePage"
             x:DataType="vm:BaseViewModelAnd"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5,
                                               Dark=#1E1E1E}"
             Shell.NavBarIsVisible="False" Shell.TabBarIsVisible="True"
             >

    <ContentPage.Resources>
        <ResourceDictionary>
            <DataTemplate x:Key="filteringUIFormTemplate">
                <dx:DXScrollView>
                    <dx:DXStackLayout>

                        <dx:FilterChipGroupItem FieldName="FileFormat" Text="FileFormat" />
                        <dx:FilterCheckItem FieldName="IsFavorite" Text="Is Favorite?" />
                    </dx:DXStackLayout>
                </dx:DXScrollView>
            </DataTemplate>
            <Style TargetType="Label">
                <Setter Property="Text" Value="{AppThemeBinding Dark=White, Light=black}" />
                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="FontSize" Value="26" />
            </Style>

            <Style TargetType="dx:Chip">

                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="FontSize" Value="19" />
            </Style>

            <Style TargetType="Grid">

                <Setter Property="BackgroundColor" Value="Transparent" />

            </Style>

            <Style TargetType="dx:DXButton">

                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="TextColor" Value="{AppThemeBinding Dark=White, Light=Black}" />
                <Setter Property="IconColor" Value="DarkSlateBlue" />
                <Setter Property="PressedBackgroundColor" Value="DarkSlateBlue" />
                <Setter Property="PressedIconColor" Value="White" />
            </Style>

            <Style x:Key="LittleBtn" TargetType="dx:DXButton">
                <Setter Property="IconHeight" Value="19" />
            </Style>

            <converters:DurationConverterFromMsToTimeSpan x:Key="DurationConverter" />
            <converters:BytesToMegabytesConverter x:Key="FileSizeConverter" />
            <converters:BytesArrayToImageSource x:Key="BytesToImageConverter" />
            <converters:BoolToInverseConverter x:Key="BoolToInverse" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid BackgroundColor="Transparent" RowDefinitions="*,auto">


        <dx:DXImage Grid.RowSpan="2" Aspect="AspectFill"
                    Opacity="0.03"
                    Source="{Binding BaseVM.CurrentPlayingSongView.CoverImagePath}"
                    />
        <dx:DXStackLayout Grid.Row="0" Margin="0,10,0,0">
            <VerticalStackLayout>
                <VerticalStackLayout.Resources>
                    <ResourceDictionary>
                        <Style TargetType="dx:DXButton">
                            <Setter Property="ButtonType" Value="ToolButton" />
                            <Setter Property="HorizontalContentAlignment" Value="Start" />
                            <Setter Property="IconHeight" Value="30" />
                            <Setter Property="IconWidth" Value="30" />
                            <Setter Property="IconColor" Value="#585858" />
                        </Style>
                    </ResourceDictionary>
                </VerticalStackLayout.Resources>

                <HorizontalStackLayout BackgroundColor="Transparent" HorizontalOptions="Center"
                                       IsVisible="False"
                                       >

                    <dx:DXButton HorizontalOptions="Start" Icon="searchd.png"
                                 ShowIcon="True"
                                 />

                    <dx:DXButton HorizontalOptions="Start" Icon="shuffle.png"
                                 ShowIcon="True"
                                 />

                    <dx:DXButton HorizontalOptions="Start" Icon="playlistadd.png"
                                 ShowIcon="True"
                                 />

                </HorizontalStackLayout>
                <dx:TextEdit x:Name="SearchBy"
                             Margin="20,0" BorderColor="#585858"
                             CornerRadius="20" FocusedBorderColor="DarkSlateBlue"
                             HeightRequest="55" PlaceholderColor="DarkSlateBlue"
                             PlaceholderText="Search..." StartIcon="searchd.png"
                             StartIconColor="DarkSlateBlue" TextChanged="SearchBy_TextChanged"
                             />
                <HorizontalStackLayout BackgroundColor="Transparent" IsVisible="True">
                    <dx:Chip x:Name="SortCategory"
                             BackgroundColor="Transparent" BorderColor="Transparent"
                             Icon="roundaltarrowup.png" IconSize="60"
                             IsIconVisible="True" LongPress="SortCategory_LongPress"
                             Tap="Sort_Clicked"
                             Text="{Binding BaseVM.CurrentSortProperty}"
                             >
                        <dx:Chip.Triggers>
                            <DataTrigger Binding="{Binding BaseVM.CurrentSortOrderInt}"
                                         TargetType="dx:Chip" Value="0"
                                         >
                                <Setter Property="Icon" Value="roundaltarrowup.png" />

                            </DataTrigger>
                            <DataTrigger Binding="{Binding BaseVM.CurrentSortOrderInt}"
                                         TargetType="dx:Chip" Value="1"
                                         >
                                <Setter Property="Icon" Value="roundaltarrowdown.png" />

                            </DataTrigger>
                        </dx:Chip.Triggers>
                    </dx:Chip>
                </HorizontalStackLayout>

            </VerticalStackLayout>



            <Grid BackgroundColor="Transparent" IsVisible="True">



                <dx:DXCollectionView x:Name="SongsColView"
                                     AllowDragDropItems="True" AllowFixedGroupHeaders="True"
                                     BackgroundColor="Transparent"
                                     FilteringUITemplate="{StaticResource filteringUIFormTemplate}"
                                     ItemSpacing="5"
                                     ItemsSource="{Binding BaseVM.NowPlayingDisplayQueue}"
                                     Loaded="SongsColView_Loaded" Tap="SongsColView_Tap"
                                     >

                    <dx:DXCollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:SongModelView">
                            <Grid BackgroundColor="Transparent" ColumnDefinitions="0.23*,*,0.35*"
                                  HeightRequest="80" VerticalOptions="Center"
                                  >
                                <dx:DXBorder Grid.Column="0" BackgroundColor="Transparent"
                                             CornerRadius="15" HeightRequest="60"
                                             WidthRequest="60"
                                             >

                                    <Image Source="{Binding CoverImagePath}" />

                                </dx:DXBorder>
                                <dx:DXStackLayout x:Name="TitleAndArtists"
                                                  Grid.Column="1" BackgroundColor="Transparent"
                                                  VerticalOptions="Center"
                                                  >
                                    <Label BackgroundColor="Transparent" FontAttributes="Bold"
                                           FontSize="20" LineBreakMode="TailTruncation"
                                           Text="{Binding Title}"
                                           TextColor="#F5F5F5" VerticalOptions="Center"
                                           />

                                    <Label x:Name="ArtistsChip"
                                           Padding="-1" BackgroundColor="Transparent"
                                           FontSize="12" HorizontalOptions="Start"
                                           LineBreakMode="TailTruncation" Opacity="0.4"
                                           Text="{Binding ArtistName}"
                                           VerticalOptions="Center"
                                           />

                                    <Label BackgroundColor="Transparent" FontSize="12"
                                           Opacity="0.4"
                                           Text="{Binding ReleaseYear}"
                                           VerticalOptions="Center"
                                           />


                                </dx:DXStackLayout>
                                <dx:DXButton x:Name="MoreIcon"
                                             Grid.Column="2" Clicked="MoreIcon_Clicked"
                                             HorizontalOptions="End" ShowContent="True"
                                             ShowIcon="False"
                                             >
                                    <dx:DXButton.Content>
                                        <dx:DXStackLayout Orientation="Horizontal">


                                            <Label BackgroundColor="Transparent" FontSize="12"
                                                   Opacity="0.9"
                                                   Text="{Binding DurationInSeconds, Converter={x:StaticResource DurationConverter}}"
                                                   TextColor="White" VerticalOptions="Center"
                                                   />
                                            <dx:DXImage Rotation="90" Source="more1.png"
                                                        TintColor="#585858" WidthRequest="35"
                                                        />



                                        </dx:DXStackLayout>
                                    </dx:DXButton.Content>
                                </dx:DXButton>
                            </Grid>
                        </DataTemplate>
                    </dx:DXCollectionView.ItemTemplate>
                </dx:DXCollectionView>

            </Grid>

        </dx:DXStackLayout>

        <Grid Grid.Row="1">

            <dx:DXBorder x:Name="BtmBar"
                         Padding="5" CornerRadius="20,20,20,20"
                         HeightRequest="80"
                         >

                <dx:DXBorder.Triggers>
                    <DataTrigger Binding="{Binding BaseVM.IsPlaying}"
                                 TargetType="dx:DXBorder" Value="True"
                                 >
                        <Setter Property="BorderThickness" Value="2" />
                        <Setter Property="BorderColor" Value="DarkSlateBlue" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding BaseVM.IsPlaying}"
                                 TargetType="dx:DXBorder" Value="False"
                                 >
                        <Setter Property="BorderThickness" Value="0" />
                        <Setter Property="BorderColor" Value="Transparent" />
                    </DataTrigger>
                </dx:DXBorder.Triggers>
                <dx:DXBorder.GestureRecognizers>
                    <TapGestureRecognizer x:Name="BtmBarTapGest" Tapped="BtmBarTapGest_Tapped" />
                    <PanGestureRecognizer x:Name="PanGesture" PanUpdated="PanGesture_PanUpdated" />
                </dx:DXBorder.GestureRecognizers>
                <dx:DXBorder.Content>
                    <StackLayout Padding="0,0" BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#242629}">

                        <Grid Padding="0,0" BackgroundColor="Transparent"
                              ColumnDefinitions="auto,*" ColumnSpacing="5"
                              >
                            <StackLayout Grid.Column="0" Orientation="Horizontal">
                                <dx:DXImage Aspect="AspectFit" HeightRequest="70"
                                            Source="{Binding BaseVM.CurrentPlayingSongView.CoverImagePath}"
                                            />
                            </StackLayout>
                            <Grid Grid.Column="1" ColumnDefinitions="*,auto">


                                <StackLayout Grid.Column="0" BackgroundColor="Transparent"
                                             HorizontalOptions="Start" Orientation="Vertical"
                                             >
                                    <Label FontSize="21" LineBreakMode="TailTruncation"
                                           Text="{Binding BaseVM.CurrentPlayingSongView.Title}"
                                           TextColor="DarkSlateBlue"
                                           />
                                    <Label FontAttributes="Italic" FontSize="13"
                                           LineBreakMode="WordWrap"
                                           Text="{Binding BaseVM.CurrentPlayingSongView.ArtistName}"
                                           />
                                </StackLayout>

                                <dx:Chip x:Name="DurationAndSearchChip"
                                         Grid.Column="1" BorderThickness="0"
                                         LongPress="DurationAndSearchChip_LongPress"
                                         >
                                    <dx:Chip.ContentTemplate>
                                        <DataTemplate>
                                            <VerticalStackLayout>
                                                <Label FontSize="16" HorizontalOptions="End"
                                                       Text="{Binding BaseVM.CurrentTrackPositionSeconds, Converter={x:StaticResource DurationConverter}}"
                                                       VerticalOptions="Center"
                                                       />
                                            </VerticalStackLayout>
                                        </DataTemplate>
                                    </dx:Chip.ContentTemplate>

                                </dx:Chip>
                            </Grid>
                        </Grid>
                    </StackLayout>
                </dx:DXBorder.Content>
            </dx:DXBorder>

        </Grid>
        <dx:BottomSheet>
            <dx:BottomSheet x:Name="SongsMenuPopup"
                            AllowedState="HalfExpanded" HalfExpandedRatio="0.7"
                            HeightRequest="300"
                            >
                <Grid>
                    <dx:DXImage Opacity="0.3" Source="{Binding BaseVM.CurrentPlayingSongView.CoverImagePath}" />
                    <dx:DXStackLayout BackgroundColor="Transparent" Orientation="Vertical">
                        <dx:DXStackLayout.Resources>
                            <ResourceDictionary>
                                <Style TargetType="dx:DXButton">
                                    <Setter Property="ButtonType" Value="ToolButton" />
                                    <Setter Property="HorizontalContentAlignment" Value="Start" />

                                </Style>
                                <Style TargetType="Label">
                                    <Setter Property="FontSize" Value="24" />
                                    <Setter Property="FontAttributes" Value="Bold" />

                                </Style>
                            </ResourceDictionary>
                        </dx:DXStackLayout.Resources>
                        <dx:DXStackLayout BackgroundColor="Transparent" HorizontalOptions="Center"
                                          ItemSpacing="10" Orientation="Horizontal"
                                          VerticalOptions="Center"
                                          >
                            <!--<toolkit:AvatarView ImageSource="{Binding CurrentPlayingSongView.CoverImagePath}"
                     HeightRequest="100" WidthRequest="100"
                     CornerRadius="15" BorderWidth="0"/>-->
                            <dx:DXStackLayout Orientation="Vertical" VerticalOptions="Center">

                                <Label FontSize="20" HorizontalTextAlignment="Center"
                                       LineBreakMode="NoWrap"
                                       Text="{Binding BaseVM.CurrentPlayingSongView.Title}"
                                       />
                                <Label FontSize="14" HorizontalTextAlignment="Center"
                                       Text="{Binding BaseVM.CurrentPlayingSongView.ArtistName}"
                                       />
                            </dx:DXStackLayout>
                        </dx:DXStackLayout>

                        <dx:DXSeparator />
                        <dx:DXButton BackgroundColor="Transparent"
                                     Command="{Binding OpenRepeatSetterPopupCommand}"
                                     Content="Set Play Repeat Count" Icon="repone.png"
                                     />
                        <dx:DXButton Content="Add to Playlist**" Icon="playlistminimalistic.png" />
                        <dx:DXButton x:Name="GoToAlbumBtn"
                                     Command="{Binding NavigateToSpecificAlbumPageFromBtmSheetCommand}"
                                     CommandParameter="{Binding CurrentPlayingSongView}"
                                     Content="Go to Album" Icon="album.png"
                                     />
                        <dx:DXButton x:Name="GotoArtistBtn"
                                     Clicked="GotoArtistBtn_Clicked" Content="Go to Artist"
                                     Icon="artist.png"
                                     />
                        <dx:DXButton Command="{Binding OpenEditSongPopupCommand}"
                                     CommandParameter="{Binding CurrentPlayingSongView}"
                                     Content="Tag Editor" Icon="clapperboardedit.png"
                                     />
                        <dx:DXButton Command="{Binding OpenViewSongDetailsPopupCommand}"
                                     Content="Song Info" Icon="fileinfo.png"
                                     />
                        <dx:DXButton Clicked="ClosePopup"
                                     Command="{Binding NavigateToShareStoryPageCommand}"
                                     Content="Share" Icon="squareforward.png"
                                     />
                        <dx:DXButton Command="{Binding DeleteFileCommand}"
                                     CommandParameter="{Binding CurrentPlayingSongView}"
                                     Content="Delete" Icon="delete.png"
                                     />

                    </dx:DXStackLayout>
                </Grid>

            </dx:BottomSheet>
        </dx:BottomSheet>

        <dx:BottomSheet x:Name="NowPlayingBtmSheet"
                        AllowedState="FullExpanded" CornerRadius="0"
                        ShowGrabber="False" StateChanged="NowPlayingBtmSheet_StateChanged"
                        >
            <Grid Margin="10,0">

                <dx:DXImage IsVisible="False" Opacity="0.6"
                            Source="{Binding BaseVM.CurrentPlayingSongView.CoverImagePath}"
                            />
                <dx:TabView HeaderPanelPosition="Bottom" SelectedItemIndicatorColor="DarkSlateBlue">

                    <dx:TabViewItem>
                        <dx:TabViewItem.HeaderContent>
                            <dx:DXStackLayout Orientation="Horizontal">
                                <Image HeightRequest="50" Source="musiccircle.png"
                                       WidthRequest="90"
                                       />
                            </dx:DXStackLayout>
                        </dx:TabViewItem.HeaderContent>
                        <dx:TabViewItem.Content>
                            <Grid BackgroundColor="Transparent" RowDefinitions="*,auto,*,auto"
                                  RowSpacing="20"
                                  >

                                <dx:DXBorder x:Name="TopRowWithImage"
                                             Grid.Row="0" BorderColor="DarkSlateBlue"
                                             BorderThickness="0" CornerRadius="25"
                                             >
                                    <dx:DXBorder.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="BtmBarTapGest_Tapped" />
                                    </dx:DXBorder.GestureRecognizers>


                                    <dx:DXImage Aspect="AspectFill" Opacity="0.6"
                                                Source="{Binding BaseVM.CurrentPlayingSongView.CoverImagePath}"
                                                >
                                        <dx:DXImage.Clip>
                                            <EllipseGeometry Center="100,100" RadiusX="500"
                                                             RadiusY="500"
                                                             />
                                        </dx:DXImage.Clip>
                                    </dx:DXImage>
                                </dx:DXBorder>
                                <dx:DXStackLayout Grid.Row="1" Margin="0,0,0,0"
                                                  ItemSpacing="15"
                                                  >
                                    <dx:Chip BackgroundColor="Transparent" BorderColor="Transparent"
                                             BorderThickness="0.4" FontSize="30"
                                             Text="{Binding BaseVM.CurrentPlayingSongView.Title}"
                                             >
                                        <dx:Chip.Triggers>
                                            <DataTrigger Binding="{Binding BaseVM.IsPlaying}"
                                                         TargetType="dx:Chip" Value="True"
                                                         >
                                                <Setter Property="TextColor" Value="DarkSlateBlue" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding BaseVM.IsPlaying}"
                                                         TargetType="dx:Chip" Value="False"
                                                         >
                                                <Setter Property="TextColor" Value="Grey" />
                                            </DataTrigger>
                                        </dx:Chip.Triggers>
                                    </dx:Chip>
                                    <dx:Chip BackgroundColor="Transparent" BorderColor="Transparent"
                                             BorderThickness="0.1" FontSize="25"
                                             Text="{Binding BaseVM.CurrentPlayingSongView.ArtistName}"
                                             />
                                </dx:DXStackLayout>
                                <Grid Grid.Row="2" RowDefinitions="auto,auto,*"
                                      RowSpacing="15"
                                      >

                                    <Grid x:Name="ProgressAndPrev"
                                          Grid.Row="0" BackgroundColor="Transparent"
                                          ColumnDefinitions="0.4*,*" ColumnSpacing="10"
                                          >

                                        <dx:DXButton Grid.Column="0" BackgroundColor="#343534"
                                                     Command="{Binding BaseVM.PreviousTrackCommand}"
                                                     Icon="skipprevious.png" IconColor="#f5f5f5"
                                                     IconHeight="80" IconWidth="80"
                                                     Opacity="0.3" PressedBackgroundColor="DarkSlateBlue"
                                                     />
                                        <Grid Grid.Column="1" BackgroundColor="Transparent"
                                              ColumnDefinitions="*,*" RowDefinitions="*,*"
                                              >
                                            <dx:DXSlider x:Name="ProgressSlider"
                                                         Grid.Row="0" Grid.Column="0"
                                                         Grid.ColumnSpan="2" BackgroundColor="Transparent"
                                                         MaxValue="{Binding BaseVM.CurrentPlayingSongView.DurationInSeconds}"
                                                         MinValue="0" Opacity="0.7"
                                                         TapReleased="ProgressSlider_TapReleased" ValueStep="1"
                                                         VerticalOptions="End"
                                                         Value="{Binding BaseVM.CurrentTrackPositionSeconds}"
                                                         >


                                                <dx:DXSlider.TooltipAppearance>
                                                    <dx:DXSliderTooltipAppearance BackgroundColor="#626680" FontAttributes="Bold"
                                                                                  FontSize="16"
                                                                                  TextColor="{AppThemeBinding Dark=White,
                                                                                                              Light=black}"
                                                                                  />
                                                </dx:DXSlider.TooltipAppearance>

                                                <dx:DXSlider.TrackAppearance>
                                                    <dx:DXSliderTrackAppearance ActiveBackgroundColor="DarkSlateBlue" BackgroundColor="#626680"
                                                                                Thickness="12"
                                                                                />
                                                </dx:DXSlider.TrackAppearance>
                                                <dx:DXSlider.ThumbAppearance>
                                                    <dx:DXSliderThumbAppearance Width="2" Height="35"
                                                                                BackgroundColor="#A99BDE"
                                                                                />
                                                </dx:DXSlider.ThumbAppearance>
                                            </dx:DXSlider>
                                            <Label Grid.Row="1" Grid.Column="0"
                                                   FontSize="14"
                                                   Text="{Binding BaseVM.CurrentTrackPositionSeconds, Converter={StaticResource DurationConverter}}"
                                                   />
                                            <Label Grid.Row="1" Grid.Column="1"
                                                   FontSize="14" HorizontalOptions="End"
                                                   Text="{Binding BaseVM.CurrentPlayingSongView.DurationInSeconds, Converter={StaticResource DurationConverter}}"
                                                   />
                                        </Grid>

                                    </Grid>

                                    <Grid x:Name="PlayPauseAndNext"
                                          Grid.Row="1" BackgroundColor="Transparent"
                                          ColumnDefinitions="*,0.4*" ColumnSpacing="10"
                                          >
                                        <dx:DXButton Grid.Column="0" BackgroundColor="DarkSlateBlue"
                                                     Command="{Binding BaseVM.PlayPauseToggleCommand}"
                                                     Icon="play.png" IconColor="White"
                                                     IconHeight="100" IconWidth="100"
                                                     Opacity="0.7" PressedBackgroundColor="#343534"
                                                     >
                                            <dx:DXButton.Triggers>
                                                <DataTrigger Binding="{Binding BaseVM.IsPlaying}"
                                                             TargetType="dx:DXButton" Value="True"
                                                             >
                                                    <Setter Property="BorderThickness" Value="2" />
                                                    <Setter Property="Icon" Value="pause.png" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding BaseVM.IsPlaying}"
                                                             TargetType="dx:DXButton" Value="False"
                                                             >
                                                    <Setter Property="BorderThickness" Value="0" />
                                                    <Setter Property="Icon" Value="play.png" />
                                                </DataTrigger>
                                            </dx:DXButton.Triggers>
                                        </dx:DXButton>

                                        <dx:DXButton Grid.Row="1" Grid.Column="1"
                                                     AnimationDuration="800" BackgroundColor="#343534"
                                                     Command="{Binding BaseVM.NextTrackCommand}"
                                                     Icon="skipnext.png" IconColor="#f5f5f5"
                                                     IconHeight="80" IconWidth="80"
                                                     Opacity="0.3" PressedBackgroundColor="DarkSlateBlue"
                                                     />

                                    </Grid>

                                    <Grid Grid.Row="2" RowDefinitions="*,*"
                                          VerticalOptions="End"
                                          >
                                        <dx:DXButton Grid.Row="0"
                                                     Command="{Binding Commands.ToggleExpandState, Source={x:Reference BottomExpander}}"
                                                     Content="volume" IsVisible="False"
                                                     />
                                    </Grid>
                                </Grid>


                                <dx:DXExpander x:Name="BottomExpander"
                                               Grid.Row="3" BackgroundColor="Transparent"
                                               HeightRequest="100" HorizontalExpandMode="FromStartToEnd"
                                               IsExpanded="False" VerticalExpandMode="FromEndToStart"
                                               >
                                    <dx:DXExpander.Content>

                                        <dx:DXSlider x:Name="VolumeSlider"
                                                     Margin="10,0" BackgroundColor="Transparent"
                                                     IsVisible="True" MaxValue="1"
                                                     MinValue="0" Opacity="0.7"
                                                     TapReleased="VolumeSlider_TapReleased" ValueStep="0.1"
                                                     Value="{Binding BaseVM.DeviceVolumeLevel}"
                                                     >

                                            <dx:DXSlider.TooltipAppearance>
                                                <dx:DXSliderTooltipAppearance BackgroundColor="#626680" FontAttributes="Bold"
                                                                              FontSize="16"
                                                                              TextColor="{AppThemeBinding Dark=White,
                                                                                                          Light=black}"
                                                                              />
                                            </dx:DXSlider.TooltipAppearance>

                                            <dx:DXSlider.TrackAppearance>
                                                <dx:DXSliderTrackAppearance ActiveBackgroundColor="DarkSlateBlue" BackgroundColor="#626680" />
                                            </dx:DXSlider.TrackAppearance>
                                            <dx:DXSlider.ThumbAppearance>
                                                <dx:DXSliderThumbAppearance Width="2" Height="25"
                                                                            BackgroundColor="#A99BDE"
                                                                            />
                                            </dx:DXSlider.ThumbAppearance>
                                        </dx:DXSlider>

                                    </dx:DXExpander.Content>
                                </dx:DXExpander>


                            </Grid>

                        </dx:TabViewItem.Content>

                    </dx:TabViewItem>

                    <dx:TabViewItem>
                        <dx:TabViewItem.HeaderContent>
                            <dx:DXStackLayout Orientation="Horizontal">
                                <Image HeightRequest="50" Source="lyrics.png"
                                       WidthRequest="90"
                                       />
                            </dx:DXStackLayout>
                        </dx:TabViewItem.HeaderContent>
                        <dx:TabViewItem.Content>
                            <Grid>
                                <dx:DXImage Opacity="0.3" Source="{Binding BaseVM.CurrentPlayingSongView.CoverImagePath}" />
                                <dx:DXCollectionView ItemsSource="{Binding BaseVM.CurrentSynchronizedLyrics}" />
                            </Grid>
                        </dx:TabViewItem.Content>

                    </dx:TabViewItem>
                </dx:TabView>
            </Grid>
        </dx:BottomSheet>
        <dx:BottomSheet x:Name="SortBottomSheet" AllowedState="HalfExpanded">
            <dx:BottomSheet.Content>

                <dx:TabView HeaderPanelHeight="0" HeaderPanelPosition="Bottom"
                            SelectedItemIndicatorColor="DarkSlateBlue" SwipeEnabled="True"
                            >

                    <dx:TabViewItem HeaderText="Sort">
                        <dx:TabViewItem.Content>
                            <dx:DXStackLayout Orientation="Vertical">
                                <Label FontAttributes="Bold" FontSize="24"
                                       HorizontalOptions="Center" Text="Sort Options"
                                       />
                                <dx:DXStackLayout HorizontalOptions="Center" ItemSpacing="10"
                                                  Orientation="Vertical"
                                                  >

                                    <dx:DXButton Clicked="SortChoose_Clicked" CommandParameter="Title"
                                                 Content="Sort by Title" PressedTextColor="White"
                                                 />
                                    <dx:DXButton Clicked="SortChoose_Clicked" CommandParameter="Artist"
                                                 Content="Sort by Artist"
                                                 />
                                    <dx:DXButton Clicked="SortChoose_Clicked" CommandParameter="Album"
                                                 Content="Sort by Album"
                                                 />
                                    <dx:DXButton Clicked="SortChoose_Clicked" CommandParameter="Genre"
                                                 Content="Sort by Genre"
                                                 />
                                    <dx:DXButton Clicked="SortChoose_Clicked" CommandParameter="Duration"
                                                 Content="Sort by Duration"
                                                 />
                                    <dx:DXButton Clicked="SortChoose_Clicked" CommandParameter="Year"
                                                 Content="Sort by Year"
                                                 />
                                    <dx:DXButton Clicked="SortChoose_Clicked" CommandParameter="DateAdded"
                                                 Content="Sort by Date Added"
                                                 />
                                </dx:DXStackLayout>
                            </dx:DXStackLayout>
                        </dx:TabViewItem.Content>
                    </dx:TabViewItem>

                    <dx:TabViewItem>
                        <dx:TabViewItem.Content>
                            <StackLayout Orientation="Vertical">
                                <Label Text="More..." />
                            </StackLayout>
                        </dx:TabViewItem.Content>
                    </dx:TabViewItem>

                </dx:TabView>

            </dx:BottomSheet.Content>
        </dx:BottomSheet>
    </Grid>
</ContentPage>
