<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Dimmer.WinUI.Views.HomePage"
             xmlns:vm ="clr-namespace:Dimmer.WinUI.Views"
             x:DataType="vm:HomeViewModel"
            xmlns:converters="clr-namespace:Dimmer.Utilities.TypeConverters;assembly=Dimmer"
             xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit" 
             xmlns:models ="clr-namespace:Dimmer.Database.ModelView;assembly=Dimmer"
             x:Name="myPage"
             xmlns:cw="clr-namespace:Dimmer.WinUI.Views.CustomViews"
             Title="HomePage">

    <ContentPage.Resources>
        <converters:DurationConverterFromMsToTimeSpan x:Key="DurationConverter"/>


    </ContentPage.Resources>

    <Grid x:Name="MainPage" RowDefinitions="*,auto">
        <cw:MediaControlBtmBar Grid.Row="1"/>
        <CollectionView Grid.Row="0"
            BackgroundColor="Transparent" ItemsSource="{Binding DisplayedSongs}"
                        VerticalScrollBarVisibility="Default"              
                        
                            x:Name="SongsColView" Loaded="SongsColView_Loaded" 
                            Margin="5,0">

            <CollectionView.EmptyView>
                <VerticalStackLayout HorizontalOptions="Center">
                    <Label Text="No Songs Found, Please Scan Songs In Settings Tab "
                        HorizontalOptions="Center"
                        FontSize="16"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="3"/>
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:SongModelView">
                    <Border BackgroundColor="Transparent" Padding="2"
                                    StrokeShape="RoundRectangle 12">

                        <syncf:SfEffectsView ToolTipProperties.Text="{Binding Title}"       
                                             BackgroundColor="Transparent"                                     
                                             
                                            TouchDownEffects="Ripple,Selection" >
                            <Grid ColumnDefinitions="300,*,*,*,*,*,*"         BackgroundColor="Transparent"                                     
                                              RowDefinitions="90" ColumnSpacing="15">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="PlaySong_Tapped" x:Name="PlaySong" NumberOfTapsRequired="2"/>

                                    <PointerGestureRecognizer PointerEntered="UserHoverOnSongInColView" 
                                                            PointerExited="UserHoverOutSongInColView"
                                                              />

                                </Grid.GestureRecognizers>
                                <HorizontalStackLayout Grid.Column="0" Margin="5,0,0,0" 
                                                       HorizontalOptions="Start" 
                                        VerticalOptions="Center">
                                    <VerticalStackLayout>

                                        <Image WidthRequest="30" HeightRequest="30" HorizontalOptions="Start"  
IsVisible="{Binding HasLyrics}" Source="lyrics.png" Opacity="1"
       BackgroundColor="Transparent">

                                        </Image>

                                        <Image Source="songc.png" IsVisible="{Binding IsCurrentPlayingHighlight}"
       WidthRequest="25" Opacity="1"
       HorizontalOptions="Start">

                                        </Image>
                                    </VerticalStackLayout>
                                    <Label Text="{Binding Title}" Grid.Column="1" 
                                            FontSize="22" HorizontalOptions="Start"
                                            LineBreakMode="TailTruncation"/>


                                </HorizontalStackLayout>

                                <Label Grid.Column="1" FontSize="16" HorizontalOptions="Start"
                                    Text="{Binding ArtistName}" LineBreakMode="TailTruncation"/>

                                <Label Grid.Column="2" Text="{Binding AlbumName}" LineBreakMode="TailTruncation" 
                                               FontSize="16" />

                                <Label Grid.Column="3" HorizontalOptions="Center" LineBreakMode="TailTruncation"
                                Text="{Binding Genre}" 
                                               FontSize="16" />

                                <Label Grid.Column="4" Text="{Binding DurationInSeconds, Converter={StaticResource DurationConverter}}" 
                            HorizontalOptions="Center" FontSize="16"/>
                                <Label Grid.Column="5" HorizontalOptions="Center" Text="{Binding FileFormat}" FontSize="16" Opacity="0.8"/>
                                <Label Grid.Column="6" HorizontalOptions="Center" Text="{Binding ReleaseYear}" FontSize="16" Opacity="0.8"/>
                                

                            </Grid>

                        </syncf:SfEffectsView>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
    
</ContentPage>