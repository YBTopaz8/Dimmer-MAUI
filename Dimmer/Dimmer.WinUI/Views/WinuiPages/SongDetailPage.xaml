<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Dimmer.WinUI.Views.WinuiPages.SongDetailPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Dimmer.WinUI.Views.WinuiPages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    
    xmlns:CustomViews="using:Dimmer.WinUI.Views.CustomViews.WinuiViews"
        xmlns:converters="using:Dimmer.WinUI.Utils.Converters"
    xmlns:cw="using:Dimmer.WinUI.Views.WinuiPages"
    xmlns:dgView="using:WinUI.TableView"
    xmlns:dimmSearch="clr-namespace:Dimmer.Data.ModelView.DimmerSearch;assembly=Dimmer"
    xmlns:lang="clr-namespace:Dimmer.Resources.Localization;assembly=Dimmer"
    xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer"
    xmlns:modelsDb="clr-namespace:Dimmer.Data.Models;assembly=Dimmer"
    xmlns:modeltwo="clr-namespace:Dimmer.WinUI.Utils.Models"
    xmlns:queryBuilder="queries"
    xmlns:tql="clr-namespace:Dimmer.DimmerSearch.TQL;assembly=Dimmer"
    xmlns:vm="clr-namespace:Dimmer.WinUI.ViewModel"
    x:Name="MyPage"
    Loaded="MyPage_Loaded"
    mc:Ignorable="d">
    <Page.Resources>

        <converters:CollectionSizeToVisibility x:Key="CollectionSizeToVisibility" />
        <converters:VolumeToPercentConverter x:Key="VolumeToPercentConverter" />
        <converters:BoolToImageConverter
            x:Key="PlayPauseConverter"
            FalseValue="play.png"
            TrueValue="pause.png" />
        <converters:BoolToImageConverter
            x:Key="FavIconConverter"
            FalseValue="heartbroken.png"
            TrueValue="heartlock.png" />
    </Page.Resources>


    <Grid PointerPressed="Grid_PointerPressed">
        <Image x:Name="BgImage"
               
            Stretch="Uniform"
Opacity="0.05" 
Source="{x:Bind DetailedSong.CoverImagePath}" />
        <Grid x:Name="FgGrid">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Border Background="#111" HorizontalAlignment="Left" Width="150"
                    CornerRadius="5"
                    Grid.Row="0" Margin="10,0" Height="50" VerticalAlignment="Top">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="12" >
                    <TextBlock x:Name="CurrentSectionLabel"
                           Text="Overview" 
                           FontSize="18"
                           FontWeight="SemiBold"/>
                </StackPanel>
            </Border>
            <!--  Main content area  -->
            <ScrollViewer VerticalScrollBarVisibility="Auto" 
                      Margin="0,0,0,0" x:Name="Scroller"
                          
                          ViewChanged="ScrollViewer_ViewChanged"
                          Grid.Row="1" Background="Transparent">
                <StackPanel
            Padding="12" x:Name="SegmentStack"
            Orientation="Vertical"
            Spacing="20" >

                    <!--  The elements involved in the animation  -->

                    <Grid ColumnSpacing="10" x:Name="SectionOverview">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />

                        </Grid.ColumnDefinitions>

                        <!--  The Image that will be the target of the connected animation  -->
                        <Border
                            Width="300" Height="300"        
                            Grid.Column="0" CornerRadius="8">
                        <Image
                    x:Name="detailedImage"
                    
                    Source="{x:Bind DetailedSong.CoverImagePath}" />

                        </Border>
                        
                        <Border Grid.Column="1">

                            <StackPanel
                        x:Name="coordinatedPanel"
                        
                        Spacing="5"
                        HorizontalAlignment="Left"
                        >

                                <TextBlock
                                HorizontalAlignment="Left"
                                Style="{ThemeResource TitleTextBlockStyle}"
                                Text="{x:Bind DetailedSong.Title,Mode=OneWay}" FontSize="80" 
                                TextWrapping="Wrap" />

                                <Button
                                HorizontalAlignment="Left"                                                
                                Content="{x:Bind DetailedSong.ArtistName,Mode=OneWay}" 
                                BorderThickness="2" FontWeight="Bold"
                            Click="ArtistBtn_Click" x:Name="ArtistBtn"
                                Background="Transparent"/>
                                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,10,0,0"
                                    >

                                    <Button
                                HorizontalAlignment="Left" 
                                
                                Content="{x:Bind DetailedSong.AlbumName,Mode=OneWay}"
                                BorderThickness="2"
                            Background="Transparent"/>
                                    <TextBlock Text="{x:Bind DetailedSong.ReleaseYear,Mode=OneWay}"
                                       VerticalAlignment="Center"/>

                                </StackPanel>

                                <Button Content="{x:Bind DetailedSong.GenreName,Mode=OneWay}"
                                            BorderThickness="2"
Background="Transparent"/>
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Dimms" FontSize="19"/>

                                    <Button Content="{x:Bind DetailedSong.PlayCompletedCount,Mode=OneWay}"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="Is Fav:" FontSize="19"/>

                                    <ToggleButton Height="20" VerticalAlignment="Bottom"
                                                  CommandParameter="{Binding SelectedSong}"
                                                  Command="{x:Bind MyViewModel.AddFavoriteRatingToSongCommand}"
                                                  IsChecked="{x:Bind DetailedSong.IsFavorite,Mode=OneWay}"/>
                                </StackPanel>
                                <RichTextBlock x:Name="BioBlock" TextWrapping="Wrap"
                                               Loaded="BioBlock_Loaded"/>
                            </StackPanel>

                        </Border>
                    </Grid>

                    <StackPanel x:Name="SectionPlayback" Background="Transparent">

                        <!--<ItemsRepeater>
                            <ItemsRepeater.Layout>
                                <UniformGridLayout MaximumRowsOrColumns="3" />
                            </ItemsRepeater.Layout>

                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="White"
                                        BorderBrush="Black"
                                        BorderThickness="1"
                                        Margin="6"
                                        Padding="12">

                                        <StackPanel>
                                            
                                        <TextBlock Text="Item" Foreground="Black"/>

                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>-->

                    </StackPanel>

                    <!-- SECTION 3: LYRICS -->
                    <StackPanel x:Name="SectionLyrics" HorizontalAlignment="Left"
                                Background="Transparent">
                        <TextBlock FontWeight="ExtraBold"  Text="Lyrics Section" FontSize="34"/>
                        <ScrollViewer Height="400" VerticalScrollBarVisibility="Auto">
                            <ItemsRepeater ItemsSource="{x:Bind MyViewModel.SelectedSongLyricsObsCol}"
                                       >
                                <ItemsRepeater.ItemTemplate>
                                    <DataTemplate>
                                        <Border>
                                            <StackPanel Orientation="Horizontal"
                                                    Background="Transparent" Spacing="15">

                                                <TextBlock FontSize="26" Text="{Binding Text}"/>
                                                
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>


                                </ItemsRepeater.ItemTemplate>
                            </ItemsRepeater>
                        </ScrollViewer>
                    </StackPanel>

                    <!-- SECTION 4: ANALYTICS -->
                    <StackPanel x:Name="SectionAnalytics" Visibility="Collapsed">
                        <TextBlock  Text="Analytics Section" FontSize="34" FontWeight="ExtraBold"/>
                        
                        
                        <Button x:Name="ManualFavoriteCount" Content="{Binding SelectedSong.ManualFavoriteCount}"/>
                        <Button x:Name="PlayCompletedCount" Content="{Binding SelectedSong.PlayCompletedCount}"/>
                        <Button x:Name="PlayCount" Content="{Binding SelectedSong.PlayCount}"/>
                        <Button x:Name="PlayEventsCount" Content="{Binding SelectedSong.PlayEvents.Count}"/>
                        <Button x:Name="ListenThroughRate" Content="{Binding SelectedSong.ListenThroughRate}"/>
                        <Button x:Name="PlayStreakDays" Content="{Binding SelectedSong.PlayStreakDays}"/>
                        <Button x:Name="PreviousCount" Content="{Binding SelectedSong.PreviousCount}"/>
                        <Button x:Name="RankInAlbum" Content="{Binding SelectedSong.RankInAlbum}"/>
                        <Button x:Name="RankInArtist" Content="{Binding SelectedSong.RankInArtist}"/>
                        <Button x:Name="RepeatCount" Content="{Binding SelectedSong.RepeatCount}"/>
                        <Button x:Name="RestartCount" Content="{Binding SelectedSong.RestartCount}"/>
                        <Button x:Name="ResumeCount" Content="{Binding SelectedSong.ResumeCount}"/>
                        <Button x:Name="SeekCount" Content="{Binding SelectedSong.SeekCount}"/>
                        <Button x:Name="SkipCount" Content="{Binding SelectedSong.SkipCount}"/>
                        <Button x:Name="SkipRate" Content="{Binding SelectedSong.SkipRate}"/>
                        <Button x:Name="Rating" Content="{Binding SelectedSong.Rating}"/>
                    </StackPanel>

                    <!-- SECTION 5: HISTORY -->
                    <StackPanel x:Name="SectionHistory" Height="400" >
                        <TextBlock  Text="History Section" FontSize="34"
                                    FontWeight="ExtraBold"/>
                        
                        
                        <ItemsRepeater ItemsSource="{x:Bind DetailedSong.PlayEvents, Mode=OneWay}">
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate>
                                    <Border>
                                        <StackPanel>
                                            <TextBlock Text="{Binding PlayTypeStr}"/>
                                            <TextBlock Text="{Binding EventDate}"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>


                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </StackPanel>

                    <!-- SECTION 6: RELATED -->
                    <StackPanel x:Name="SectionRelated" Height="400" Spacing="10" >
                        <TextBlock  Text="Related Section"
                                   FontWeight="ExtraBold"
                                   FontSize="34"/>
                        <StackPanel Orientation="Horizontal" BorderThickness="1"
                                    Padding="8" Spacing="10"
                                    BorderBrush="Gray" HorizontalAlignment="Left"
                                    CornerRadius="10">

                            <TextBlock  Text="{Binding SelectedSongLastFMData.Statistics.Listeners}" FontSize="24"/>
                            <TextBlock  Text="Listeners"
                                       ToolTipService.ToolTip="Total LastFM Listeners"
                                       FontSize="24"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal"
                                    BorderThickness="1"
                                    Padding="8" Spacing="10"
                                    BorderBrush="Gray" HorizontalAlignment="Left"
                                    CornerRadius="10">

                            <TextBlock  Text="{Binding  SelectedSongLastFMData.Statistics.PlayCount}" FontSize="24"/>
                            <TextBlock  Text="Dimms"
                                       ToolTipService.ToolTip="Total LastFM Scrobbles"
                                       FontSize="24"/>
                        </StackPanel>
                            <TextBlock Text="Last FM Stats..."
                                       />
                    </StackPanel>

                </StackPanel>
            </ScrollViewer>

        </Grid>
    </Grid>
</Page>