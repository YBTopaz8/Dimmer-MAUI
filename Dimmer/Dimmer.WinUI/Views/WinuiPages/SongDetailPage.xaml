<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Dimmer.WinUI.Views.WinuiPages.SongDetailPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Dimmer.WinUI.Views.WinuiPages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    
    xmlns:CustomViews="using:Dimmer.WinUI.Views.CustomViews.WinuiViews"
        xmlns:converters="using:Dimmer.WinUI.Utils.Converters"
    xmlns:cw="using:Dimmer.WinUI.Views.WinuiPages"
    xmlns:dgView="using:WinUI.TableView"
    xmlns:dimmSearch="clr-namespace:Dimmer.Data.ModelView.DimmerSearch;assembly=Dimmer"
    xmlns:lang="clr-namespace:Dimmer.Resources.Localization;assembly=Dimmer"
    xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer"
    xmlns:modelsDb="clr-namespace:Dimmer.Data.Models;assembly=Dimmer"
    xmlns:modeltwo="clr-namespace:Dimmer.WinUI.Utils.Models"
    xmlns:queryBuilder="queries"
    xmlns:tql="clr-namespace:Dimmer.DimmerSearch.TQL;assembly=Dimmer"
    xmlns:vm="clr-namespace:Dimmer.WinUI.ViewModel"
    x:Name="MyPage"
    Loaded="MyPage_Loaded"
    mc:Ignorable="d">
    <Page.Resources>

        <converters:CollectionSizeToVisibility x:Key="CollectionSizeToVisibility" />
        <converters:VolumeToPercentConverter x:Key="VolumeToPercentConverter" />
        <converters:BoolToImageConverter
            x:Key="PlayPauseConverter"
            FalseValue="play.png"
            TrueValue="pause.png" />
        <converters:BoolToImageConverter
            x:Key="FavIconConverter"
            FalseValue="heartbroken.png"
            TrueValue="heartlock.png" />
    </Page.Resources>


    <Grid>

        <TabView
            x:Name="MainTabs"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            IsAddTabButtonVisible="False"
            SelectionChanged="MainTabs_SelectionChanged"
            TabWidthMode="Equal">
            <TabViewItem Header="Details" IsClosable="False">
                <StackPanel Orientation="Horizontal">
                    <StackPanel Grid.Column="0" Margin="12">
                        <Button
                            x:Name="BackButton"
                            Click="BackButton_Click"
                            Content="&#xE72B;"
                            FontFamily="Segoe MDL2 Assets" />
                    </StackPanel>

                    <!--  Main content area  -->
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel
                            Padding="24"
                            Orientation="Vertical"
                            Spacing="20">

                            <!--  The elements involved in the animation  -->
                            <Grid ColumnSpacing="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />

                                </Grid.ColumnDefinitions>
                                <!--  The Image that will be the target of the connected animation  -->
                                <Image
                                    x:Name="detailedImage"
                                    Grid.Column="0"
                                    Width="300"
                                    Height="300"
                                    Source="{x:Bind DetailedSong.CoverImagePath}" />

                                <Border Grid.Column="1">
                                    <StackPanel Orientation="Horizontal">
                                        <StackPanel Orientation="Horizontal" Spacing="10">
                                            <CustomViews:HoverCardControl />
                                            <CustomViews:HoverCardControl />
                                            <CustomViews:HoverCardControl />
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <Button
                                                x:Name="ToggleViewArtist"
                                                Padding="10"
                                                HorizontalAlignment="Left"
                                                Background="Transparent"
                                                BorderThickness="1"
                                                Click="ToggleViewArtist_Clicked"
                                                Content="{x:Bind MyViewModel.SelectedSong.OtherArtistsName}"
                                                FontSize="19" />
                                            <Button
                                                x:Name="ToggleViewAlbum"
                                                Padding="10"
                                                HorizontalAlignment="Left"
                                                Background="Transparent"
                                                BorderThickness="1"
                                                Click="ToggleViewAlbum_Clicked"
                                                Content="{x:Bind MyViewModel.SelectedSong.AlbumName}"
                                                FontSize="12" />

                                            <Image Height="60" Visibility="{x:Bind MyViewModel.SelectedSong.SyncLyrics.Length, Converter={StaticResource CollectionSizeToVisibility}}" />
                                        </StackPanel>
                                        <Button
                                            x:Name="SongTitle"
                                            Padding="10"
                                            HorizontalAlignment="Stretch"
                                            Background="Transparent"
                                            BorderThickness="1"
                                            Content="{x:Bind MyViewModel.SelectedSong.Title}"
                                            FontSize="29">
                                            <Button.Triggers />
                                        </Button>

                                        <StackPanel Orientation="Horizontal">
                                            <Button
                                                Width="60"
                                                Height="60"
                                                Click="PlaySongGestRec_Tapped">
                                                <Button.Content>
                                                    <Image
                                                        Width="40"
                                                        Height="40"
                                                        Source="{x:Bind MyViewModel.IsDimmerPlaying, Converter={StaticResource PlayPauseConverter}}" />
                                                </Button.Content>
                                            </Button>

                                            <Button
                                                Width="60"
                                                Height="60"
                                                Command="{x:Bind MyViewModel.AddFavoriteRatingToSongCommand}"
                                                CommandParameter="{x:Bind MyViewModel.SelectedSong}">
                                                <Button.Content>
                                                    <Image
                                                        Width="35"
                                                        Height="35"
                                                        Source="{x:Bind MyViewModel.SelectedSong.IsFavorite, Converter={StaticResource FavIconConverter}}" />
                                                </Button.Content>
                                            </Button>

                                        </StackPanel>
                                    </StackPanel>

                                </Border>
                            </Grid>

                            <!--  This panel's animation will be coordinated with the main one  -->
                            <StackPanel
                                x:Name="coordinatedPanel"
                                HorizontalAlignment="Center"
                                Spacing="5">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    Style="{ThemeResource TitleTextBlockStyle}"
                                    Text="{x:Bind DetailedSong.Title}"
                                    TextWrapping="Wrap" />
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    Style="{ThemeResource SubtitleTextBlockStyle}"
                                    Text="{x:Bind DetailedSong.ArtistName}"
                                    TextWrapping="Wrap" />
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    Style="{ThemeResource BodyStrongTextBlockStyle}"
                                    Text="{x:Bind DetailedSong.AlbumName}"
                                    TextWrapping="Wrap" />
                            </StackPanel>

                            <!--  More info can go here  -->
                            <StackPanel x:Name="secondPanel" Margin="0,20,0,0">
                                <TextBlock Style="{ThemeResource SubheaderTextBlockStyle}" Text="More Details..." />
                                <!--  Add more details like Genre, Year, etc.  -->
                            </StackPanel>

                        </StackPanel>
                    </ScrollViewer>
                </StackPanel>
            </TabViewItem>

            <!--  === TAB 1 : SEARCH RESULTS ===  -->
            <TabViewItem
                BringIntoViewRequested="TabViewItem_BringIntoViewRequested"
                CloseRequested="TabViewItem_CloseRequested"
                Header="Search Results"
                Loaded="TabViewItem_Loaded"
                Unloaded="TabViewItem_Unloaded">
                <ListView
                    x:Name="ResultsList"
                    Padding="10"
                    IsItemClickEnabled="True"
                    ItemClick="ResultsList_ItemClick"
                    ItemsSource="{x:Bind MyViewModel.SearchResults, Mode=OneWay}"
                    SelectionMode="Single">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="8" ColumnDefinitions="Auto,*">
                                <Image
                                    Width="64"
                                    Height="64"
                                    Source="{Binding CoverImagePath}"
                                    Stretch="UniformToFill" />
                                <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                    <TextBlock FontWeight="SemiBold" Text="{Binding Title}" />
                                    <TextBlock
                                        FontSize="14"
                                        Opacity="0.8"
                                        Text="{Binding ArtistName}" />
                                    <TextBlock
                                        FontSize="12"
                                        Opacity="0.6"
                                        Text="{Binding AlbumName}" />
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </TabViewItem>

        </TabView>
    </Grid>
</Page>