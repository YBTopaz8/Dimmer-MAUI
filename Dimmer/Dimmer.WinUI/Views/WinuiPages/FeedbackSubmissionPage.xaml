<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Dimmer.WinUI.Views.WinuiPages.FeedbackSubmissionPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:convertersWinUI="using:Dimmer.WinUI.Utils.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Dimmer.WinUI.Views.WinuiPages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:Dimmer.DimmerLive.Models;assembly=Dimmer"
    mc:Ignorable="d">
    <Page.Resources>
        <ResourceDictionary>
            <convertersWinUI:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <convertersWinUI:BoolToInverseConverter x:Key="BoolToInverseConverter" />
            <convertersWinUI:StatusToColorConverter x:Key="StatusToColorConverter" />
            <convertersWinUI:TypeToColorConverter x:Key="TypeToColorConverter" />
        </ResourceDictionary>
    </Page.Resources>
    <ScrollViewer Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <StackPanel MaxWidth="800" Padding="20">
            <!-- Header -->
            <Button
                x:Name="BackBtn"
                Background="DarkSlateBlue"
                BorderBrush="DarkSlateBlue"
                Click="BackBtn_Click"
                Content="Back"
                CornerRadius="0,5,5,0" />

            <TextBlock
                Margin="0,20,0,0"
                FontSize="32"
                FontWeight="Bold"
                Text="Submit Feedback" />
            <TextBlock
                Margin="0,5,0,20"
                FontSize="14"
                Foreground="Gray"
                Text="Help us improve Dimmer by reporting bugs or requesting features" />

            <!-- Form -->
            <StackPanel Spacing="15">
                <!-- Issue Type -->
                <StackPanel>
                    <TextBlock
                        Margin="0,0,0,5"
                        FontSize="16"
                        FontWeight="SemiBold"
                        Text="Type *" />
                    <ComboBox
                        x:Name="TypeComboBox"
                        Width="200"
                        HorizontalAlignment="Left"
                        ItemsSource="{Binding IssueTypes}"
                        SelectedItem="{Binding SelectedType, Mode=TwoWay}" />
                </StackPanel>

                <!-- Platform -->
                <StackPanel>
                    <TextBlock
                        Margin="0,0,0,5"
                        FontSize="16"
                        FontWeight="SemiBold"
                        Text="Platform *" />
                    <ComboBox
                        x:Name="PlatformComboBox"
                        Width="200"
                        HorizontalAlignment="Left"
                        ItemsSource="{Binding Platforms}"
                        SelectedItem="{Binding SelectedPlatform, Mode=TwoWay}" />
                </StackPanel>

                <!-- Title -->
                <StackPanel>
                    <TextBlock
                        Margin="0,0,0,5"
                        FontSize="16"
                        FontWeight="SemiBold"
                        Text="Title *" />
                    <TextBox
                        x:Name="TitleTextBox"
                        MaxLength="150"
                        PlaceholderText="Brief description of the issue or feature"
                        Text="{Binding Title, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        TextChanged="TitleTextBox_TextChanged" />
                    <TextBlock
                        Margin="0,5,0,0"
                        FontSize="12"
                        Foreground="Gray"
                        Text="{Binding Title.Length, StringFormat='{0}/150 characters'}" />
                </StackPanel>

                <!-- Similar Issues Warning -->
                <Border
                    Padding="15"
                    Background="#FFF3CD"
                    BorderBrush="#FFD700"
                    BorderThickness="1"
                    CornerRadius="5"
                    Visibility="{Binding HasSimilarIssues, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Spacing="10">
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <FontIcon
                                FontSize="16"
                                Foreground="#856404"
                                Glyph="&#xE7BA;" />
                            <TextBlock
                                FontSize="14"
                                FontWeight="SemiBold"
                                Foreground="#856404"
                                Text="Similar issues found. Please check before submitting:" />
                        </StackPanel>
                        <ItemsControl ItemsSource="{Binding SimilarIssues}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="models:FeedbackIssue">
                                    <Border
                                        Margin="0,5,0,0"
                                        Padding="10"
                                        Background="White"
                                        CornerRadius="4"
                                        PointerPressed="SimilarIssue_PointerPressed"
                                        Tag="{Binding}">
                                        <StackPanel>
                                            <TextBlock
                                                FontSize="14"
                                                FontWeight="SemiBold"
                                                Text="{Binding Title}" />
                                            <StackPanel Margin="0,5,0,0" Orientation="Horizontal">
                                                <Border
                                                    Padding="5,2"
                                                    Background="{Binding Type, Converter={StaticResource TypeToColorConverter}}"
                                                    CornerRadius="3"
                                                    Margin="0,0,5,0">
                                                    <TextBlock
                                                        FontSize="10"
                                                        FontWeight="SemiBold"
                                                        Foreground="White"
                                                        Text="{Binding Type}" />
                                                </Border>
                                                <TextBlock
                                                    FontSize="12"
                                                    Foreground="Gray"
                                                    Text="{Binding UpvoteCount, StringFormat='â†‘ {0} upvotes'}" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Description -->
                <StackPanel>
                    <TextBlock
                        Margin="0,0,0,5"
                        FontSize="16"
                        FontWeight="SemiBold"
                        Text="Description *" />
                    <TextBox
                        x:Name="DescriptionTextBox"
                        Height="200"
                        AcceptsReturn="True"
                        PlaceholderText="Provide detailed information about the bug or feature request..."
                        Text="{Binding Description, Mode=TwoWay}"
                        TextWrapping="Wrap" />
                </StackPanel>

                <!-- Submit Buttons -->
                <StackPanel
                    Margin="0,20,0,0"
                    Orientation="Horizontal"
                    Spacing="10">
                    <Button
                        Click="SubmitButton_Click"
                        Content="Submit"
                        IsEnabled="{Binding IsSubmitting, Converter={StaticResource BoolToInverseConverter}}"
                        Style="{StaticResource AccentButtonStyle}" />
                    <Button Click="CancelButton_Click" Content="Cancel" />
                    <ProgressRing
                        Width="24"
                        Height="24"
                        IsActive="{Binding IsSubmitting}" />
                </StackPanel>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Page>
