<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Dimmer.WinUI.Views.WinuiPages.LibraryStatsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Dimmer.Data.ModelView"
    xmlns:lvc="using:LiveChartsCore.SkiaSharpView.WinUI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>

        <!--  Card Container  -->
        <!--  Stat Card Style  -->
        <Style x:Key="StatCardStyle" TargetType="Grid">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}" />
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,12,12" />
        </Style>

        <!--  Small Data Point Style (Label + Value)  -->
        <Style x:Key="DataLabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}" />
            <Setter Property="FontSize" Value="12" />
        </Style>
        <Style x:Key="DataValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,0,8" />
        </Style>

        <Style x:Key="StatCard" TargetType="Grid">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}" />
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,12,12" />
        </Style>

        <!--  Typography  -->
        <Style
            x:Key="HeaderSecondary"
            BasedOn="{StaticResource CaptionTextBlockStyle}"
            TargetType="TextBlock">
            <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}" />
            <Setter Property="Margin" Value="0,0,0,4" />
        </Style>
        <Style
            x:Key="HeaderPrimary"
            BasedOn="{StaticResource SubtitleTextBlockStyle}"
            TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>
        <Style x:Key="BigValue" TargetType="TextBlock">
            <Setter Property="FontSize" Value="28" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Foreground" Value="{ThemeResource AccentTextFillColorPrimaryBrush}" />
        </Style>

        <!--  List Item Template for Top Stats  -->
        <DataTemplate x:Key="RankedItemTemplate" x:DataType="local:DimmerStats">
            <Grid
                Padding="0,8"
                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                BorderThickness="0,0,0,1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <TextBlock
                        FontWeight="SemiBold"
                        Text="{x:Bind Name}"
                        TextTrimming="CharacterEllipsis" />
                    <!--  Contextual info based on what's available  -->
                    <TextBlock
                        FontSize="11"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Text="{x:Bind Song.ArtistName}"
                        Visibility="{x:Bind Song, Converter={StaticResource BoolToVis}, FallbackValue=Collapsed}" />
                </StackPanel>

                <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                    <TextBlock
                        HorizontalAlignment="Right"
                        FontWeight="Bold"
                        Text="{x:Bind Count}"
                        Visibility="{x:Bind Count, Converter={StaticResource BoolToVis}}" />
                    <TextBlock
                        HorizontalAlignment="Right"
                        FontWeight="Bold"
                        Text="{x:Bind TotalSecondsNumeric, Converter={StaticResource DurationConverter}}"
                        Visibility="{x:Bind TotalSecondsNumeric, Converter={StaticResource BoolToVis}}" />
                </StackPanel>
            </Grid>
        </DataTemplate>
        <!--  List Item Template for Top Stats  -->
        <DataTemplate x:Key="RankedSongTemplate" x:DataType="local:DimmerStats">
            <Grid
                Padding="0,8"
                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                BorderThickness="0,0,0,1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <TextBlock
                        FontWeight="SemiBold"
                        Text="{x:Bind Song.Title}"
                        TextTrimming="CharacterEllipsis" />
                    <!--  Contextual info based on what's available  -->
                    <TextBlock
                        FontSize="11"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Text="{x:Bind Song.ArtistName}" />
                </StackPanel>

                <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                    <TextBlock
                        HorizontalAlignment="Right"
                        FontWeight="Bold"
                        Text="{x:Bind Count}" />
                    <TextBlock
                        HorizontalAlignment="Right"
                        FontWeight="Light"
                        Text="{x:Bind Song.DurationFormatted}" />
                </StackPanel>
            </Grid>
        </DataTemplate>
    </Page.Resources>

    <ScrollViewer>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!--  Header  -->
                <Grid
                    Grid.Row="0"
                    Padding="24,16"
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                    BorderThickness="0,0,0,1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Button Margin="0,0,12,0" Click="BackBtnClick">
                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE72B;" />
                    </Button>

                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Style="{ThemeResource TitleTextBlockStyle}" Text="Library Analytics" />
                        <TextBlock
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Style="{ThemeResource CaptionTextBlockStyle}"
                            Text="{x:Bind ViewModel.Stats.Subtitle, Mode=OneWay}" />
                    </StackPanel>
                    <StackPanel Grid.Column="2">
                        <Button Content="Refresh All"
                                Command="{x:Bind ViewModel.LoadLibraryStatsCommand}"/>
                        <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" />
                    </StackPanel>
                </Grid>

                <!--  Main Content  -->
                <Pivot Grid.Row="1" Padding="24,12,24,0">

                    <!--  TAB 1: LIBRARY HEALTH (Collection Summary)  -->
                    <PivotItem Header="Library Health">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <Grid RowSpacing="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <!--  Big KPIs  -->
                                    <RowDefinition Height="Auto" />
                                    <!--  Metadata Stats  -->
                                    <RowDefinition Height="Auto" />
                                    <!--  Time Stats  -->
                                    <RowDefinition Height="Auto" />
                                    <!--  Outliers  -->
                                </Grid.RowDefinitions>

                                <!--  1. Big KPIs  -->
                                <Grid ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <Grid Style="{StaticResource StatCardStyle}">
                                        <StackPanel>
                                            <TextBlock Style="{StaticResource DataLabelStyle}" Text="Total Tracks" />
                                            <TextBlock
                                                FontSize="32"
                                                FontWeight="Bold"
                                                Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.TotalSongs), Mode=OneWay}" />
                                            <TextBlock
                                                FontSize="12"
                                                Foreground="Green"
                                                Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsPlayedToday), Mode=OneWay}" />
                                            <TextBlock Text="Played Today: " />
                                            <TextBlock Text="{x:Bind ViewModel.Stats.CollectionSummary.SongsPlayedToday, Mode=OneWay}" />

                                        </StackPanel>
                                    </Grid>

                                    <Grid Grid.Column="1" Style="{StaticResource StatCardStyle}">
                                        <StackPanel>
                                            <TextBlock Style="{StaticResource DataLabelStyle}" Text="Total Plays" />
                                            <TextBlock
                                                FontSize="32"
                                                FontWeight="Bold"
                                                Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.TotalPlayCount), Mode=OneWay}" />
                                            <TextBlock
                                                FontSize="12"
                                                Foreground="IndianRed"
                                                Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.TotalSkipCount), Mode=OneWay}" />
                                            <TextBlock Text="Skips: " />
                                            <TextBlock Text="{x:Bind ViewModel.Stats.CollectionSummary.TotalSkipCount, Mode=OneWay}" />
                                        </StackPanel>
                                    </Grid>

                                    <Grid Grid.Column="2" Style="{StaticResource StatCardStyle}">
                                        <StackPanel>
                                            <TextBlock Style="{StaticResource DataLabelStyle}" Text="Total Time" />
                                            <TextBlock
                                                FontSize="24"
                                                FontWeight="Bold"
                                                Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                Text="{x:Bind ViewModel.Stats.CollectionSummary.TotalListeningTime, Mode=OneWay, Converter={StaticResource DurationConverter}}"
                                                TextWrapping="Wrap" />
                                            <TextBlock FontSize="12" Text="{x:Bind FormatDouble(ViewModel.Stats.CollectionSummary.AverageDuration), Mode=OneWay}" />
                                            <TextBlock Text="Avg Song: " />
                                            <TextBlock Text="{x:Bind FormatDurationDouble(ViewModel.Stats.CollectionSummary.AverageDuration), Mode=OneWay}" />

                                        </StackPanel>
                                    </Grid>

                                    <Grid Grid.Column="3" Style="{StaticResource StatCardStyle}">
                                        <StackPanel>
                                            <TextBlock Style="{StaticResource DataLabelStyle}" Text="Quality" />
                                            <TextBlock
                                                FontSize="32"
                                                FontWeight="Bold"
                                                Foreground="Gold"
                                                Text="{x:Bind FormatDouble(ViewModel.Stats.CollectionSummary.AverageRating), Mode=OneWay}" />
                                            <TextBlock FontSize="12" Text="{x:Bind ViewModel.Stats.CollectionSummary.SongsFavorited, Mode=OneWay}" />
                                            <TextBlock Text="Favorites: " />
                                            <TextBlock Text="{x:Bind ViewModel.Stats.CollectionSummary.SongsFavorited, Mode=OneWay}" />

                                        </StackPanel>
                                    </Grid>
                                </Grid>

                                <!--  2. Metadata Stats (Lyrics, Artists, Albums)  -->
                                <Grid Grid.Row="1" Style="{StaticResource StatCardStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Style="{StaticResource DataLabelStyle}" Text="Distinct Artists" />
                                        <TextBlock Style="{StaticResource DataValueStyle}" Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.DistinctArtists), Mode=OneWay}" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Style="{StaticResource DataLabelStyle}" Text="Distinct Albums" />
                                        <TextBlock Style="{StaticResource DataValueStyle}" Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.DistinctAlbums), Mode=OneWay}" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Style="{StaticResource DataLabelStyle}" Text="With Lyrics" />
                                        <TextBlock Style="{StaticResource DataValueStyle}" Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsWithLyrics), Mode=OneWay}" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="3">
                                        <TextBlock Style="{StaticResource DataLabelStyle}" Text="Synced Lyrics" />
                                        <TextBlock Style="{StaticResource DataValueStyle}" Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsWithSyncedLyrics), Mode=OneWay}" />
                                    </StackPanel>
                                </Grid>

                                <!--  3. Collection Timeline & Behavior  -->
                                <Grid Grid.Row="2" ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <Grid Style="{StaticResource StatCardStyle}">
                                        <StackPanel Spacing="8">
                                            <TextBlock
                                                Margin="0,0,0,8"
                                                Style="{StaticResource SubtitleTextBlockStyle}"
                                                Text="Collection Timeline" />

                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel>
                                                    <TextBlock Style="{StaticResource DataLabelStyle}" Text="Earliest Added" />
                                                    <TextBlock Style="{StaticResource DataValueStyle}" Text="{x:Bind FormatDate(ViewModel.Stats.CollectionSummary.EarliestAdded), Mode=OneWay}" />
                                                </StackPanel>
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Style="{StaticResource DataLabelStyle}" Text="Latest Added" />
                                                    <TextBlock Style="{StaticResource DataValueStyle}" Text="{x:Bind FormatDate(ViewModel.Stats.CollectionSummary.LatestAdded), Mode=OneWay}" />
                                                </StackPanel>
                                            </Grid>

                                            <MenuFlyoutSeparator />

                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel>
                                                    <TextBlock Style="{StaticResource DataLabelStyle}" Text="Longest Song" />
                                                    <TextBlock Style="{StaticResource DataValueStyle}" Text="{x:Bind FormatDuration(ViewModel.Stats.CollectionSummary.LongestSongSec), Mode=OneWay}" />
                                                </StackPanel>
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Style="{StaticResource DataLabelStyle}" Text="Shortest Song" />
                                                    <TextBlock Style="{StaticResource DataValueStyle}" Text="{x:Bind FormatDuration(ViewModel.Stats.CollectionSummary.ShortestSongSec), Mode=OneWay}" />
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>

                                    <Grid Grid.Column="1" Style="{StaticResource StatCardStyle}">
                                        <StackPanel Spacing="8">
                                            <TextBlock
                                                Margin="0,0,0,8"
                                                Style="{StaticResource SubtitleTextBlockStyle}"
                                                Text="Behavior" />

                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel>
                                                    <TextBlock Style="{StaticResource DataLabelStyle}" Text="Never Played" />
                                                    <TextBlock
                                                        Foreground="Gray"
                                                        Style="{StaticResource DataValueStyle}"
                                                        Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsNeverPlayed), Mode=OneWay}" />
                                                </StackPanel>
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Style="{StaticResource DataLabelStyle}" Text="Night Owl Plays (10pm-5am)" />
                                                    <TextBlock
                                                        Foreground="Purple"
                                                        Style="{StaticResource DataValueStyle}"
                                                        Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsPlayedAtNight), Mode=OneWay}" />
                                                </StackPanel>
                                            </Grid>

                                            <MenuFlyoutSeparator />

                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel>
                                                    <TextBlock Style="{StaticResource DataLabelStyle}" Text="Completed Plays" />
                                                    <TextBlock Style="{StaticResource DataValueStyle}" Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsPlayedToCompletion), Mode=OneWay}" />
                                                </StackPanel>
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Style="{StaticResource DataLabelStyle}" Text="Unique Devices" />
                                                    <TextBlock Style="{StaticResource DataValueStyle}" Text="{x:Bind ViewModel.Stats.CollectionSummary.UniqueDevices, Mode=OneWay}" />
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>
                                </Grid>

                                <!--  4. Extreme Outliers (Most Played/Skipped)  -->
                                <Grid Grid.Row="3" Style="{StaticResource StatCardStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <!--  Separator  -->
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel>
                                        <TextBlock Style="{StaticResource DataLabelStyle}" Text="Most Played Song" />
                                        <TextBlock
                                            Style="{StaticResource DataValueStyle}"
                                            Text="{x:Bind ViewModel.Stats.CollectionSummary.MostPlayedSongTitle, Mode=OneWay, TargetNullValue='None'}"
                                            TextWrapping="Wrap" />
                                        <TextBlock
                                            FontSize="12"
                                            Foreground="Green"
                                            Text="{x:Bind ViewModel.Stats.CollectionSummary.MostPlayedSongCount, Mode=OneWay}" />
                                    </StackPanel>

                                    <Rectangle
                                        Grid.Column="1"
                                        Width="1"
                                        Margin="12,0"
                                        Fill="{ThemeResource DividerStrokeColorDefaultBrush}" />

                                    <StackPanel Grid.Column="2">
                                        <TextBlock Style="{StaticResource DataLabelStyle}" Text="Most Skipped Song" />
                                        <TextBlock
                                            Style="{StaticResource DataValueStyle}"
                                            Text="{x:Bind ViewModel.Stats.CollectionSummary.MostSkippedSongTitle, Mode=OneWay, TargetNullValue='None'}"
                                            TextWrapping="Wrap" />
                                        <TextBlock
                                            FontSize="12"
                                            Foreground="Red"
                                            Text="{x:Bind ViewModel.Stats.CollectionSummary.MostSkippedSongCount, Mode=OneWay}" />
                                    </StackPanel>
                                </Grid>

                            </Grid>
                        </ScrollViewer>
                    </PivotItem>

                    <!--  TAB 2: TOP LISTS (Text Based Rankings)  -->
                    <PivotItem Header="Leaderboards">
                        <ScrollViewer>
                            <Grid RowSpacing="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!--  Top Songs & Artists (Side by Side)  -->
                                <Grid ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Songs  -->
                                    <Grid Style="{StaticResource StatCardStyle}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock
                                            Margin="0,0,0,12"
                                            Style="{StaticResource SubtitleTextBlockStyle}"
                                            Text="Top Songs (By Play Count)" />

                                        <ItemsControl Grid.Row="1" ItemsSource="{x:Bind ViewModel.Stats.TopSongsByPlays, Mode=OneWay}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="local:DimmerStats">
                                                    <Grid Margin="0,0,0,8">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                            <TextBlock FontWeight="SemiBold" Text="{x:Bind Song.Title}" />
                                                            <TextBlock
                                                                FontSize="11"
                                                                Foreground="Gray"
                                                                Text="{x:Bind Song.ArtistName}" />
                                                        </StackPanel>
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            VerticalAlignment="Center"
                                                            FontWeight="Bold"
                                                            Text="{x:Bind Count}" />
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </Grid>

                                    <!--  Artists  -->
                                    <Grid Grid.Column="1" Style="{StaticResource StatCardStyle}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock
                                            Margin="0,0,0,12"
                                            Style="{StaticResource SubtitleTextBlockStyle}"
                                            Text="Top Artists" />
                                        <ItemsControl Grid.Row="1" ItemsSource="{x:Bind ViewModel.Stats.TopArtistsByPlays, Mode=OneWay}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="local:DimmerStats">
                                                    <Grid Margin="0,0,0,8">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock
                                                            VerticalAlignment="Center"
                                                            FontWeight="SemiBold"
                                                            Text="{x:Bind Name}" />
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            VerticalAlignment="Center"
                                                            FontWeight="Bold"
                                                            Text="{x:Bind Count}" />
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </Grid>
                                </Grid>

                                <!--  Time Sink & Skips  -->
                                <Grid Grid.Row="1" ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <Grid Style="{StaticResource StatCardStyle}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock
                                            Margin="0,0,0,12"
                                            Style="{StaticResource SubtitleTextBlockStyle}"
                                            Text="Most Time Listened (Long plays)" />
                                        <ItemsControl Grid.Row="1" ItemsSource="{x:Bind ViewModel.Stats.TopSongsByTime, Mode=OneWay}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="local:DimmerStats">
                                                    <Grid Margin="0,0,0,8">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock
                                                            FontWeight="SemiBold"
                                                            Text="{x:Bind Song.Title}"
                                                            TextTrimming="CharacterEllipsis" />
                                                        <!--  TotalSecondsNumeric needs formatted manually in ViewModel usually, or simple converter  -->
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            VerticalAlignment="Center"
                                                            Foreground="Teal"
                                                            Text="{x:Bind TotalSecondsNumeric}" />
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </Grid>

                                    <Grid Grid.Column="1" Style="{StaticResource StatCardStyle}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <TextBlock
                                            Margin="0,0,0,12"
                                            Style="{StaticResource SubtitleTextBlockStyle}"
                                            Text="Most Skipped Songs" />
                                        <ItemsControl Grid.Row="1" ItemsSource="{x:Bind ViewModel.Stats.TopSongsBySkips, Mode=OneWay}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="local:DimmerStats">
                                                    <Grid Margin="0,0,0,8">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock
                                                            FontWeight="SemiBold"
                                                            Text="{x:Bind Song.Title}"
                                                            TextTrimming="CharacterEllipsis" />
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            VerticalAlignment="Center"
                                                            Foreground="Crimson"
                                                            Text="{x:Bind Count}" />
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </Grid>
                                </Grid>
                            </Grid>
                        </ScrollViewer>
                    </PivotItem>

                    <!--  TAB 3: INSIGHTS (Burnout, Rediscovery)  -->
                    <PivotItem Header="Deep Insights">
                        <ScrollViewer>
                            <Grid RowSpacing="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                </Grid.RowDefinitions>
                                <!--  Rediscovered  -->
                                <Grid
                                    BorderBrush="Goldenrod"
                                    BorderThickness="1"
                                    Style="{StaticResource StatCardStyle}">
                                    <StackPanel>
                                        <StackPanel
                                            Margin="0,0,0,12"
                                            Orientation="Horizontal"
                                            Spacing="8">
                                            <FontIcon Foreground="Goldenrod" Glyph="&#xE81C;" />
                                            <TextBlock
                                                Foreground="Goldenrod"
                                                Style="{StaticResource SubtitleTextBlockStyle}"
                                                Text="Rediscovered Gems (Long gap between plays)" />
                                        </StackPanel>
                                        <ItemsControl ItemsSource="{x:Bind ViewModel.Stats.TopRediscoveredSongs, Mode=OneWay}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="local:DimmerStats">
                                                    <Grid Margin="0,0,0,8">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Text="{Binding Song.Title}" />
                                                        <TextBlock Grid.Column="1" Foreground="Gray" />
                                                        <TextBlock Text="{Binding Value}" />
                                                        <TextBlock Text="days gap" />
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Grid>

                                <!--  Burnout  -->
                                <Grid
                                    Grid.Row="1"
                                    BorderBrush="DarkSlateGray"
                                    BorderThickness="1"
                                    Style="{StaticResource StatCardStyle}">
                                    <StackPanel>
                                        <StackPanel
                                            Margin="0,0,0,12"
                                            Orientation="Horizontal"
                                            Spacing="8">
                                            <FontIcon Foreground="DarkSlateGray" Glyph="&#xE106;" />
                                            <TextBlock
                                                Foreground="DarkSlateGray"
                                                Style="{StaticResource SubtitleTextBlockStyle}"
                                                Text="Burnout Tracks (High Skip Rate Recently)" />
                                        </StackPanel>
                                        <ItemsControl ItemsSource="{x:Bind ViewModel.Stats.TopBurnoutSongs, Mode=OneWay}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="local:DimmerStats">
                                                    <Grid Margin="0,0,0,8">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Text="{x:Bind Song.Title}" />
                                                        <!--  Value here represents Skip Rate %  -->
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            Foreground="Red"
                                                            Text="{x:Bind Value}" />
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Grid>

                                <!--  Charts placeholder  -->
                                <TextBlock
                                    Margin="0,24"
                                    HorizontalAlignment="Center"
                                    Foreground="Gray"
                                    Text="Charts can be added here later." />
                            </Grid>
                        </ScrollViewer>
                    </PivotItem>

                </Pivot>
            </Grid>
            <Grid Grid.Row="1" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!--  Header  -->
                <Grid
                    Grid.Row="0"
                    Padding="24,16"
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                    BorderThickness="0,0,0,1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Button Margin="0,0,12,0" Click="BackBtnClick">
                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE72B;" />
                    </Button>
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Style="{ThemeResource TitleTextBlockStyle}" Text="Library Analytics" />
                        <TextBlock
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Style="{ThemeResource CaptionTextBlockStyle}"
                            Text="{x:Bind ViewModel.Stats.Subtitle, Mode=OneWay}" />
                    </StackPanel>
                    <ProgressRing Grid.Column="2" IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" />
                </Grid>

                <!--  Content  -->
                <Pivot Grid.Row="1" Padding="24,12,24,0">

                    <!--  ==================================================================  -->
                    <!--  TAB 1: OVERVIEW (The Big Numbers)  -->
                    <!--  ==================================================================  -->
                    <PivotItem Header="Overview">
                        <ScrollViewer>
                            <Grid RowSpacing="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <!--  KPIs  -->
                                    <RowDefinition Height="Auto" />
                                    <!--  Collection Meta  -->
                                    <RowDefinition Height="Auto" />
                                    <!--  Extremes  -->
                                </Grid.RowDefinitions>

                                <!--  1. KPI Cards  -->
                                <Grid ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <Grid Style="{StaticResource StatCard}">
                                        <StackPanel>
                                            <TextBlock Style="{StaticResource HeaderSecondary}" Text="Listening Time" />
                                            <TextBlock
                                                Style="{StaticResource BigValue}"
                                                Text="{x:Bind FormatDurationDouble(ViewModel.Stats.CollectionSummary.TotalListeningTime), Mode=OneWay}"
                                                TextWrapping="Wrap" />
                                        </StackPanel>
                                    </Grid>
                                    <Grid Grid.Column="1" Style="{StaticResource StatCard}">
                                        <StackPanel>
                                            <TextBlock Style="{StaticResource HeaderSecondary}" Text="Total Plays" />
                                            <TextBlock Style="{StaticResource BigValue}" Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.TotalPlayCount), Mode=OneWay}" />
                                        </StackPanel>
                                    </Grid>
                                    <Grid Grid.Column="2" Style="{StaticResource StatCard}">
                                        <StackPanel>
                                            <TextBlock Style="{StaticResource HeaderSecondary}" Text="Collection Size" />
                                            <TextBlock Style="{StaticResource BigValue}" Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.TotalSongs), Mode=OneWay}" />
                                            <TextBlock
                                                FontSize="11"
                                                Foreground="Gray"
                                                Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.DistinctArtists), Mode=OneWay}" />
                                            <TextBlock Text="Artists: " />
                                            <TextBlock Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.DistinctArtists), Mode=OneWay}" />

                                        </StackPanel>
                                    </Grid>
                                    <Grid Grid.Column="3" Style="{StaticResource StatCard}">
                                        <StackPanel>
                                            <TextBlock Style="{StaticResource HeaderSecondary}" Text="Quality Score" />
                                            <TextBlock
                                                Foreground="Gold"
                                                Style="{StaticResource BigValue}"
                                                Text="{x:Bind FormatDouble(ViewModel.Stats.CollectionSummary.AverageRating), Mode=OneWay}" />
                                            <TextBlock
                                                FontSize="11"
                                                Foreground="Gray"
                                                Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsFavorited), Mode=OneWay}" />
                                            <TextBlock Text="Favorites: " />
                                            <TextBlock Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsFavorited), Mode=OneWay}" />

                                        </StackPanel>
                                    </Grid>
                                </Grid>

                                <!--  2. Collection Metadata Grid  -->
                                <Grid Grid.Row="1" ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="2*" />
                                        <ColumnDefinition Width="1*" />
                                    </Grid.ColumnDefinitions>

                                    <Grid Style="{StaticResource StatCard}">
                                        <StackPanel>
                                            <TextBlock Style="{StaticResource HeaderPrimary}" Text="Library Composition" />
                                            <VariableSizedWrapGrid
                                                ItemHeight="60"
                                                ItemWidth="140"
                                                Orientation="Horizontal">

                                                <StackPanel Margin="0,0,12,12">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="Gray"
                                                        Text="Albums" />
                                                    <TextBlock
                                                        FontSize="18"
                                                        FontWeight="SemiBold"
                                                        Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.DistinctAlbums), Mode=OneWay}" />
                                                </StackPanel>

                                                <StackPanel Margin="0,0,12,12">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="Gray"
                                                        Text="Lyrics Available" />
                                                    <TextBlock
                                                        FontSize="18"
                                                        FontWeight="SemiBold"
                                                        Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsWithLyrics), Mode=OneWay}" />
                                                </StackPanel>

                                                <StackPanel Margin="0,0,12,12">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="Gray"
                                                        Text="Synced Lyrics" />
                                                    <TextBlock
                                                        FontSize="18"
                                                        FontWeight="SemiBold"
                                                        Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsWithSyncedLyrics), Mode=OneWay}" />
                                                </StackPanel>

                                                <StackPanel Margin="0,0,12,12">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="Gray"
                                                        Text="Devices Used" />
                                                    <TextBlock
                                                        FontSize="18"
                                                        FontWeight="SemiBold"
                                                        Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.UniqueDevices), Mode=OneWay}" />
                                                </StackPanel>

                                                <StackPanel Margin="0,0,12,12">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="Gray"
                                                        Text="Completed Plays" />
                                                    <TextBlock
                                                        FontSize="18"
                                                        FontWeight="SemiBold"
                                                        Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsPlayedToCompletion), Mode=OneWay}" />
                                                </StackPanel>

                                                <StackPanel Margin="0,0,12,12">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="Gray"
                                                        Text="Days Active" />
                                                    <TextBlock
                                                        FontSize="18"
                                                        FontWeight="SemiBold"
                                                        Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.TotalDaysActive), Mode=OneWay}" />
                                                </StackPanel>
                                            </VariableSizedWrapGrid>
                                        </StackPanel>
                                    </Grid>

                                    <Grid Grid.Column="1" Style="{StaticResource StatCard}">
                                        <StackPanel>
                                            <TextBlock Style="{StaticResource HeaderPrimary}" Text="Timelines" />
                                            <Grid RowSpacing="12">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition />
                                                    <RowDefinition />
                                                    <RowDefinition />
                                                    <RowDefinition />
                                                </Grid.RowDefinitions>

                                                <StackPanel>
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="Gray"
                                                        Text="Oldest Track" />
                                                    <TextBlock Text="{x:Bind FormatDate(ViewModel.Stats.CollectionSummary.EarliestAdded), Mode=OneWay}" />
                                                </StackPanel>

                                                <StackPanel Grid.Row="1">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="Gray"
                                                        Text="Newest Track" />
                                                    <TextBlock Text="{x:Bind FormatDate(ViewModel.Stats.CollectionSummary.LatestAdded), Mode=OneWay}" />
                                                </StackPanel>

                                                <StackPanel Grid.Row="2">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="Gray"
                                                        Text="Longest Duration" />
                                                    <TextBlock Text="{x:Bind FormatDurationShort(ViewModel.Stats.CollectionSummary.LongestSongSec), Mode=OneWay}" />
                                                </StackPanel>

                                                <StackPanel Grid.Row="3">
                                                    <TextBlock
                                                        FontSize="11"
                                                        Foreground="Gray"
                                                        Text="Shortest Duration" />
                                                    <TextBlock Text="{x:Bind FormatDurationShort(ViewModel.Stats.CollectionSummary.ShortestSongSec), Mode=OneWay}" />
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>
                                </Grid>

                                <!--  3. The Extremes (Most Played vs Skipped)  -->
                                <Grid Grid.Row="2" Style="{StaticResource StatCard}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <!--  Divider  -->
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Padding="0,0,12,0">
                                        <TextBlock
                                            Foreground="Teal"
                                            Style="{StaticResource HeaderSecondary}"
                                            Text="Most Played Track" />
                                        <TextBlock
                                            FontSize="20"
                                            FontWeight="Bold"
                                            Text="{x:Bind ViewModel.Stats.CollectionSummary.MostPlayedSongTitle, Mode=OneWay}"
                                            TextWrapping="Wrap" />
                                        <TextBlock Foreground="Gray" Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.MostPlayedSongCount), Mode=OneWay}" />
                                        <TextBlock Text="Plays:" />
                                        <TextBlock Text="{x:Bind ViewModel.Stats.CollectionSummary.MostPlayedSongCount, Mode=OneWay}" />

                                    </StackPanel>

                                    <Rectangle
                                        Grid.Column="1"
                                        Width="1"
                                        Margin="0,4"
                                        Fill="{ThemeResource DividerStrokeColorDefaultBrush}" />

                                    <StackPanel Grid.Column="2" Padding="12,0,0,0">
                                        <TextBlock
                                            Foreground="IndianRed"
                                            Style="{StaticResource HeaderSecondary}"
                                            Text="Most Skipped Track" />
                                        <TextBlock
                                            FontSize="20"
                                            FontWeight="Bold"
                                            Text="{x:Bind ViewModel.Stats.CollectionSummary.MostSkippedSongTitle, Mode=OneWay}"
                                            TextWrapping="Wrap" />
                                        <TextBlock Foreground="Gray" Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.MostSkippedSongCount), Mode=OneWay}" />
                                        <TextBlock Text="Skips:" />
                                        <TextBlock Text="{x:Bind ViewModel.Stats.CollectionSummary.MostSkippedSongCount, Mode=OneWay}" />

                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </ScrollViewer>
                    </PivotItem>

                    <!--  ==================================================================  -->
                    <!--  TAB 2: LEADERBOARDS (Lists of Top Songs, Artists, Albums)  -->
                    <!--  ==================================================================  -->
                    <PivotItem Header="Leaderboards">
                        <ScrollViewer>
                            <Grid ColumnSpacing="12" RowSpacing="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!--  Top Songs  -->
                                <Grid Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Style="{StaticResource HeaderPrimary}" Text="Top Songs" />
                                        <ItemsControl ItemTemplate="{StaticResource RankedSongTemplate}" ItemsSource="{x:Bind ViewModel.Stats.TopSongsByPlays, Mode=OneWay}" />
                                    </StackPanel>
                                </Grid>

                                <!--  Top Artists  -->
                                <Grid Grid.Column="1" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Style="{StaticResource HeaderPrimary}" Text="Top Artists" />
                                        <ItemsControl ItemTemplate="{StaticResource RankedItemTemplate}" ItemsSource="{x:Bind ViewModel.Stats.TopArtistsByPlays, Mode=OneWay}" />
                                    </StackPanel>
                                </Grid>

                                <!--  Top Albums  -->
                                <Grid Grid.Column="2" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Style="{StaticResource HeaderPrimary}" Text="Top Albums" />
                                        <ItemsControl ItemTemplate="{StaticResource RankedItemTemplate}" ItemsSource="{x:Bind ViewModel.Stats.TopAlbumsByPlays, Mode=OneWay}" />
                                    </StackPanel>
                                </Grid>

                                <!--  Top By Time  -->
                                <Grid
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Grid.ColumnSpan="2"
                                    Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Style="{StaticResource HeaderPrimary}" Text="Longest Time Listened (The Binge List)" />
                                        <ItemsControl ItemTemplate="{StaticResource RankedSongTemplate}" ItemsSource="{x:Bind ViewModel.Stats.TopSongsByTime, Mode=OneWay}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <VariableSizedWrapGrid MaximumRowsOrColumns="5" Orientation="Vertical" />
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                        </ItemsControl>
                                    </StackPanel>
                                </Grid>

                                <!--  Variety Artists  -->
                                <Grid
                                    Grid.Row="1"
                                    Grid.Column="2"
                                    Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Style="{StaticResource HeaderPrimary}" Text="Deepest Discographies" />
                                        <TextBlock
                                            Margin="0,-8,0,8"
                                            FontSize="11"
                                            Foreground="Gray"
                                            Text="(Artists by Song Variety)" />
                                        <ItemsControl ItemTemplate="{StaticResource RankedItemTemplate}" ItemsSource="{x:Bind ViewModel.Stats.TopArtistsByVariety, Mode=OneWay}" />
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </ScrollViewer>
                    </PivotItem>

                    <!--  ==================================================================  -->
                    <!--  TAB 3: HABITS (Time, Days, Routine)  -->
                    <!--  ==================================================================  -->
                    <PivotItem Header="Habits">
                        <ScrollViewer>
                            <Grid ColumnSpacing="12" RowSpacing="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!--  Time Stats  -->
                                <Grid Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Style="{StaticResource HeaderPrimary}" Text="Temporal Habits" />
                                        <Grid RowSpacing="8">
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>

                                            <Grid>
                                                <TextBlock Text="Songs Played Today" />
                                                <TextBlock
                                                    HorizontalAlignment="Right"
                                                    FontWeight="Bold"
                                                    Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsPlayedToday), Mode=OneWay}" />
                                            </Grid>

                                            <Grid Grid.Row="1">
                                                <TextBlock Text="Night Owl (10PM - 5AM)" />
                                                <TextBlock
                                                    HorizontalAlignment="Right"
                                                    FontWeight="Bold"
                                                    Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsPlayedAtNight), Mode=OneWay}" />
                                            </Grid>

                                            <Grid Grid.Row="2">
                                                <TextBlock Text="Average Track Length" />
                                                <TextBlock
                                                    HorizontalAlignment="Right"
                                                    FontWeight="Bold"
                                                    Text="{x:Bind FormatDurationDouble(ViewModel.Stats.CollectionSummary.AverageDuration), Mode=OneWay}" />
                                            </Grid>
                                        </Grid>
                                        <ProgressBar
                                            Height="2"
                                            Margin="0,4,0,0"
                                            Maximum="100"
                                            Value="{x:Bind ViewModel.Stats.CollectionSummary.SongsPlayedToday, Mode=OneWay}" />

                                    </StackPanel>
                                </Grid>

                                <!--  Week Breakdown (Text List)  -->
                                <Grid Grid.Column="1" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Style="{StaticResource HeaderPrimary}" Text="Daily Routine" />
                                        <ItemsControl ItemsSource="{x:Bind ViewModel.Stats.OverallListeningByDayOfWeek, Mode=OneWay}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="local:DimmerStats">
                                                    <Grid Margin="0,4">
                                                        <TextBlock Text="{x:Bind XValue}" />
                                                        <!--  Day Name  -->
                                                        <TextBlock
                                                            HorizontalAlignment="Right"
                                                            FontWeight="Bold"
                                                            Text="{x:Bind YValue}" />
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Grid>

                                <!--  Routine OHLC (Simplified as List)  -->
                                <Grid
                                    Grid.Row="1"
                                    Grid.ColumnSpan="2"
                                    Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Style="{StaticResource HeaderPrimary}" Text="Daily Listening Window (Start - End Hour)" />
                                        <ItemsControl ItemsSource="{x:Bind ViewModel.Stats.DailyListeningRoutineOHLC, Mode=OneWay}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <VariableSizedWrapGrid
                                                        ItemHeight="60"
                                                        ItemWidth="150"
                                                        Orientation="Horizontal" />
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="local:DimmerStats">
                                                    <Border
                                                        Margin="0,0,8,8"
                                                        Padding="8"
                                                        BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                                        BorderThickness="1"
                                                        CornerRadius="4">
                                                        <StackPanel>
                                                            <TextBlock FontWeight="SemiBold" Text="{Binding Name}" />
                                                            <!--  Date/Day  -->
                                                            <TextBlock FontSize="12" Foreground="Gray">
                                                                <Run Text="{Binding Low}" />
                                                                :00 -<Run Text="{Binding Close}" />
                                                                :00</TextBlock>
                                                        </StackPanel>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </ScrollViewer>
                    </PivotItem>

                    <!--  ==================================================================  -->
                    <!--  TAB 4: INSIGHTS (Negative Stats & Special Lists)  -->
                    <!--  ==================================================================  -->
                    <PivotItem Header="Insights">
                        <ScrollViewer>
                            <Grid ColumnSpacing="12" RowSpacing="12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!--  Burnout  -->
                                <Grid BorderBrush="Gray" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <StackPanel
                                            Margin="0,0,0,12"
                                            Orientation="Horizontal"
                                            Spacing="8">
                                            <FontIcon Foreground="Gray" Glyph="&#xE106;" />
                                            <TextBlock
                                                Margin="0"
                                                Style="{StaticResource HeaderPrimary}"
                                                Text="Burnout Tracks" />
                                        </StackPanel>
                                        <TextBlock
                                            Margin="0,-8,0,8"
                                            FontSize="11"
                                            Foreground="Gray"
                                            Text="High skip rate recently" />
                                        <ItemsControl ItemTemplate="{StaticResource RankedItemTemplate}" ItemsSource="{x:Bind ViewModel.Stats.TopBurnoutSongs, Mode=OneWay}" />
                                    </StackPanel>
                                </Grid>

                                <!--  Rediscovered  -->
                                <Grid
                                    Grid.Column="1"
                                    BorderBrush="Goldenrod"
                                    Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <StackPanel
                                            Margin="0,0,0,12"
                                            Orientation="Horizontal"
                                            Spacing="8">
                                            <FontIcon Foreground="Goldenrod" Glyph="&#xE81C;" />
                                            <TextBlock
                                                Margin="0"
                                                Style="{StaticResource HeaderPrimary}"
                                                Text="Rediscovered" />
                                        </StackPanel>
                                        <TextBlock
                                            Margin="0,-8,0,8"
                                            FontSize="11"
                                            Foreground="Gray"
                                            Text="Long gap between plays" />
                                        <ItemsControl ItemsSource="{x:Bind ViewModel.Stats.TopRediscoveredSongs, Mode=OneWay}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="local:DimmerStats">
                                                    <Grid Padding="0,4">
                                                        <StackPanel>
                                                            <TextBlock FontWeight="SemiBold" Text="{x:Bind Song.Title}" />
                                                            <TextBlock Foreground="Goldenrod" />
                                                            <TextBlock Text="{x:Bind Value}" />
                                                            <TextBlock Text="days gap" />
                                                        </StackPanel>
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Grid>

                                <!--  Most Skipped Artists  -->
                                <Grid
                                    Grid.Column="2"
                                    BorderBrush="IndianRed"
                                    Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <StackPanel
                                            Margin="0,0,0,12"
                                            Orientation="Horizontal"
                                            Spacing="8">
                                            <FontIcon Foreground="IndianRed" Glyph="&#xE711;" />
                                            <TextBlock
                                                Margin="0"
                                                Style="{StaticResource HeaderPrimary}"
                                                Text="Skipped Artists" />
                                        </StackPanel>
                                        <ItemsControl ItemTemplate="{StaticResource RankedItemTemplate}" ItemsSource="{x:Bind ViewModel.Stats.TopArtistsBySkips, Mode=OneWay}" />
                                    </StackPanel>
                                </Grid>

                                <!--  Never Played List (Scrollable)  -->
                                <Grid
                                    Grid.Row="1"
                                    Grid.ColumnSpan="3"
                                    Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Style="{StaticResource HeaderPrimary}" Text="Collection Dust (Never Played)" />
                                        <TextBlock
                                            Margin="0,0,0,8"
                                            FontSize="24"
                                            Text="{x:Bind FormatNumber(ViewModel.Stats.CollectionSummary.SongsNeverPlayed), Mode=OneWay}" />
                                        <TextBlock Foreground="Gray" Text="These songs exist in your library but have 0 plays in this date range." />
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </ScrollViewer>
                    </PivotItem>

                </Pivot>
            </Grid>
        </Grid>
    </ScrollViewer>
</Page>
