<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Dimmer.WinUI.Views.WinuiPages.LastFMSection.LastFmPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:entities="using:Hqub.Lastfm.Entities"
    xmlns:local="using:Dimmer.WinUI.Views.WinuiPages.LastFMSection"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  1. HEADER (Profile Info)  -->
        <!--  Mimics the Android FrameLayout with Image + Scrim + Text  -->
        <Grid
            Grid.Row="0"
            Height="200"
            Margin="0,0,0,12"
            CornerRadius="0,0,12,12">
            <Grid.Background>
                <SolidColorBrush Color="#FF202020" />
            </Grid.Background>

            <!--  User Avatar / Background  -->
            <Image
                x:Name="UserAvatarImg"
                Opacity="0.6"
                Stretch="UniformToFill" />

            <!--  Dark Scrim  -->
            <Rectangle Fill="Black" Opacity="0.4" />

            <!--  Info Overlay  -->
            <StackPanel
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Spacing="4">
                <TextBlock
                    x:Name="UserNameTxt"
                    FontSize="28"
                    FontWeight="Bold"
                    Foreground="White"
                    HorizontalTextAlignment="Center"
                    Style="{StaticResource TitleTextBlockStyle}"
                    Text="Loading..." />

                <TextBlock
                    x:Name="TotalScrobblesTxt"
                    Foreground="LightGray"
                    HorizontalTextAlignment="Center"
                    Style="{StaticResource BodyTextBlockStyle}"
                    Text="0 Scrobbles" />
            </StackPanel>
        </Grid>

        <!--  2. TABS (Pivot)  -->
        <Pivot Grid.Row="1" SelectionChanged="Pivot_SelectionChanged">

            <!--  RECENT TRACKS  -->
            <PivotItem Header="Recent">
                <ListView x:Name="RecentTracksList" SelectionMode="None">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="entities:Track">
                            <Grid Height="70" Padding="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="70" />
                                    <!--  Image  -->
                                    <ColumnDefinition Width="*" />
                                    <!--  Info  -->
                                    <ColumnDefinition Width="Auto" />
                                    <!--  Status  -->
                                </Grid.ColumnDefinitions>

                                <!--  Col 0: Image  -->


                                <!--  Col 1: Title & Artist  -->
                                <StackPanel
                                    Grid.Column="1"
                                    Margin="12,0,0,0"
                                    VerticalAlignment="Center">
                                    <TextBlock
                                        FontSize="15"
                                        FontWeight="Bold"
                                        Text="{x:Bind Name}"
                                        TextTrimming="CharacterEllipsis" />
                                    <TextBlock
                                        FontSize="13"
                                        Opacity="0.7"
                                        Text="{x:Bind Artist.Name}"
                                        TextTrimming="CharacterEllipsis" />
                                </StackPanel>

                                <!--  Col 2: Status (Love & Duration)  -->
                                <StackPanel
                                    Grid.Column="2"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center">
                                    <!--  Heart Icon  -->
                                    <FontIcon
                                        Margin="0,0,0,4"
                                        HorizontalAlignment="Right"
                                        FontSize="16"
                                        Foreground="{x:Bind UserLoved, Converter={StaticResource BoolToHeartColorConverter}}"
                                        Glyph="&#xEB51;"
                                        Visibility="{x:Bind UserLoved, Converter={StaticResource BoolToVisConverter}}" />

                                    <!--  Duration or 'Playing'  -->
                                    <TextBlock
                                        HorizontalAlignment="Right"
                                        FontSize="12"
                                        Opacity="0.6"
                                        Text="{x:Bind Duration, Converter={StaticResource MsToDurationConverter}}" />
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </PivotItem>

            <!--  TOP TRACKS  -->
            <PivotItem Header="Top Tracks">
                <ListView x:Name="TopTracksList" SelectionMode="None">
                    <!--  Reuse the same DataTemplate or define a resource  -->
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="entities:Track">
                            <!--  Same Grid Layout as above  -->
                            <Grid Height="70" Padding="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="70" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel
                                    Grid.Column="1"
                                    Margin="12,0,0,0"
                                    VerticalAlignment="Center">
                                    <TextBlock FontWeight="Bold" Text="{x:Bind Name}" />
                                    <TextBlock Opacity="0.7" Text="{x:Bind Artist.Name}" />
                                </StackPanel>
                                <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                    <TextBlock
                                        HorizontalAlignment="Right"
                                        FontSize="12"
                                        Opacity="0.6"
                                        Text="{x:Bind UserPlayCount, Mode=OneWay}" />
                                    <TextBlock
                                        HorizontalAlignment="Right"
                                        FontSize="10"
                                        Opacity="0.4"
                                        Text="plays" />
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </PivotItem>

            <!--  LOVED TRACKS  -->
            <PivotItem Header="Loved">
                <ListView x:Name="LovedTracksList" SelectionMode="None">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="entities:Track">
                            <!--  Similar Layout  -->
                            <Grid Height="70" Padding="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="70" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <StackPanel
                                    Grid.Column="1"
                                    Margin="12,0,0,0"
                                    VerticalAlignment="Center">
                                    <TextBlock FontWeight="Bold" Text="{x:Bind Name}" />
                                    <TextBlock Opacity="0.7" Text="{x:Bind Artist.Name}" />
                                </StackPanel>
                                <FontIcon
                                    Grid.Column="2"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="Red"
                                    Glyph="&#xEB51;" />
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </PivotItem>

        </Pivot>
    </Grid>
</Page>
