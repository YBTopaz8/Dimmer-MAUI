<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Dimmer.WinUI.Views.WinuiPages.LastFMSection.LastFmPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dgView="using:WinUI.TableView"
    xmlns:entities="using:Hqub.Lastfm.Entities"
    xmlns:local="using:Dimmer.WinUI.Views.WinuiPages.LastFMSection"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <ScrollViewer>
        <Grid>

            <Grid
            x:Name="LastFMGridNonAuth"
            Padding="40"
            Background="Transparent">
                <StackPanel HorizontalAlignment="Center" Visibility="{Binding IsLastfmAuthenticated, Converter={StaticResource BoolToInverseVisibilityConverter}}">

                    <TextBox
                    x:Name="LastFMUname"
                    FontSize="25"
                    Header="Enter your Last FM username:"
                    KeyUp="LastFMUname_KeyUp"
                    PlaceholderText="User Name" />

                    <Button
                    Margin="0,10,0,0"
                    HorizontalAlignment="Center"
                    Background="#BE0606"
                    Click="LoginLastFM_Click"
                    Content="Login to Last FM"
                    FontSize="19"
                    FontWeight="Bold"
                    IsEnabled="{x:Bind MyViewModel.IsLastFMAuthButtonClickable , Mode=OneWay, Converter={StaticResource BoolToInverseConverter}}" />
                    <TextBlock Text="LastFM UserName Required" Visibility="{x:Bind MyViewModel.IsLastFMNeedsUsername}" />
                </StackPanel>


                <StackPanel Visibility="{x:Bind MyViewModel.IsLastfmAuthenticated, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="0.3*" />
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="1" Spacing="5">

                            <Button
                            HorizontalAlignment="Right"
                            Background="DarkRed"
                            BorderBrush="DarkRed"
                            Click="LogoutLastFM_Click"
                            Content="Logout" />


                            <Border CornerRadius="40">
                                <Image
                                Height="60"
                                Width="60"
                                Source="{x:Bind MyViewModel.CurrentUserLocal.LastFMAccountInfo.Image.Url, Mode=OneWay}"
                                Stretch="UniformToFill" />
                            </Border>
                            <TextBlock
                            Margin="0,0,0,5"
                            HorizontalAlignment="Center"
                            FontSize="24"
                            Foreground="White"
                            Text="{x:Bind MyViewModel.CurrentUserLocal.LastFMAccountInfo.RealName, Mode=OneWay}"
                            />


                            <StackPanel
                            HorizontalAlignment="Center"
                            Orientation="Horizontal"
                            Spacing="10">
                                <TextBlock
                                Margin="0,0,0,5"
                                FontSize="24"
                                Foreground="White"
                                Text="{x:Bind MyViewModel.CurrentUserLocal.LastFMAccountInfo.Playcount, Mode=OneWay}"
                                />
                                <TextBlock
                                Margin="0,0,0,5"
                                HorizontalAlignment="Center"
                                FontSize="24"
                                Foreground="White"
                                Text="Scrobbles" />

                            </StackPanel>



                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Grid>
            <Grid x:Name="LastFMAuthedSection" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Image
                    VerticalAlignment="Top"
                                                    Source="{Binding Images[3].Url, Mode=OneWay, Converter={StaticResource StringToImageConverter}}"
                    Opacity="0.05" Grid.Row="0" Grid.RowSpan="2"
                    Stretch="UniformToFill">
                  
                    
                </Image>

                <!--  1. HEADER (Profile Info)  -->
                <!--  Mimics the Android FrameLayout with Image + Scrim + Text  -->
                <Grid
                Grid.Row="0"
                Margin="0,0,0,12" 
                CornerRadius="0,0,12,12">

                    <StackPanel Orientation="Horizontal" Spacing="15" 
            Background="Transparent">

                        <PersonPicture
                        x:Name="UserAvatarImg"
                        Width="100"
                        Height="100"
                        Opacity="0.6" />
                        <StackPanel
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Spacing="4">
                            <TextBlock
                            x:Name="UserNameTxt"
                            FontSize="28"
                            FontWeight="Bold"
                            Foreground="White"
                            HorizontalTextAlignment="Center"
                            Style="{StaticResource TitleTextBlockStyle}"
                            Text="Loading..." />

                            <TextBlock
                            x:Name="TotalScrobblesTxt"
                            Foreground="LightGray"
                            HorizontalTextAlignment="Center"
                            Style="{StaticResource BodyTextBlockStyle}"
                            Text="0 Scrobbles" />

                            <TextBlock
                            x:Name="scrobblingSince"
                            Foreground="LightGray"
                            HorizontalTextAlignment="Center"
                            Style="{StaticResource BodyTextBlockStyle}" />

                            <CheckBox
                            x:Name="AutoScrobbleCheck"
                            Content="Auto-Scrobble"
                            IsChecked="{x:Bind MyViewModel.ScrobbleToLastFM, Mode=TwoWay}" />
                        </StackPanel>
                    </StackPanel>
                </Grid>

                <!--  2. TABS (Pivot)  -->
                <Pivot Grid.Row="1" SelectionChanged="Pivot_SelectionChanged" Background="Transparent">

                    <!--  RECENT TRACKS  -->
                    <PivotItem Header="Recent">
                        <dgView:TableView
                        x:Name="RecentTracksList"
                        Width="auto" Background="Transparent"
                        AutoGenerateColumns="False"
                        ItemsSource="{x:Bind MyViewModel.ListOfUserRecentTracks, Mode=OneWay}"
                        Loaded="RecentTracksList_Loaded"
                        SelectionMode="None">
                            <dgView:TableView.Columns>

                                <!--  Column for the Cover Art  -->
                                <dgView:TableViewTemplateColumn Header="Cover">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border>
                                                <Image
                                                x:Name="coverArtImage"
                                                Width="150"
                                                    Source="{Binding Images[3].Url, Mode=OneWay, Converter={StaticResource StringToImageConverter}}"
                                                Height="150"
                                                Stretch="UniformToFill">
                                                </Image>
                                            </Border>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>


                                <dgView:TableViewTemplateColumn Width="*" Header="Track">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <Button
                                                x:Name="SongTitle"
                                                Background="Transparent"
                                                Click="SongTitle_Click"
                                                Content="{Binding Name}"
                                                FontSize="19"
                                                IsEnabled="{Binding IsOnPresentDevice}" />
                                                <TextBlock FontSize="15" Text="{Binding Album.Name}" />
                                                <FontIcon
                                                HorizontalAlignment="Left"
                                                Foreground="SlateBlue"
                                                Glyph="&#xE978;"
                                                Visibility="{Binding IsOnPresentDevice, Converter={StaticResource BoolToVisibilityConverter}}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>

                                <dgView:TableViewTemplateColumn Width="*" Header="Artist">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock FontSize="19" Text="{Binding Artist.Name}" />
                                                <Button FontSize="15" Visibility="{Binding UserLoved, Converter={StaticResource BoolToVis}}">
                                                    <FontIcon Foreground="DarkSlateBlue" Glyph="&#xEB52;" />
                                                </Button>

                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>

                                <dgView:TableViewTemplateColumn Width="*" Header="Time">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock FontSize="19" Text="{Binding Date, Converter={StaticResource EventDateToTimeAgoConverter}}" />
                                                <TextBlock
                                                FontSize="12"
                                                FontStyle="Italic"
                                                Foreground="Gray"
                                                Text="{Binding Date}" />

                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>

                                <dgView:TableViewTemplateColumn Width="auto" Header="Actions">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <Button
                                                Click="LoveTrackButton_Click"
                                                IsEnabled="{Binding IsOnPresentDevice}"
                                                ToolTipService.ToolTip="Love Track">
                                                    <FontIcon
                                                    Foreground="Red"
                                                    Glyph="&#xEB52;" />
                                                </Button>
                                                <Button
                                                Click="BanTrackButton_Click"
                                                IsEnabled="{Binding IsOnPresentDevice}"
                                                ToolTipService.ToolTip="Ban Track">
                                                    <FontIcon
                                                    Foreground="Black"
                                                    Glyph="&#xE8E0;" />
                                                </Button>

                                                <Button x:Name="DeleteScrobble"
                                                        Click="DeleteScrobble_Click"
                                                        IsEnabled="{Binding IsOnPresentDevice}"
                                                        ToolTipService.ToolTip="Delete Scrobble">
                                                    <FontIcon Foreground="Black"
                                                              Glyph="&#xE74D;" />
                                                </Button>
                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>
                            </dgView:TableView.Columns>
                        </dgView:TableView>
                    </PivotItem>

                    <!--  TOP TRACKS  -->
                    <PivotItem Header="Top Tracks">
                        <dgView:TableView
                        x:Name="TopTracksList"
                        Width="auto"
                        AutoGenerateColumns="False"
                        ItemsSource="{x:Bind MyViewModel.CollectionUserTopTracks, Mode=OneWay}"
                        SelectionMode="None">
                            <dgView:TableView.Columns>

                                <!--  Column for the Cover Art  -->
                                <dgView:TableViewTemplateColumn Header="Cover">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border>
                                                <Image
                                                Width="150"
                                                Height="150"
                                                    Source="{Binding Images[3].Url, Mode=OneWay, Converter={StaticResource StringToImageConverter}}"
                                                    x:Name="Imgg"
                                                Stretch="UniformToFill">
                                                   
                                                </Image>
                                            </Border>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>


                                <dgView:TableViewTemplateColumn Width="*" Header="Track">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <Button
                                                Background="Transparent"
                                                Click="SongTitle_Click"
                                                Content="{Binding Name}"
                                                FontSize="19"
                                                IsEnabled="{Binding IsOnPresentDevice}" />
                                                <TextBlock FontSize="15" Text="{Binding Album.Name}" />
                                                <FontIcon
                                                HorizontalAlignment="Left"
                                                Foreground="SlateBlue"
                                                Glyph="&#xE978;"
                                                Visibility="{Binding IsOnPresentDevice, Converter={StaticResource BoolToVisibilityConverter}}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>

                                <dgView:TableViewTemplateColumn Width="*" Header="Artist">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock FontSize="19" Text="{Binding Artist.Name}" />
                                                <TextBlock FontSize="15" Text="{Binding UserLoved}" />

                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>

                                <dgView:TableViewTextColumn
                                Width="*"
                                Binding="{Binding Statistics.PlayCount}"
                                Header="Times Played" />
                            </dgView:TableView.Columns>
                        </dgView:TableView>
                    </PivotItem>

                    <!--  Albums  -->
                    <PivotItem Header="Top Album">
                        <dgView:TableView
                        x:Name="TopAlbum"
                        Width="auto"
                        AutoGenerateColumns="False"
                        ItemsSource="{x:Bind MyViewModel.CollectionUserTopAlbums, Mode=OneWay}"
                        SelectionMode="None">
                            <dgView:TableView.Columns>

                                <!--  Column for the Cover Art  -->
                                <dgView:TableViewTemplateColumn Header="Cover">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border>
                                                <Image
                                                Width="150"
                                                Height="150"
                                                    Source="{Binding Images[3].Url, Mode=OneWay, Converter={StaticResource StringToImageConverter}}"
                                                Stretch="UniformToFill">
                                                   
                                                    
                                                </Image>
                                            </Border>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>


                                <dgView:TableViewTemplateColumn Header="Track">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <Button
                                                Background="Transparent"
                                                Click="SongAlbum_Click"
                                                Content="{Binding Name}"
                                                FontSize="19"
                                                IsEnabled="{Binding IsOnPresentDevice}" />
                                                <TextBlock FontSize="15" Text="{Binding Album.Name}" />
                                                <FontIcon
                                                HorizontalAlignment="Left"
                                                Foreground="SlateBlue"
                                                Glyph="&#xE978;"
                                                Visibility="{Binding IsOnPresentDevice, Converter={StaticResource BoolToVisibilityConverter}}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>

                                <dgView:TableViewTemplateColumn Header="Artist">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock FontSize="19" Text="{Binding Artist.Name}" />
                                                <TextBlock FontSize="15" Text="{Binding UserLoved}" />

                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>

                                <dgView:TableViewTemplateColumn Header="Time">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock FontSize="19" Text="{Binding Date, Converter={StaticResource EventDateToTimeAgoConverter}}" />

                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>
                            </dgView:TableView.Columns>
                        </dgView:TableView>
                    </PivotItem>


                    <!--  Loved TRACKS  -->
                    <PivotItem Header="Loved">
                        <dgView:TableView
                        x:Name="LovedTracksList"
                        Width="auto"
                        AutoGenerateColumns="False"
                        ItemsSource="{x:Bind MyViewModel.ListOfUserLovedTracks, Mode=OneWay}"
                        SelectionMode="None">
                            <dgView:TableView.Columns>

                                <!--  Column for the Cover Art  -->
                                <dgView:TableViewTemplateColumn Header="Cover">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border>
                                                <Image
                                                Width="150"
                                                    Source="{Binding Images[3].Url, Mode=OneWay, Converter={StaticResource StringToImageConverter}}"
                                                Height="150"
                                                Stretch="UniformToFill">
                                                   
                                                    
                                                </Image>
                                            </Border>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>


                                <dgView:TableViewTemplateColumn Header="Track">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Margin="10" Spacing="5">
                                                <Button Click="SongTitle_Click"
                                                Content="{Binding Name}"
                                                FontSize="19"
                                                IsEnabled="{Binding IsOnPresentDevice}" />
                                                <TextBlock FontSize="15" Text="{Binding Album.Name}" />
                                                <Rectangle
                                                Width="10"
                                                Height="10"
                                                Visibility="{Binding IsOnPresentDevice, Converter={StaticResource BoolToVisConverter}}" 
                                                HorizontalAlignment="Left"
                                                Fill="Green" />

                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>

                                <dgView:TableViewTemplateColumn Header="Artist">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock FontSize="19" Text="{Binding Artist.Name}" />
                                                <FontIcon
                                                HorizontalAlignment="Left"
                                                FontSize="15"
                                                Foreground="Red"
                                                Glyph="&#xEB52;"
                                                Visibility="{Binding UserLoved, Converter={StaticResource BoolToVisibilityConverter}}" />

                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>

                                <dgView:TableViewTemplateColumn Header="Time">
                                    <dgView:TableViewTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock FontSize="19" Text="{Binding Date, Converter={StaticResource EventDateToTimeAgoConverter}}" />

                                            </StackPanel>
                                        </DataTemplate>
                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>
                            </dgView:TableView.Columns>
                        </dgView:TableView>
                    </PivotItem>

                </Pivot>
            </Grid>

        </Grid>
    </ScrollViewer>
</Page>
