<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Dimmer.WinUI.Views.WinuiPages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Dimmer.WinUI.Views.WinuiPages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="clr-namespace:Dimmer.Utilities.TypeConverters;assembly=Dimmer"
        xmlns:convertersWinUI="using:Dimmer.WinUI.Utils.Converters"
    xmlns:dgView="using:WinUI.TableView"
    xmlns:dimmSearch="clr-namespace:Dimmer.Data.ModelView.DimmerSearch;assembly=Dimmer"
xmlns:lang="clr-namespace:Dimmer.Resources.Localization;assembly=Dimmer"
xmlns:media="using:Microsoft.UI.Xaml.Media"
xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer"
xmlns:modelsDb="clr-namespace:Dimmer.Data.Models;assembly=Dimmer"
xmlns:modeltwo="clr-namespace:Dimmer.WinUI.Utils.Models"
xmlns:queryBuilder="queries"
xmlns:tql="clr-namespace:Dimmer.DimmerSearch.TQL;assembly=Dimmer"
xmlns:vm="clr-namespace:Dimmer.WinUI.ViewModel"
    mc:Ignorable="d">
    <Page.Resources>
        <ResourceDictionary>
            <convertersWinUI:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <convertersWinUI:BoolToInverseVisibilityConverter x:Key="BoolToInverseVisibilityConverter"/>
        </ResourceDictionary>
    </Page.Resources>
    <Grid  Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <StackPanel Background="Transparent" HorizontalAlignment="Center" VerticalAlignment="Center" >
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="20">
                
                <ToggleButton x:Name="MusicFoldersBtn" Click="MusicFoldersView_Click"
              Content="Music Folders" FontSize="20"/>
                <ToggleButton x:Name="LastFMBtn" Click="LastFMView_Click"
              Content="LastFM Section" FontSize="20"/>
                <ToggleButton x:Name="UtilsBtn" Click="UtilsView_Click"
              Content="Utilities" FontSize="20"/>
            </StackPanel>
            <!-- Wizard content -->
            <FlipView x:Name="WizardFlipView"  SelectedIndex="{x:Bind MyViewModel.WizardCurrentViewIndex}"
                      SelectionChanged="WizardFlipView_SelectionChanged"
                      PointerReleased="WizardFlipView_PointerReleased"
                      >
                <!-- Step 1 -->
                <Grid Background="#1C1C1C" x:Name="MusicFoldersGrid" Padding="40">
                    <StackPanel>

                        <Image Source="/Dimmer/Resources/Images/appicon.png"/>

                                
                        <TextBlock Text="Folders"
                                   FontSize="35"
                                   Foreground="White"
                                   Margin="0,0,0,10"/>


                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10" Spacing="10">
                            <TextBlock Text="Total :"
                                       Foreground="White"
                                       VerticalAlignment="Center"/>

                            <TextBlock Text="{x:Bind MyViewModel.FolderPaths.Count}"
                                       Foreground="White"
                                       VerticalAlignment="Center"/>
                            
                        </StackPanel>


                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="Add your music folders to get started."
                                       Foreground="White"
                                       VerticalAlignment="Center"/>
                            <Button Content="Add Folder"
                                    Margin="10,0,0,0"
                                    Click="AddFolder_Click"/>

                        </StackPanel>


                        <dgView:TableView x:Name="FolderPathView"
                                          Loaded="FolderPathView_Loaded"
                            ItemsSource="{x:Bind MyViewModel.FolderPaths}">

                            <dgView:TableView.Columns>

                                <dgView:TableViewTextColumn
                    MaxWidth="310"
                    Binding="{Binding .}"
                    Header="Path"
                    IsReadOnly="True" />
                                <dgView:TableViewTemplateColumn
       MaxWidth="200"
       Header="Artist"
       IsReadOnly="True">
                                    <dgView:TableViewTemplateColumn.CellTemplate>

                                        <DataTemplate>
                                            <Border Background="Transparent"
                                                    Padding="5"

                                                    >
                                                <StackPanel Orientation="Horizontal" Spacing="10">
                                                    <Button Content="Update" 
                                                            
                                                            Click="ChangePathBtn_Click"
                                                            x:Name="ChangePathBtn"/> 
                                                    <Button Content="Delete" Background="Red"
                                                            x:Name="DeletePathBtn"
                                                            Click="DeletePathBtn_Click"/> 


                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>

                                    </dgView:TableViewTemplateColumn.CellTemplate>
                                </dgView:TableViewTemplateColumn>
                                

                            </dgView:TableView.Columns>

                        </dgView:TableView>

                    </StackPanel>
                </Grid>

                <!-- Step 2 -->
                <Grid Background="#202020" x:Name="LastFMGrid" Padding="40">
                    <StackPanel Visibility="{x:Bind MyViewModel.IsLastfmAuthenticated,
                        Converter={StaticResource BoolToInverseVisibilityConverter}}"
                                HorizontalAlignment="Center">

                        <TextBox Header="Enter your Last FM username:" PlaceholderText="User Name"
                                 FontSize="25"/>

                        <Button Content="Login to Last FM"
                                HorizontalAlignment="Left"
                                Margin="0,10,0,0"
                                Click="LoginLastFM_Click"/>
                    </StackPanel>
        

                    <StackPanel Visibility="{x:Bind MyViewModel.IsLastfmAuthenticated,
                        Converter={StaticResource BoolToVisibilityConverter}}">

                        <Image Source="{x:Bind MyViewModel.UserLocal.LastFMAccountInfo.Image.Url}"/>

                        <TextBlock Text="You are logged in to Last FM."
                                   FontSize="24"
                                   Foreground="White"
                                   Margin="0,0,0,10"/>
                        <Button Content="Logout"
                                HorizontalAlignment="Left"
                                Click="LogoutLastFM_Click"/>
                    </StackPanel>
                </Grid>

                <!-- Step 3 -->
                <Grid Background="#252525" x:Name="UtilitiesGrid" Padding="10">

                    <StackPanel >
                            <TextBlock Text="Preferences"
                                       FontSize="28"
                                       Foreground="White"
                                       Margin="0,0,0,10"/>
                            <TextBlock Text="Review your preferences before finishing."
                                       Foreground="White"
                                       Margin="0,0,0,20"/>

                            <Border CornerRadius="5" HorizontalAlignment="Left"
                                    MinWidth="550">
                                <ScrollView>
                                    <StackPanel>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="auto" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Enable Auto Scrobbling to Last FM"
                                                           FontSize="20"
                                                           Foreground="White"
                                                           VerticalAlignment="Center"
                                                           Margin="10"
                                                           Grid.Column="0"/>

                                            <ToggleButton x:Name="AutoScrobbleToggle"
                                                              Content="Enable"
                                                              Grid.Column="1"
                                                              Margin="10"/>
                                        </Grid>


                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="auto" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Theme"
                                                           FontSize="20"
                                                           Foreground="White"
                                                           VerticalAlignment="Center"
                                                           Margin="10"
                                                           Grid.Column="0"/>

                                            <ToggleButton x:Name="ThemeToggle"
                                                              Content="Dark"
                                                              Click="ThemeToggle_Click"
                                                              Grid.Column="1"
                                                              Margin="10"/>
                                        </Grid>



                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="auto" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Back Navigate With Mouse 4"
                                                           FontSize="20"
                                                           Foreground="White"
                                                           VerticalAlignment="Center"
                                                           Margin="10"
                                                           Grid.Column="0"/>

                                            <ToggleButton x:Name="BackNavM4"
                                                              Content="Enable"
                                                              Click="BackNavM4_Click"
                                                              Grid.Column="1"
                                                              Margin="10"/>
                                        </Grid>

                                       
                                        <Expander x:Name="MiniLyricsExpander"
                                                  IsExpanded="False"
                                                  MinWidth="550"
                                                  ExpandDirection="Down">
                                            <Expander.Header>
                                                <CheckBox Content="Enable Mini Lyrics View"
                                                          x:Name="EnableMiniLyricsView"
                                                          Checked="EnableMiniLyricsView_Checked"
                                                          IsChecked="True"/>
                                            </Expander.Header>

                                            <Expander.Content>
                                                <StackPanel>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Text="Preferred Position"
                                                                       FontSize="20"
                                                                       Foreground="White"
                                                                       VerticalAlignment="Center"
                                                                       Margin="10"
                                                                       Grid.Column="0"/>
                                                        <DropDownButton x:Name="PreferredPosition"
                                                                          Content="Top Left"
                                                                          Grid.Column="1"
                                                                          Margin="10">
                                                            <DropDownButton.Flyout>
                                                                <MenuFlyout Placement="Right">
                                                                    <RadioMenuFlyoutItem IsChecked="True" 
                                                                                         x:Name="TopLeftPosition"
                                                                                         Text="Top Left"
GroupName="PositionsGroup"
                                                                                         Click="PositionChange_Click"/>
                                                                    
                                                                    <RadioMenuFlyoutItem  
                                                                                         Text="TopRight"
GroupName="PositionsGroup"
                                                                                         x:Name="TopRightPosition"
                                                                                         Click="PositionChange_Click"/>
                                                                    
                                                                    <RadioMenuFlyoutItem  
                                                                                         x:Name="BottomRightPosition"
                                                                                         Text="Bottom Right"
                                                                                        GroupName="PositionsGroup"
                                                                                         Click="PositionChange_Click"/>
                                                                    
                                                                    <RadioMenuFlyoutItem  
                                                                                         Text="Bottom Left"
                                                                                         GroupName="PositionsGroup"
                                                                                         x:Name="BottomLeftPosition"
                                                                                         Click="PositionChange_Click"/>
                                                                    
                                                                </MenuFlyout>
                                                            </DropDownButton.Flyout>
                                                        </DropDownButton>
                                                    </Grid>
                                                   
                                                </StackPanel>
                                            </Expander.Content>
                                        </Expander>
                                            
                                            


                                        <Expander x:Name="LyricsExpander" 
                                                  MinWidth="550"
                                                  IsExpanded="False" Grid.Column="0"
                                                    ExpandDirection="Down">
                                        <Expander.Header>
                                            <ToggleButton x:Name="EnableLyricsBtn"
                                                          Content="Enable Fetch With LrcLib"
                                                          Checked="EnableLyricsBtn_Checked"
                                                          IsChecked="True"
                                                          RightTapped="EnableLyricsBtn_RightTapped"
                                                          ToolTipService.ToolTip="Enable Download of Synchronized or Plain Lyrics. Right Click to know more."/>
                                        </Expander.Header>
                                        <Expander.Content>
                                            <StackPanel>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="Preferred Lyrics Source"
                                                                   FontSize="20"
                                                                   Foreground="White"
                                                                   VerticalAlignment="Center"
                                                                   Margin="10"
                                                                   Grid.Column="0"/>
                                                    <DropDownButton x:Name="PreferredLyricsSource"
                                                                      Content="LrcLib"
                                                                      Grid.Column="1"
                                                                      Margin="10">
                                                        <DropDownButton.Flyout>
                                                            <MenuFlyout Placement="Right">
                                                                <RadioMenuFlyoutItem IsChecked="True" 
                                                                                     x:Name="LrcLibSource"
                                                                                     Text="LrcLib"
                                                                                     GroupName="LyricsSourceGroup"
                                                                                     Click="LrcLibSource_Click"/>
                                                                <RadioMenuFlyoutItem 
                                                                                     x:Name="SongFileOnly"
                                                                                     Text="Song File"
                                                                                    GroupName="LyricsSourceGroup"
                                                                                    Click="SongFileOnly_Click"
                                                                                     />
                                                            </MenuFlyout>
                                                        </DropDownButton.Flyout>
                                                    </DropDownButton>
                                                </Grid>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="Preferred Search Format"
                    FontSize="20"
                    Foreground="White"
                    VerticalAlignment="Center"
                    Margin="10"
                    Grid.Column="0"/>

                                                    <DropDownButton x:Name="PreferredLyricsFormat"
                                                                      Content="Synchronized"
                                                                      Grid.Column="1"
                                                                      Margin="10">
                                                        <DropDownButton.Flyout>
                                                            <MenuFlyout Placement="Right">
                                                                <RadioMenuFlyoutItem IsChecked="True" 
                                                                                     x:Name="SynchronizedFormat"
                                                                                     Text="Synchronized"
                                                                                     GroupName="LyricsFormatGroup"
                                                                                     Click="SynchronizedFormat_Click"/>
                                                                <RadioMenuFlyoutItem 
                                                                                     x:Name="PlainFormat"
                                                                                     Text="Plain"
                                                                                    GroupName="LyricsFormatGroup"
                                                                                    Click="PlainFormat_Click"
                                                                                     />
                                                                <RadioMenuFlyoutItem 
                                                                                     x:Name="AllFormats"
                                                                                     Text="All"
                                                                                    GroupName="LyricsFormatGroup"
                                                                                    Click="AllFormats_Click"
                                                                                     />
                                                            </MenuFlyout>
                                                        </DropDownButton.Flyout>
                                                    </DropDownButton>
                                                </Grid>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="Contribute Lyrics to LrcLib"
                                                               ToolTipService.ToolTip
                                                               ="Toggle allow Manually Synced lyrics to feature on LrcLib as Contribution"
                    FontSize="20"
                    Foreground="White"
                    VerticalAlignment="Center"
                    Margin="10"
                    Grid.Column="0"/>

                                                    <DropDownButton x:Name="AllLyricsContribute"
                                                                      Content="Yes"
                                                                      Grid.Column="1"
                                                                      Margin="10">
                                                        <DropDownButton.Flyout>
                                                            <MenuFlyout Placement="Right">
                                                                <RadioMenuFlyoutItem IsChecked="True" 
                                                                                     x:Name="AllowYes"
                                                                                     Text="Yes"
                                                                                     GroupName="LyricsContributionGroup"
                                                                                     Click="AllowLyricsContribution_Click"/>
                                                                <RadioMenuFlyoutItem 
                                                                                     x:Name="NotAllow"
                                                                                     Text="No"
                                                                                    GroupName="LyricsContributionGroup"
                                                                                    Click="AllowLyricsContribution_Click"
                                                                                     />
                                                                
                                                            </MenuFlyout>
                                                        </DropDownButton.Flyout>
                                                    </DropDownButton>
                                                </Grid>


                                            </StackPanel>
                                        </Expander.Content>
                                        
                                    </Expander>
                                    


                                </StackPanel>
                                </ScrollView>   
                            </Border>
                        </StackPanel>
                </Grid>
            </FlipView>

            <!-- Navigation buttons -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                <Button x:Name="BackButton"
                        Content="◀ Back"
                        Click="BackButton_Click"
                        Margin="0,0,10,0"/>
                <Button x:Name="NextButton"
                        Content="Next ▶"
                        Click="NextButton_Click"/>
            </StackPanel>

        </StackPanel>
    </Grid>
</Page>
