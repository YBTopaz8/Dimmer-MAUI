<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Dimmer.WinUI.Views.WinuiPages.DimmerLive.CloudDataPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Dimmer.WinUI.Views.WinuiPages.DimmerLive"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Dimmer.DimmerLive.Models"
    mc:Ignorable="d">

    <Grid Padding="24" RowSpacing="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <StackPanel Grid.Row="0" Spacing="8">
            <TextBlock Style="{StaticResource TitleTextBlockStyle}" Text="Cloud &amp; Devices" />
            <TextBlock
                Opacity="0.7"
                Style="{StaticResource BodyTextBlockStyle}"
                Text="Manage backups and sync playback across devices." />
        </StackPanel>

        <!--  Status & Backup Section  -->
        <Grid Grid.Row="1" ColumnSpacing="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!--  Device Registration  -->
            <Border
                Grid.Column="0"
                Padding="16"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="8">
                <StackPanel Spacing="12">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon FontSize="20" Glyph="&#xE770;" />
                        <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="This Device" />
                    </StackPanel>

                    <InfoBar
                        Title="Session Status"
                        IsIconVisible="True"
                        IsOpen="True"
                        Message="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                        Severity="Informational" />

                    <Button
                        HorizontalAlignment="Stretch"
                        Command="{x:Bind ViewModel.RegisterCurrentDeviceCommand}"
                        Content="Register/Refresh Device" />
                </StackPanel>
            </Border>

            <!--  Cloud Backup  -->
            <Border
                Grid.Column="1"
                Padding="16"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="8">
                <StackPanel Spacing="12">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon FontSize="20" Glyph="&#xE753;" />
                        <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="Cloud Backup" />
                    </StackPanel>

                    <TextBlock
                        Opacity="0.6"
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Text="Save your play history and settings to the cloud."
                        TextWrapping="Wrap" />

                    <Grid>
                        <Button
                            HorizontalAlignment="Stretch"
                            Command="{x:Bind ViewModel.BackUpDataToCloudCommand}"
                            Content="Backup Now"
                            IsEnabled="{x:Bind ViewModel.IsBusy, Mode=OneWay, Converter={StaticResource InvBoolToVis}}"
                            Style="{StaticResource AccentButtonStyle}" />

                        <ProgressRing HorizontalAlignment="Center" IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}" />
                    </Grid>
                </StackPanel>
            </Border>
        </Grid>

        <!--  Remote Devices List  -->
        <Grid Grid.Row="2" RowSpacing="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="Available Devices" />

            <ListView
                Grid.Row="1"
                ItemsSource="{x:Bind ViewModel.OtherDevices, Mode=OneWay}"
                SelectionMode="None">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:UserDeviceSession">
                        <Grid
                            Margin="0,4"
                            Padding="12"
                            Background="{ThemeResource LayerFillColorDefaultBrush}"
                            CornerRadius="4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!--  Icon based on device type  -->
                            <FontIcon
                                Margin="0,0,16,0"
                                VerticalAlignment="Center"
                                FontSize="24"
                                Glyph="&#xE8EA;" />

                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Style="{StaticResource BodyStrongTextBlockStyle}" Text="{x:Bind DeviceName}" />
                                <TextBlock
                                    Opacity="0.6"
                                    Style="{StaticResource CaptionTextBlockStyle}"
                                    Text="{x:Bind DevicePlatform}" />
                            </StackPanel>

                            <!--  Handoff Button  -->
                            <Button
                                Grid.Column="2"
                                Command="{Binding ElementName=RootPage, Path=ViewModel.TransferToDeviceCommand}"
                                CommandParameter="{Binding}"
                                Content="Transfer Session">
                                <ToolTipService.ToolTip>
                                    <ToolTip Content="Send current song to this device" />
                                </ToolTipService.ToolTip>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>
    </Grid>
</Page>