<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Dimmer.WinUI.Views.WinuiPages.AllSongsListPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:Dimmer.Utilities.TypeConverters;assembly=Dimmer"
    xmlns:convertersWinUI="using:Dimmer.WinUI.Utils.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dgView="using:WinUI.TableView"
    xmlns:dimmSearch="clr-namespace:Dimmer.Data.ModelView.DimmerSearch;assembly=Dimmer"
    xmlns:lang="clr-namespace:Dimmer.Resources.Localization;assembly=Dimmer"
    xmlns:local="using:Dimmer.WinUI.Views.CustomViews.WinuiViews"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:media="using:Microsoft.UI.Xaml.Media"
    xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer"
    xmlns:modelsDb="clr-namespace:Dimmer.Data.Models;assembly=Dimmer"
    xmlns:modeltwo="clr-namespace:Dimmer.WinUI.Utils.Models"
    xmlns:queryBuilder="queries"
    xmlns:tql="clr-namespace:Dimmer.DimmerSearch.TQL;assembly=Dimmer"
    xmlns:vm="clr-namespace:Dimmer.WinUI.ViewModel"
    x:Name="MyPageGrid"
    Loaded="MyPageGrid_Loaded"
    Unloaded="MyPageGrid_Unloaded"
    mc:Ignorable="d">

    <Page.Resources>
        <ResourceDictionary>


            <ResourceDictionary.ThemeDictionaries>
                <ResourceDictionary x:Key="Default">
                    <media:AcrylicBrush
                        x:Key="CustomAcrylicInAppBrush"
                        FallbackColor="Green"
                        TintColor="Black"
                        TintOpacity="0.8" />
                    <media:AcrylicBrush
                        x:Key="CustomAcrylicInAppLuminosity"
                        FallbackColor="SkyBlue"
                        TintColor="SkyBlue"
                        TintOpacity="0.8" />
                </ResourceDictionary>
            </ResourceDictionary.ThemeDictionaries>
            <convertersWinUI:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <convertersWinUI:BoolToInverseVisibilityConverter x:Key="BoolToInverseVisibilityConverter" />
            <convertersWinUI:BoolToPlayingPauseConv x:Key="BoolToPlayingPauseConverter" />

            <DataTemplate x:Key="ColorTemplate" x:DataType="SolidColorBrush">
                <StackPanel AutomationProperties.Name="{x:Bind Color}" Orientation="Horizontal">
                    <Rectangle
                        Width="20"
                        Height="20"
                        Fill="{x:Bind}" />
                    <TextBlock Margin="4,0,0,0" Text="{x:Bind Color}" />
                </StackPanel>
            </DataTemplate>
        </ResourceDictionary>
    </Page.Resources>
    <Grid
        Grid.Row="0"
        Margin="10"
        RowSpacing="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <StackPanel
                BorderThickness="1"
                CornerRadius="00"
                PointerReleased="StackPanel_PointerReleased"
                Spacing="5">





                <StackPanel
                    HorizontalAlignment="Left"
                    Orientation="Horizontal"
                    Spacing="10">
                    <Button x:Name="ViewQueue" 
                        
                            Command="{x:Bind MyViewModel.CopyAllSongsInNowPlayingQueueToMainSearchResultCommand}"
                            Content="View Queue" />

                    <Button Command="{x:Bind MyViewModel.ScrollToCurrentPlayingSongCommand}" Content="Scroll To Current" />


                    <Button Command="{Binding RandomizeCommand}" Content="Shuffle" />

                </StackPanel>

                <StackPanel
                    x:Name="SearchTextBoxPanel"
                    HorizontalAlignment="Left"
                    Orientation="Horizontal"
                    Spacing="10">


                    <TextBox
                        x:Name="SearchTextBox"
                        Width="435"
                        AccessKey="F"
                        AccessKeyInvoked="SearchAutoSuggestBox_AccessKeyInvoked"
                        BorderThickness="2"
                        KeyboardAcceleratorPlacementMode="Auto"
                        PlaceholderText="Search with TQL..."
                        Text="{x:Bind MyViewModel.CurrentTqlQuery}"
                        TextChanged="SearchAutoSuggestBox_TextChanged" />
                    <TextBlock VerticalAlignment="Center" Text="{Binding SearchResults.Count}" />

                </StackPanel>

                <TextBlock Text="{Binding CurrentTqlQuery}" />

                <StackPanel
                    x:Name="ViewQueueStackPanel"
                    Grid.Column="0"
                    Background="Transparent"
                    Orientation="Horizontal"
                    PointerPressed="ViewQueueStackPanel_PointerPressed"
                    Spacing="15"
                    Visibility="Collapsed">
                    <ScrollViewer
                        x:Name="AnimatedScrollViewer"
                        MinWidth="250"
                        MaxWidth="450"
                        MaxHeight="375"
                        HorizontalAlignment="Left"
                        ViewChanging="AnimatedScrollViewer_ViewChanging">

                        <Expander
                            x:Name="NowPlayingQueueExpander"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Top"
                            BorderBrush="Transparent"
                            BorderThickness="3"
                            CornerRadius="12"
                            Expanding="NowPlayingQueueExpander_Expanding"
                            IsExpanded="{x:Bind MyViewModel.IsNowPlayingQueueExpanded}">
                            <Expander.Header>
                                <StackPanel Orientation="Horizontal" Spacing="15">
                                    <TextBlock Text="Queue" />
                                    <TextBlock Text="{x:Bind MyViewModel.PlaybackQueue.Count, Mode=OneWay}" />
                                </StackPanel>
                            </Expander.Header>
                            <Expander.Content>
                                <ItemsRepeater ItemsSource="{x:Bind MyViewModel.PlaybackQueue}">
                                    <ItemsRepeater.Layout>
                                        <UniformGridLayout MinRowSpacing="3" Orientation="Vertical" />
                                    </ItemsRepeater.Layout>
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate>
                                            <Border
                                                x:Name="BorderOfSongInPBQueue"
                                                Width="200"
                                                Padding="5"
                                                BorderBrush="Gray"
                                                BorderThickness="1"
                                                CornerRadius="5"
                                                DoubleTapped="PlaySongBtn_DoubleTapped"
                                                PointerEntered="BorderOfSongInPBQueue_PointerEntered"
                                                PointerExited="BorderOfSongInPBQueue_PointerExited">
                                                <StackPanel>
                                                    <TextBlock FontSize="19" Text="{Binding Title}" />
                                                    <TextBlock FontSize="14" Text="{Binding ArtistName}" />
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </Expander.Content>
                        </Expander>

                    </ScrollViewer>
                    <StackPanel
                        x:Name="SidePanelForSelectedSong"
                        HorizontalAlignment="Center"
                        Spacing="15"
                        Visibility="Collapsed">
                        <Grid Height="150">

                            <Image
                                Grid.Row="0"
                                Height="40"
                                Source="/Dimmer/Resources/Images/lyrics.svg" />
                            <Image
                                x:Name="FocusedSongImage"
                                MaxWidth="150"
                                MaxHeight="150"
                                HorizontalAlignment="Left" />
                        </Grid>
                        <Button x:Name="FocusedSongTextBlockTitle" Content="Title" />
                        <Button x:Name="FocusedSongTextBlockArtistName" Content="Artist Name" />
                        <Button x:Name="FocusedSongTextBlockAlbumName" Content="Album Name" />
                        <Button x:Name="FocusedSongTextBlockGenre" Content="Genre" />
                        <Button x:Name="FocusedSongTextBlockLastTimePlayed" />
                        <Button x:Name="FocusedSongTextBlockIsFav" />
                        <Button x:Name="FocusedSongTextBlockHasSyncLyrics" />

                    </StackPanel>
                </StackPanel>
            </StackPanel>

            <StackPanel Grid.Column="1" Visibility="{Binding IsDimmerPlaying, Converter={StaticResource BoolToVisibilityConverter}}">

                <ListView
                    x:Name="animatedScrollRepeater"
                    Grid.Column="0"
                    Height="150"
                    MaxWidth="550"
                    ItemsSource="{Binding AllLines}"
                    SelectedItem="{Binding CurrentLine}"
                    SelectionChanged="animatedScrollRepeater_SelectionChanged"
                    SelectionMode="Single">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="x:String">
                            <Border>
                                <Grid>
                                    <Border BorderBrush="DarkSlateBlue" Opacity="0.7" />

                                    <TextBlock
                                        FontSize="{Binding NowPlayingLyricsFontSize}"
                                        HorizontalTextAlignment="Center"
                                        Text="{Binding Text}"
                                        TextWrapping="Wrap" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

            </StackPanel>
        </Grid>

        <dgView:TableView
            x:Name="MySongsTableView"
            Grid.Row="1"
            HorizontalAlignment="Stretch"
            HorizontalContentAlignment="Stretch"
            AllowFocusOnInteraction="False"
            AllowFocusWhenDisabled="False"
            AutoGenerateColumns="False"
            CanDragItems="True"
            CellContextFlyoutOpening="MySongsTableView_CellContextFlyoutOpening"
            CellSelectionChanged="MySongsTableView_CellSelectionChanged"
            ChoosingGroupHeaderContainer="MySongsTableView_ChoosingGroupHeaderContainer"
            ChoosingItemContainer="MySongsTableView_ChoosingItemContainer"
            ClearSorting="MySongsTableView_ClearSorting"
            ContextRequested="MySongsTableView_ContextRequested"
            CurrentCellChanged="MySongsTableView_CurrentCellChanged"
            DoubleTapped="TableView_DoubleTapped"
            DragItemsCompleted="MySongsTableView_DragItemsCompleted"
            DragItemsStarting="MySongsTableView_DragItemsStarting"
            DragStarting="MySongsTableView_DragStarting"
            ExportSelectedContent="TableView_ExportSelectedContent"
            GettingFocus="MySongsTableView_GettingFocus"
            GotFocus="MySongsTableView_GotFocus"
            Holding="MySongsTableView_Holding"
            IsItemClickEnabled="True"
            IsRightTapEnabled="True"
            IsSwipeEnabled="True"
            ItemClick="MySongsTableView_ItemClick"
            ItemsSource="{x:Bind MyViewModel.SearchResults}"
            Loaded="MySongsTableView_Loaded"
            Loading="MySongsTableView_Loading"
            LosingFocus="MySongsTableView_LosingFocus"
            LostFocus="MySongsTableView_LostFocus"
            PointerEntered="MySongsTableView_PointerEntered"
            PointerExited="MySongsTableView_PointerExited"
            PointerPressed="TableView_PointerPressed"
            PointerReleased="MySongsTableView_PointerReleased"
            ProcessKeyboardAccelerators="MySongsTableView_ProcessKeyboardAccelerators"
            RightTapped="TableView_RightTapped"
            RowContextFlyoutOpening="MySongsTableView_RowContextFlyoutOpening"
            SelectionChanged="MySongsTableView_SelectionChanged"
            SelectionMode="Single"
            Sorting="MySongsTableView_Sorting"
            Style="{StaticResource AcrylicDataGridStyle}"
            Tapped="MySongsTableView_Tapped">

            <dgView:TableView.Columns>

                <!--  Column for the Cover Art  -->
                <dgView:TableViewTemplateColumn Header="Cover">
                    <dgView:TableViewTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border
                                x:Name="CardBorder"
                                Height="210"
                                Margin="3,5,3,-20"
                                AllowFocusOnInteraction="False"
                                Background="Transparent"
                                BorderThickness="1"
                                CornerRadius="12"
                                DoubleTapped="CardBorder_DoubleTapped"
                                IsDoubleTapEnabled="True"
                                IsHitTestVisible="True"
                                Loaded="CardBorder_Loaded"
                                PointerEntered="CardBorder_PointerEntered"
                                PointerExited="CardBorder_PointerExited">
                                <Grid x:Name="CoverImageGrid" PointerReleased="CardBorder_PointerReleased">

                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />

                                    </Grid.RowDefinitions>

                                    <!--  You can even overlay a "favorite" icon like in your example  -->

                                    <Image
                                        x:Name="coverArtImage"
                                        Grid.Row="0"
                                        Width="180"
                                        Height="180"
                                        x:FieldModifier="Public"
                                        Source="{Binding CoverImagePath}"
                                        Stretch="UniformToFill" />

                                    <StackPanel
                                        x:Name="ExtraPanel"
                                        Grid.Row="0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Bottom"
                                        Loaded="ExtraPanel_Loaded"
                                        Opacity="0"
                                        Orientation="Horizontal"
                                        RenderTransformOrigin="0.5,0.5"
                                        Spacing="10"
                                        Visibility="Visible">
                                        <StackPanel.RenderTransform>
                                            <TranslateTransform Y="150" />
                                        </StackPanel.RenderTransform>
                                        <Button
                                            x:Name="ViewSongBtn"
                                            Margin="30,0,0,0"
                                            HorizontalAlignment="Center"
                                            Background="DarkSlateBlue"
                                            Click="ViewSongBtn_Click"
                                            Content="View"
                                            Opacity="0.8"
                                            PointerEntered="ButtonHover_PointerEntered"
                                            PointerExited="ButtonHover_PointerExited" />
                                        <Button
                                            x:Name="ViewOtherBtn"
                                            HorizontalAlignment="Center"
                                            Background="DarkSlateBlue"
                                            Click="ViewOtherBtn_Click"
                                            Content="Share"
                                            Opacity="0.8"
                                            PointerEntered="ButtonHover_PointerEntered"
                                            PointerExited="ButtonHover_PointerExited" />
                                    </StackPanel>

                                </Grid>

                            </Border>
                        </DataTemplate>
                    </dgView:TableViewTemplateColumn.CellTemplate>
                </dgView:TableViewTemplateColumn>

                <!--  Other columns for Title, Artist, etc.  -->
                <dgView:TableViewCheckBoxColumn
                    Binding="{Binding HasSyncedLyrics}"
                    Header="HasLyrics"
                    IsReadOnly="True" />


                <dgView:TableViewTextColumn
                    x:Name="Title"
                    MaxWidth="200"
                    Binding="{Binding Title}"
                    Header="Title"
                    IsReadOnly="True" />
                <dgView:TableViewTemplateColumn
                    x:Name="Artist"
                    MaxWidth="200"
                    Header="Artist"
                    IsReadOnly="True">
                    <dgView:TableViewTemplateColumn.CellTemplate>

                        <DataTemplate>
                            <Grid PointerPressed="Grid_PointerPressed">

                                <Border
                                    x:Name="ArtistNameTextOnly"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">

                                    <TextBlock
                                        x:Name="ArtistNameTxt"
                                        HorizontalAlignment="Center"
                                        Text="{Binding ArtistName}" />
                                </Border>


                            </Grid>
                        </DataTemplate>

                    </dgView:TableViewTemplateColumn.CellTemplate>


                </dgView:TableViewTemplateColumn>

                <dgView:TableViewTextColumn
                    x:Name="AlbumName"
                    MaxWidth="300"
                    Binding="{Binding AlbumName}"
                    Header="Album"
                    IsReadOnly="True" />

                <dgView:TableViewTextColumn
                    x:Name="GenreName"
                    MaxWidth="210"
                    Binding="{Binding GenreName}"
                    Header="Genre"
                    IsReadOnly="True" />
                <dgView:TableViewTextColumn
                    x:Name="FileFormat"
                    Binding="{Binding FileFormat}"
                    Header="Format"
                    IsReadOnly="True" />
                <dgView:TableViewTextColumn
                    x:Name="DurationFormatted"
                    Binding="{Binding DurationFormatted}"
                    Header="Duration"
                    IsReadOnly="True" />
                <dgView:TableViewTextColumn
                    x:Name="ReleaseYear"
                    Binding="{Binding ReleaseYear}"
                    CanFilter="False"
                    CanSort="True"
                    Header="Year"
                    IsFiltered="False"
                    IsReadOnly="True" />
                <dgView:TableViewTextColumn
                    x:Name="PlayCompletedCount"
                    Binding="{Binding PlayCompletedCount}"
                    Header="Dims"
                    IsReadOnly="True" />
                <dgView:TableViewTemplateColumn Header="Is Fav" IsReadOnly="False">
                    <dgView:TableViewTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid HorizontalAlignment="Center">
                                <CheckBox
                                    HorizontalContentAlignment="Center"
                                    VerticalContentAlignment="Center"
                                    Click="CheckBox_Click"
                                    ClickMode="Release"
                                    IsChecked="{Binding IsFavorite}" />
                            </Grid>
                        </DataTemplate>
                    </dgView:TableViewTemplateColumn.CellTemplate>

                </dgView:TableViewTemplateColumn>


            </dgView:TableView.Columns>
        </dgView:TableView>




    </Grid>
</Page>

