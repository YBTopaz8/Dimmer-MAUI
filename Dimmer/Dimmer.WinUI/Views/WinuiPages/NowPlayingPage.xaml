<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Dimmer.WinUI.Views.WinuiPages.NowPlayingPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:Dimmer.WinUI.Utils.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Dimmer.WinUI.Views.WinuiPages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:winuiviews="using:Dimmer.WinUI.Views.CustomViews.WinuiViews"
    mc:Ignorable="d">
    <Page.Resources>
        <ResourceDictionary>
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <converters:RepeatModeConverter x:Key="RepeatModeConverter" />
            <converters:BoolToPlayingPauseConv x:Key="BoolToPlayingPauseConverter" />
            <converters:DurationConverterFromSecondsToTimeSpan x:Key="DurationConverterFromSecondsToTS" />
        </ResourceDictionary>
    </Page.Resources>

    <Grid>
        <Image  Grid.Column="0"
       Stretch="UniformToFill"
    x:Name="CurrentPlayingSongImgBG" 
    
    />
        <ScrollViewer PointerPressed="MainView_PointerPressed" x:Name="mainView">
            <StackPanel Padding="40" Spacing="14">
                <!--  Carousel Section  -->
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition MaxHeight="450" MinHeight="400"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="auto"/>
                    </Grid.ColumnDefinitions>
                    <Image MaxWidth="450" Grid.Column="0"
                           MinWidth="400" Stretch="UniformToFill"
                        x:Name="CurrentPlayingSongImg" Canvas.ZIndex="1"
                        Loaded="CurrentPlayingSongImg_Loaded"
                        />
                    <ListView SelectedItem="{x:Bind MyViewModel.CurrentLine, Mode=TwoWay}"
                              x:Name="SyncLyricsView"
                              SelectionChanged="SyncLyricsView_SelectionChanged"
                             SelectionMode="Single" Visibility="{x:Bind MyViewModel.IsDimmerPlaying, Converter={StaticResource BoolToVisConverter}}"
                           Grid.Column="0" Canvas.ZIndex="99"
                              ItemsSource="{x:Bind MyViewModel.AllLines,Mode=OneWay}">
                        <DataTemplate>
                            <Grid HorizontalAlignment="Center"
                                    Background="#1e1e1e">
                                <Border
                                    Background="#1e1e1e" HorizontalAlignment="Center"
                                    Visibility="{Binding IsHighlighted, Converter={StaticResource BoolToInverseVisibilityConverter}}"
                                    Opacity="0.7"
                                    BorderBrush="DarkSlateBlue"/>

                                <TextBlock HorizontalTextAlignment="Center" HorizontalAlignment="Center"
                                    FontSize="{Binding NowPlayingLyricsFontSize}"
                                    
                                    Text="{Binding Text}"
                                    Foreground="DarkSlateBlue" />
                            </Grid>
                        </DataTemplate>
                    </ListView>
                </Grid>

                <!--  Song Info  -->
                <StackPanel
                    HorizontalAlignment="Center"
                    Spacing="8">
                    <Button Background="Transparent"
                            
                        HorizontalAlignment="Center"
                        FontSize="28"
                        FontWeight="SemiBold" CornerRadius="12"
                        Content="{x:Bind MyViewModel.CurrentPlayingSongView.Title, Mode=OneWay}"
                        HorizontalContentAlignment="Center"
                        />
                    <Button Background="Transparent"

                        HorizontalAlignment="Center"
                        FontSize="18"
                            Click="CurrentArtistBtn_Click" x:Name="CurrentArtistBtn"
                        Opacity="0.8" CornerRadius="12"
                        Content="{x:Bind MyViewModel.CurrentPlayingSongView.OtherArtistsName, Mode=OneWay}"
                        HorizontalContentAlignment="Center"
                        />
                    <Button Background="Transparent"
x:Name="ArtistBtn" Click="ArtistBtn_Click"
                        HorizontalAlignment="Center"
                        FontSize="16" CornerRadius="12"
                        Opacity="0.6"
                        Content="{x:Bind MyViewModel.CurrentPlayingSongView.AlbumName, Mode=OneWay}"
                        HorizontalContentAlignment="Center"
                        />
                </StackPanel>

                <!--  Progress Section  -->
                <StackPanel Spacing="5">
                    <Slider
                        x:Name="ProgressSlider" IsThumbToolTipEnabled="True"
                        Foreground="DarkSlateBlue"
                        Maximum="{x:Bind MyViewModel.CurrentTrackDurationSeconds, Mode=OneWay}"
                        Value="{x:Bind MyViewModel.CurrentTrackPositionSeconds, Mode=OneWay}" />
                    <Grid>
                        <TextBlock
                            HorizontalAlignment="Left"
                            FontSize="12"
                            Text="{x:Bind MyViewModel.CurrentTrackPositionSeconds, Converter={StaticResource DurationConverterFromSecondsToTS}, Mode=OneWay}" />
                        <TextBlock
                            HorizontalAlignment="Right"
                            FontSize="12"
                            Text="{x:Bind MyViewModel.CurrentTrackDurationSeconds, Converter={StaticResource DurationConverterFromSecondsToTS}, Mode=OneWay}" />
                    </Grid>
                </StackPanel>

                <!--  Playback Controls  -->
                <StackPanel
                    HorizontalAlignment="Center"
                    Orientation="Horizontal"
                    Spacing="16">
                    <ToggleButton
                        Width="48"
                        Height="48"
                        Command="{x:Bind MyViewModel.ToggleShuffleCommand}"
                        IsChecked="{x:Bind MyViewModel.IsShuffleActive, Mode=OneWay}">
                        <SymbolIcon Symbol="Shuffle" />
                    </ToggleButton>
                    <Button
                        Width="56"
                        Height="56"
                        Command="{x:Bind MyViewModel.PreviousTrackCommand}">
                        <FontIcon
                            FontSize="20"
                            Glyph="&#xE892;" />
                    </Button>
                    <ToggleButton
                        Width="72"
                        Height="72"
                        Command="{x:Bind MyViewModel.PlayPauseToggleCommand}"
                        Content="{x:Bind MyViewModel.IsDimmerPlaying, Converter={StaticResource BoolToPlayingPauseConverter}, Mode=OneWay}"
                        IsChecked="{x:Bind MyViewModel.IsDimmerPlaying, Mode=OneWay}"
                         />
                    <Button
                        Width="56"
                        Height="56"
                        Command="{x:Bind MyViewModel.NextTrackCommand}">
                        <SymbolIcon Symbol="Next" />
                    </Button>
                    <Button
                        Width="48"
                        Height="48"
                        Command="{x:Bind MyViewModel.ToggleRepeatModeCommand}"
                        Content="{x:Bind MyViewModel.CurrentRepeatMode, Converter={StaticResource RepeatModeConverter}, Mode=OneWay}" />
                </StackPanel>

                <!--  Additional Actions  -->
                <StackPanel
                    HorizontalAlignment="Center"
                    Orientation="Horizontal"
                    Spacing="12">
                    <Button
                        Content="All Songs"
                        x:Name="ViewAllSongs"
                        Click="ViewAllSongs_Click"
                        Style="{StaticResource SecondaryButtonStyle}">
                        
                    </Button>
                    <Button
                        Content="Queue"
                        Style="{StaticResource SecondaryButtonStyle}">
                        <Button.Flyout>
                            <Flyout>
                                <TextBlock Text="Queue functionality" />
                            </Flyout>
                        </Button.Flyout>
                    </Button>
                    <Button
                        Click="ViewLyricsButton_Click"
                        Content="Lyrics"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Visibility="{x:Bind MyViewModel.CurrentPlayingSongView.HasSyncedLyrics, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}" />
                    <Button
                        Click="ViewSongDetailsButton_Click"
                        Content="Details"
                        Style="{StaticResource SecondaryButtonStyle}" />
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
