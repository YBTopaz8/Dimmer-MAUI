<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Dimmer.WinUI.Views.WinUIPages.AllSongsListPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:chart="http://schemas.syncfusion.com/maui/toolkit"
    xmlns:converters="clr-namespace:Dimmer.Utilities.TypeConverters;assembly=Dimmer"
    xmlns:cw="clr-namespace:Dimmer.WinUI.Views.CustomViews"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dgView="using:WinUI.TableView"
    xmlns:dimmSearch="clr-namespace:Dimmer.Data.ModelView.DimmerSearch;assembly=Dimmer"
    xmlns:lang="clr-namespace:Dimmer.Resources.Localization;assembly=Dimmer"
    xmlns:local="using:Dimmer.WinUI.Views.WinUIPages"
    xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer"
    xmlns:modelsDb="clr-namespace:Dimmer.Data.Models;assembly=Dimmer"
    xmlns:modeltwo="clr-namespace:Dimmer.WinUI.Utils.Models"
    xmlns:queryBuilder="queries"
    xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:tql="clr-namespace:Dimmer.DimmerSearch.TQL;assembly=Dimmer"
    xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
    xmlns:vm="clr-namespace:Dimmer.WinUI.ViewModel"
    xmlns:windows="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.WindowsSpecific;assembly=Microsoft.Maui.Controls"
    x:Name="MyPageGrid"
    Loaded="MyPageGrid_Loaded"
    Unloaded="MyPageGrid_Unloaded"
    mc:Ignorable="d">


    <Grid
        Grid.Row="0"
        Margin="10"
        RowSpacing="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackPanel
            Grid.Row="0"
            Padding="10"
            BorderBrush="DarkSlateBlue"
            BorderThickness="1"
            CornerRadius="20"
            Spacing="10">

            <StackPanel
                x:Name="TopPanel"
                HorizontalAlignment="Center"
                Orientation="Horizontal"
                Spacing="10">



                <StackPanel
                    x:Name="TopPanelTwo"
                    HorizontalAlignment="Center"
                    Orientation="Horizontal"
                    Spacing="10">



                    <TextBlock
                        HorizontalAlignment="Center"
                        IsTextSelectionEnabled="True"
                        Text="{Binding CurrentPlayingSongView.Title}"
                        TextDecorations="Underline" />


                    <TextBlock
                        HorizontalAlignment="Center"
                        FontStyle="Italic"
                        IsTextSelectionEnabled="True"
                        Text="{Binding CurrentPlayingSongView.ArtistName}" />

                    <TextBlock
                        HorizontalAlignment="Center"
                        IsTextSelectionEnabled="True"
                        Text="{Binding CurrentPlayingSongView.AlbumName}" />

                </StackPanel>



                <TextBlock
                    HorizontalAlignment="Center"
                    IsTextSelectionEnabled="True"
                    Text="{Binding TQLUserSearchErrorMessage}"
                    TextDecorations="Underline" />
            </StackPanel>
            <TextBlock
                x:Name="SearchSongSB"
                HorizontalAlignment="Center"
                FocusVisualPrimaryBrush="DarkSlateBlue"
                FontSize="25"
                FontStretch="Expanded"
                FontWeight="ExtraBold"
                Text="{Binding CurrentTqlQuery}" />



            <StackPanel
                HorizontalAlignment="Center"
                Orientation="Horizontal"
                Spacing="10">


                <TextBox
                    x:Name="SearchTetxBox"
                    Width="550"
                    AccessKey="F"
                    AccessKeyInvoked="SearchAutoSuggestBox_AccessKeyInvoked"
                    BorderThickness="2"
                    KeyboardAcceleratorPlacementMode="Auto"
                    PlaceholderText="Search with TQL..."
                    Text="{x:Bind MyViewModel.CurrentTqlQuery}"
                    TextChanged="SearchAutoSuggestBox_TextChanged" />
            </StackPanel>
            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                <Button
                    Command="{x:Bind MyViewModel.SearchSongSB_TextChangedCommand}"
                    CommandParameter="{x:Bind MyViewModel.CurrentTqlQuery}"
                    Content="Run" />
                <Button Command="{x:Bind MyViewModel.ResetSearchCommand}" Content="Clear" />
                <Button Command="{x:Bind MyViewModel.AddToNextCommand}" Content="Add To Next" />
                <Button Command="{x:Bind MyViewModel.AddToQueueCommand}" Content="Add To End" />
                <Button Command="{x:Bind MyViewModel.EnsureAllCoverArtCachedForSongsCommand}" Content="Reload Images" />

                <TextBlock VerticalAlignment="Center" Text="{x:Bind MyViewModel.SearchResults.Count}" />



                <TextBlock VerticalAlignment="Center" Text="Songs Found" />



            </StackPanel>

            <!--<StackPanel Orientation="Horizontal"
                        >
                <Button Content="Filter by This" Command="{x:Bind MyViewModel.FilterBySelectionCommand}" />
                <Button Content="And..." Command="{x:Bind MyViewModel.AddFilterFromSelectionCommand}" />
                <Button Content="Or..." Command="{x:Bind MyViewModel.IncludeSelectionCommand}" />
                <Button Content="But Not..." Command="{x:Bind MyViewModel.ExcludeSelectionCommand}" />

                <Button Content="Reset Search" Command="{x:Bind MyViewModel.ResetSearchCommand}" />
            </StackPanel>-->

        </StackPanel>


        <dgView:TableView
            x:Name="MySongsTableView"
            Grid.Row="1"
            AllowFocusOnInteraction="False"
            AllowFocusWhenDisabled="False"
            AutoGenerateColumns="False"
            BringIntoViewRequested="TableView_BringIntoViewRequested"
            CanDrag="False"
            CanDragItems="True"
            CellContextFlyoutOpening="MySongsTableView_CellContextFlyoutOpening"
            CellSelectionChanged="MySongsTableView_CellSelectionChanged"
            ChoosingGroupHeaderContainer="MySongsTableView_ChoosingGroupHeaderContainer"
            ChoosingItemContainer="MySongsTableView_ChoosingItemContainer"
            ClearSorting="MySongsTableView_ClearSorting"
            ContextRequested="MySongsTableView_ContextRequested"
            CurrentCellChanged="MySongsTableView_CurrentCellChanged"
            DoubleTapped="TableView_DoubleTapped"
            DragItemsCompleted="MySongsTableView_DragItemsCompleted"
            DragItemsStarting="MySongsTableView_DragItemsStarting"
            DragStarting="MySongsTableView_DragStarting"
            ExportSelectedContent="TableView_ExportSelectedContent"
            GettingFocus="MySongsTableView_GettingFocus"
            GotFocus="MySongsTableView_GotFocus"
            Holding="MySongsTableView_Holding"
            IsItemClickEnabled="True"
            IsRightTapEnabled="True"
            IsSwipeEnabled="True"
            ItemClick="MySongsTableView_ItemClick"
            ItemsSource="{x:Bind MyViewModel.SearchResults}"
            Loading="MySongsTableView_Loading"
            LosingFocus="MySongsTableView_LosingFocus"
            LostFocus="MySongsTableView_LostFocus"
            PointerEntered="MySongsTableView_PointerEntered"
            PointerExited="MySongsTableView_PointerExited"
            PointerPressed="TableView_PointerPressed"
            PointerReleased="MySongsTableView_PointerReleased"
            ProcessKeyboardAccelerators="MySongsTableView_ProcessKeyboardAccelerators"
            RightTapped="TableView_RightTapped"
            RowContextFlyoutOpening="MySongsTableView_RowContextFlyoutOpening"
            SelectionChanged="MySongsTableView_SelectionChanged"
            SelectionMode="Single"
            Sorting="MySongsTableView_Sorting"
            Style="{StaticResource AcrylicDataGridStyle}"
            Tapped="MySongsTableView_Tapped">

            <dgView:TableView.ContextFlyout>
                <MenuFlyout>
                    <MenuFlyoutItem
                        x:Name="AddToNext"
                        Click="ViewSong_Click"
                        Command="{x:Bind MyViewModel.AddToNextCommand}"
                        CommandParameter="{x:Bind MySongsTableView.ItemsSource}"
                        Text="Play Next" />
                    <MenuFlyoutSeparator />


                    <MenuFlyoutItem
                        x:Name="AddToEnd"
                        Command="{x:Bind MyViewModel.AddToQueueEndCommand}"
                        CommandParameter="{x:Bind MySongsTableView.ItemsSource}"
                        Text="Add to End of Queue" />
                    <MenuFlyoutSeparator />



                    <MenuFlyoutItem Text="Option with an Icon">
                        <MenuFlyoutItem.Icon>
                            <FontIcon Glyph="&#xE71E;" />
                            <!--  This is a 'Save' icon  -->
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>
                </MenuFlyout>

            </dgView:TableView.ContextFlyout>
            <dgView:TableView.Columns>

                <!--  Column for the Cover Art  -->
                <dgView:TableViewTemplateColumn Header="Cover">
                    <dgView:TableViewTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid x:Name="CoverImageGrid" PointerReleased="CoverImageGrid_PointerReleased">


                                <!--  You can even overlay a "favorite" icon like in your example  -->
                                <Image
                                    x:Name="coverArtImage"
                                    Width="100"
                                    Height="100"
                                    CanDrag="True"
                                    Source="{Binding CoverImagePath}"
                                    Stretch="UniformToFill" />


                            </Grid>
                        </DataTemplate>
                    </dgView:TableViewTemplateColumn.CellTemplate>
                </dgView:TableViewTemplateColumn>

                <!--  Other columns for Title, Artist, etc.  -->
                <dgView:TableViewCheckBoxColumn
                    Binding="{Binding HasSyncedLyrics}"
                    Header="HasLyrics"
                    IsReadOnly="True" />


                <dgView:TableViewTextColumn
                    MaxWidth="310"
                    Binding="{Binding Title}"
                    Header="Title"
                    IsReadOnly="True" />
                <dgView:TableViewTextColumn
                    MaxWidth="200"
                    Binding="{Binding ArtistName}"
                    Header="Artist"
                    IsReadOnly="True" />

                <dgView:TableViewTextColumn
                    MaxWidth="180"
                    Binding="{Binding AlbumName}"
                    Header="Album"
                    IsReadOnly="True" />

                <dgView:TableViewTextColumn
                    Binding="{Binding GenreName}"
                    Header="Genre"
                    IsReadOnly="True" />
                <dgView:TableViewTextColumn
                    Binding="{Binding FileFormat}"
                    Header="Format"
                    IsReadOnly="True" />
                <dgView:TableViewTextColumn
                    Binding="{Binding DurationFormatted}"
                    Header="Duration"
                    IsReadOnly="True" />
                <dgView:TableViewTextColumn
                    Binding="{Binding ReleaseYear}"
                    CanFilter="False"
                    CanSort="True"
                    Header="Year"
                    IsFiltered="False"
                    IsReadOnly="True" />
                <dgView:TableViewTextColumn
                    Binding="{Binding PlayCompletedCount}"
                    Header="Dims"
                    IsReadOnly="True" />
                <dgView:TableViewTemplateColumn Header="Is Fav" IsReadOnly="False">
                    <dgView:TableViewTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <CheckBox
                                    HorizontalContentAlignment="Center"
                                    VerticalContentAlignment="Center"
                                    Click="CheckBox_Click"
                                    ClickMode="Release"
                                    IsChecked="{Binding IsFavorite}" />
                            </Grid>
                        </DataTemplate>
                    </dgView:TableViewTemplateColumn.CellTemplate>
                    <!--<dgView:TableViewTemplateColumn.EditingTemplate>
                            <DataTemplate>
                                <NumberBox Value="{Binding Quantity, Mode=TwoWay}" />
                            </DataTemplate>
                        </dgView:TableViewTemplateColumn.EditingTemplate>-->
                </dgView:TableViewTemplateColumn>
                <dgView:TableViewTextColumn
                    Binding="{Binding SkipCount}"
                    Header="Skip Count"
                    IsReadOnly="True" />
                <dgView:TableViewTextColumn
                    Binding="{Binding GlobalRank}"
                    Header="Global Rank"
                    IsReadOnly="True" />

            </dgView:TableView.Columns>
        </dgView:TableView>

    </Grid>
</Page>
