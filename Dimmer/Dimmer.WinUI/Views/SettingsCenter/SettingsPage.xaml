<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Dimmer.WinUI.Views.SettingsCenter.SettingsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:Dimmer.Utilities.TypeConverters;assembly=Dimmer"
    xmlns:cw="clr-namespace:Dimmer.WinUI.Views.CustomViews"
    xmlns:idk="clr-namespace:Indiko.Maui.Controls.Markdown;assembly=Indiko.Maui.Controls.Markdown"
    xmlns:lang="clr-namespace:Dimmer.Resources.Localization;assembly=Dimmer"
    xmlns:libSanity="clr-namespace:Dimmer.Data.ModelView.LibSanityModels;assembly=Dimmer"
    xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer"
    xmlns:modeltwo="clr-namespace:Dimmer.WinUI.Utils.Models"
    xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
    xmlns:vm="clr-namespace:Dimmer.WinUI.ViewModel"
    Title="Settings"
    x:DataType="vm:BaseViewModelWin"
    Shell.FlyoutBehavior="Flyout"
    Shell.NavBarIsVisible="False">
    <Grid IsVisible="True" RowDefinitions="auto,*">
        <VerticalStackLayout Grid.Row="0">
            <Label
                FontSize="35"
                HorizontalOptions="Center"
                Text="{Binding LatestScanningLog}" />
            <ProgressBar
                x:Name="MyProgressBar"
                IsVisible="False"
                WidthRequest="80" />
            <Label
                x:Name="MyProgressLabel"
                IsVisible="False"
                WidthRequest="180" />

        </VerticalStackLayout>
        <syncf:SfTabView
            x:Name="NavTab"
            Grid.Row="1"
            SelectionChanged="NavTab_SelectionChanged"
            TabBarPlacement="Top">

            <syncf:SfTabItem Header="Main">

                <syncf:SfTabItem.Content>
                    <Grid Margin="10,0" RowDefinitions="*">
                        <Grid Grid.Row="1" RowDefinitions="auto,*">

                            <VerticalStackLayout
                                Grid.Row="0"
                                BackgroundColor="Transparent"
                                HorizontalOptions="Start"
                                Spacing="10">
                                <Button
                                    Command="{Binding ValidateLibraryCommand}"
                                    IsVisible="False"
                                    Text="Validate Songs" />

                                <Button
                                    Clicked="AddNewMusicFolder_Clicked"
                                    HorizontalOptions="Start"
                                    Text="Add New Folder" />


                                <Button
                                    Clicked="RefreshLyrics_Clicked"
                                    HorizontalOptions="Start"
                                    Text="Refresh Lyrc" />

                                <Button
                                    x:Name="ReScanAllBtn"
                                    BorderColor="DarkSlateBlue"
                                    Command="{Binding RescanSongsCommand}"
                                    Text="Rescan folders" />
                                <Button
                                    x:Name="Reconcile"
                                    BorderColor="DarkSlateBlue"
                                    Command="{Binding ReconcileLibraryCommand}"
                                    IsVisible="False"
                                    Text="Reconcile Songs" />
                                <Button
                                    x:Name="FindDupes"
                                    BackgroundColor="SlateBlue"
                                    Clicked="FindDupes_Clicked"
                                    IsVisible="False"
                                    Text="Find Duplicate Songs and Files" />


                            </VerticalStackLayout>
                            <CollectionView
                                x:Name="ListOfFolders"
                                Grid.Row="1"
                                Header="List of Folders"
                                ItemsSource="{Binding FolderPaths}"
                                SelectionMode="None">
                                <CollectionView.EmptyView>
                                    <VerticalStackLayout>
                                        <Label
                                            Margin="0,40,0,0"
                                            FontAttributes="Italic"
                                            Text="No Folders In Preferences.." />
                                    </VerticalStackLayout>
                                </CollectionView.EmptyView>
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="x:String">
                                        <Grid ColumnDefinitions="*,*">

                                            <Label Grid.Column="0" Text="{Binding .}" />

                                            <HorizontalStackLayout Grid.Column="1" Spacing="25">
                                                <ImageButton
                                                    x:Name="ChangeFolder"
                                                    Clicked="ChangeFolder_Clicked"
                                                    CommandParameter="{Binding .}"
                                                    Source="foldera.png" />

                                                <ImageButton
                                                    x:Name="DeleteBtn"
                                                    Clicked="DeleteBtn_Clicked"
                                                    CommandParameter="{Binding .}"
                                                    Source="delete.png" />
                                                <syncf:SfChip
                                                    x:Name="RescanFolder"
                                                    Clicked="RescanFolder_Clicked"
                                                    CommandParameter="{Binding .}"
                                                    ImageSize="50"
                                                    ImageSource="repeat.png"
                                                    WidthRequest="65" />
                                            </HorizontalStackLayout>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>

                        </Grid>


                    </Grid>
                </syncf:SfTabItem.Content>
            </syncf:SfTabItem>

            <syncf:SfTabItem Header="LastFM Tab" TextColor="{AppThemeBinding Light=Black, Dark=White}">
                <syncf:SfTabItem.Content>
                    <VerticalStackLayout Margin="10" Spacing="10">
                        <Editor
                            Placeholder="UserName"
                            PlaceholderColor="{AppThemeBinding Dark=White,
                                                               Light=Black}"
                            Text="{Binding UserLocal.LastFMAccountInfo.Name}">
                            <Editor.Triggers>
                                <DataTrigger
                                    Binding="{Binding IsLastfmAuthenticated}"
                                    TargetType="Editor"
                                    Value="True">
                                    <Setter Property="IsVisible" Value="False" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding IsLastfmAuthenticated}"
                                    TargetType="Editor"
                                    Value="False">
                                    <Setter Property="IsVisible" Value="True" />
                                </DataTrigger>
                            </Editor.Triggers>
                        </Editor>
                        <HorizontalStackLayout HorizontalOptions="End">


                            <ImageButton
                                HeightRequest="50"
                                Source="lastfm.png"
                                ToolTipProperties.Text="{Binding IsLastfmAuthenticated, StringFormat='Is Authenticated :{0} '}"
                                WidthRequest="50">
                                <ImageButton.Behaviors>
                                    <toolkit:IconTintColorBehavior TintColor="Red" />
                                </ImageButton.Behaviors>
                                <ImageButton.Triggers>
                                    <DataTrigger
                                        Binding="{Binding IsLastfmAuthenticated}"
                                        TargetType="ImageButton"
                                        Value="False">

                                        <Setter Property="IsEnabled" Value="False" />
                                        <Setter Property="Opacity" Value="0.2" />
                                    </DataTrigger>
                                </ImageButton.Triggers>
                            </ImageButton>
                        </HorizontalStackLayout>



                        <Button
                            BorderWidth="2"
                            Command="{Binding LoginToLastfmCommand}"
                            HorizontalOptions="Start"
                            IsVisible="{Binding LastFMLoginBtnVisible}"
                            Text="Login" />

                        <Button
                            BorderWidth="2"
                            Command="{Binding CompleteLastFMLoginCommand}"
                            HorizontalOptions="Start"
                            IsVisible="{Binding lastFMCOmpleteLoginBtnVisible}"
                            Text="Confirm Login" />

                        <VerticalStackLayout BackgroundColor="Transparent">
                            <VerticalStackLayout.Triggers>
                                <DataTrigger
                                    Binding="{Binding IsLastfmAuthenticated}"
                                    TargetType="VerticalStackLayout"
                                    Value="True">
                                    <Setter Property="IsVisible" Value="True" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding IsLastfmAuthenticated}"
                                    TargetType="VerticalStackLayout"
                                    Value="False">
                                    <Setter Property="IsVisible" Value="False" />
                                </DataTrigger>
                            </VerticalStackLayout.Triggers>

                            <Border HorizontalOptions="Center" StrokeShape="RoundRectangle 150">

                                <Image Source="{Binding UserLocal.LastFMAccountInfo.Image.Url}" WidthRequest="180" />

                            </Border>
                            <Label
                                FontSize="20"
                                HorizontalOptions="Center"
                                Text="{Binding UserLocal.LastFMAccountInfo.Name}"
                                TextColor="DarkSlateBlue" />
                            <Label
                                FontSize="15"
                                HorizontalOptions="Center"
                                Text="{Binding UserLocal.LastFMAccountInfo.Country}"
                                TextColor="DarkSlateBlue" />

                        </VerticalStackLayout>
                    </VerticalStackLayout>

                </syncf:SfTabItem.Content>
            </syncf:SfTabItem>
            <syncf:SfTabItem Header="Latest Update">
                <VerticalStackLayout Margin="10,0" Spacing="15">
                    <Label
                        FontSize="36"
                        HorizontalOptions="Center"
                        Text="{Binding AppUpdateObj.title}" />
                    <idk:MarkdownView
                        x:Name="RelLinkss"
                        BlockQuoteBackgroundColor="LightYellow"
                        BlockQuoteBorderColor="YellowGreen"
                        BlockQuoteTextColor="LightGray"
                        CodeBlockBackgroundColor="#1e1e1e"
                        CodeBlockBorderColor="DarkSlateGray"
                        CodeBlockFontSize="12"
                        CodeBlockTextColor="DimGrey"
                        H1Color="CadetBlue"
                        H1FontSize="25"
                        H2Color="DeepSkyBlue"
                        H2FontSize="23"
                        H3Color="BlueViolet"
                        H3FontSize="19"
                        HyperlinkColor="AliceBlue"
                        ImageAspect="Fill"
                        LineColor="LightSlateGray"
                        LineHeightMultiplier="1.2"
                        LinkCommand="{Binding LinkReceivedCommand}"
                        MarkdownText="{Binding AppUpdateObj.notes}"
                        OnHyperLinkClicked="RelLinkss_OnHyperLinkClicked"
                        ParagraphSpacing="5"
                        TableHeaderBackgroundColor="DarkGray"
                        TableHeaderFontSize="13"
                        TableHeaderTextColor="WhiteSmoke"
                        TableRowFontSize="11"
                        TextColor="{AppThemeBinding Dark=White,
                                                    Light=Black}"
                        TextFontSize="13" />


                    <Label Text="{Binding AppUpdateObj.url}" />



                    <Button
                        x:Name="DownloadAndInstall"
                        Command="{Binding DownloadAndInstallCommand}"
                        Text="Download And Install" />

                </VerticalStackLayout>
            </syncf:SfTabItem>
            <syncf:SfTabItem x:Name="ViewAdminUpdate" Header="App Center">
                <VerticalStackLayout>
                    <Label Text="App Center" />
                    <Button Command="{Binding CheckForAppUpdatesCommand}" Text="Check for App Updates" />
                    <!--<Button Text="App Center"
                      Command="{Binding CheckForAppUpdatesCommand}"   />-->

                    <Border>

                        <VerticalStackLayout>
                            <Label Text="New Release" />
                            <Editor
                                x:Name="RelTitle"
                                HeightRequest="200"
                                Placeholder="Release Title" />
                            <Editor x:Name="RelNotes" Placeholder="Release Notes" />
                            <Editor x:Name="RelLink" Placeholder="Release Url" />

                            <Button
                                x:Name="PostUpdate"
                                Clicked="PostUpdate_Clicked"
                                Text="Post Update" />

                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </syncf:SfTabItem>





        </syncf:SfTabView>



    </Grid>

</ContentPage>