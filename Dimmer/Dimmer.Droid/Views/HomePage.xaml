<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Dimmer.Views.HomePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:Dimmer.Utilities.TypeConverters;assembly=Dimmer"
    
    xmlns:dx="http://schemas.devexpress.com/maui"
    xmlns:helper="clr-namespace:Dimmer.Utils.AnimsStatics"
    xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer"
    xmlns:navDrawer="clr-namespace:Syncfusion.Maui.Toolkit.NavigationDrawer;assembly=Syncfusion.Maui.Toolkit"
    xmlns:progressBar="clr-namespace:Syncfusion.Maui.Toolkit;assembly=Syncfusion.Maui.Toolkit"
    xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:viewUtils="clr-namespace:Dimmer.Utilities.ViewsUtils;assembly=Dimmer"
    xmlns:vm="clr-namespace:Dimmer.ViewModels"
    
    Title="HomePage"
    x:DataType="vm:BaseViewModelAnd"
    x:FieldModifier="Public"
    BackgroundColor="{AppThemeBinding Light=#F5F5F5,
                                      Dark=#1131314}"
    Shell.NavBarIsVisible="False"
    Shell.TabBarIsVisible="False">

    <ContentPage.Resources>
        <ResourceDictionary>

            <DataTemplate x:DataType="models:SongModelView" x:Key="OGView">

                <dx:DXStackLayout>

                    <Grid
                                                BackgroundColor="Transparent"
                                                RowDefinitions="60" ColumnSpacing="1"
                                                ColumnDefinitions="auto,*,auto"
                                                
                                                VerticalOptions="Center">
                        <syncf:SfEffectsView Grid.Column="0"
                                                      BackgroundColor="Green"
                                            x:Name="ViewSongOnly"                    
                                                                 TouchDown="ViewSongOnly_TouchDown"
                                                           TouchDownCommandParameter="{Binding .}">
                            <syncf:SfEffectsView.Triggers>
                                <DataTrigger
Binding="{Binding HasSyncedLyrics}"
TargetType="syncf:SfEffectsView"
Value="True">
                                    <Setter Property="BackgroundColor" Value="DarkSlateBlue" />

                                </DataTrigger>
                                <DataTrigger
Binding="{Binding HasSyncedLyrics}"
TargetType="syncf:SfEffectsView"
Value="False">
                                    <Setter Property="BackgroundColor" Value="Transparent" />

                                </DataTrigger>
                            </syncf:SfEffectsView.Triggers>
                            <dx:DXBorder CornerRadius="15" 
                                                             BorderThickness="2">

                                <Image  
                                                         
                                               Source="{Binding CoverImagePath}"/>

                            </dx:DXBorder>

                        </syncf:SfEffectsView>
                        <dx:DXButton
                                                CornerRadius="5"
                                                    x:Name="TitleAndArtists"
                                                    Grid.Column="1" Padding="0"
                                                HorizontalContentAlignment="Start"
                                                    BackgroundColor="Transparent"
                                                Clicked="PlaySongClicked"
                                                PressedTextColor="White"
                                                CommandParameter="{Binding .}"
                                                    VerticalOptions="Center">
                            <dx:DXButton.Content>
                                <dx:DXStackLayout>
                                    <Label
      x:Name="SongTitleChip"
      Padding="10,0"
      BackgroundColor="Transparent"
      FontAttributes="Bold"
      FontSize="16"
      HorizontalOptions="Start"
      Opacity="0.8"
      LineBreakMode="TailTruncation"
      Text="{Binding Title}"
      TextColor="{AppThemeBinding Dark=White,
                                  Light=black}"
      VerticalOptions="Center" >
                                        <Label.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding IsCurrentPlayingHighlight}"
               Value="True">
                                                <Setter Property="TextColor" Value="DarkSlateBlue"/>
                                                <Setter Property="FontSize" Value="18"/>
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                    <dx:Chip
                                                        x:Name="ArtistsChip"
                                                              Padding="10,0"

                                                        BackgroundColor="Transparent"
                                                        BorderThickness="0"
                                                        
                                                        FontSize="12"
                                                        HorizontalOptions="Start"
                                                        LongPress="ArtistsChip_LongPress"
                                                        LongPressCommandParameter="{Binding ArtistName}"
                                                        Opacity="0.6"
                                                        Text="{Binding ArtistName}"
                                                        TextColor="{AppThemeBinding Dark=White,
                                                                                    Light=black}"
                                                        VerticalOptions="Center" />

                                    <dx:Chip
                                                            x:Name="AlbumFilter"
                                                            BackgroundColor="Transparent"
                                                            BorderThickness="0"
                                                            FontAttributes="Italic"
                                                            FontSize="10"
                                                                  Padding="10,0"

                                                            HorizontalOptions="Start"
                                                            LongPress="AlbumFilter_LongPress"
                                                            LongPressCommandParameter="{Binding AlbumName}"
                                                            Opacity="0.5"
                                                            Text="{Binding AlbumName}"
                                                            UseRippleEffect="True"
                                                            VerticalOptions="Center" />



                                </dx:DXStackLayout>

                            </dx:DXButton.Content>
                        </dx:DXButton>


                        <dx:Chip
                                                    x:Name="MoreIcon"
                                                    Grid.Column="2"
                                                    Padding="20"
                                                FontSize="15"
                                                    BorderColor="DarkSlateBlue"
                                                    BorderThickness="0.7"
                                                    CornerRadius="25"
                                                    HorizontalOptions="End"
                                                    IsIconVisible="False"
                                                    LongPress="MoreIcon_LongPress"
                                                    PressedBackgroundColor="DarkSlateBlue"
                                                    PressedBorderColor="DarkSlateBlue"
                                                    Tap="MoreIcon_Tap"
                                                  Text="{Binding DurationInSeconds, Converter={converters:DurationConverterFromMsToTimeSpan}}"
                                                    
                                                TextColor="{AppThemeBinding Dark=White,
                                                                                Light=black}" >

                        </dx:Chip>
                    </Grid>


                </dx:DXStackLayout>
            </DataTemplate>
            <DataTemplate x:DataType="models:SongModelView" x:Key="NowPlayingView">

                <dx:DXStackLayout x:Name="SongView" 
                                  CornerRadius="15"                            
                                  Loaded="SongView_Loaded"
                                                                  BorderThickness="1">
                    <dx:DXStackLayout.Behaviors>
                      
                            
                    </dx:DXStackLayout.Behaviors>



                    <dx:DXBorder 
                                                             BorderThickness="2">

                        <Image  
                                                         HeightRequest="200"
                                               Source="{Binding CoverImagePath}"/>

                    </dx:DXBorder>
                    <Label Text="{Binding Title}"
       />

              
                </dx:DXStackLayout>
            </DataTemplate>



            <DataTemplate x:Key="filteringUIFormTemplate">
                <dx:DXScrollView>
                    <dx:DXStackLayout>

                        <dx:FilterChipGroupItem FieldName="FileFormat" Text="FileFormat" />
                        <dx:FilterCheckItem FieldName="IsFavorite" Text="Is Favorite?" />
                    </dx:DXStackLayout>
                </dx:DXScrollView>
            </DataTemplate>
            <Style TargetType="Label">
                <Setter Property="Text" Value="{AppThemeBinding Dark=White, Light=black}" />
                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="FontSize" Value="26" />
            </Style>

            <Style TargetType="dx:Chip">

                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="FontSize" Value="19" />
            </Style>

            <Style TargetType="Grid">

                <Setter Property="BackgroundColor" Value="Transparent" />

            </Style>

            <Style TargetType="dx:DXButton">

                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="TextColor" Value="{AppThemeBinding Dark=White, Light=Black}" />
                <Setter Property="IconColor" Value="DarkSlateBlue" />
                <Setter Property="PressedBackgroundColor" Value="DarkSlateBlue" />
                <Setter Property="PressedIconColor" Value="{AppThemeBinding Dark=White,Light=Black}" />
            </Style>

            <Style x:Key="LittleBtn" TargetType="dx:DXButton">
                <Setter Property="IconHeight" Value="19" />
            </Style>
            <converters:DurationConverterFromMsToTimeSpan x:Key="DurationConverter" />
            <converters:BytesToMegabytesConverter x:Key="FileSizeConverter" />
            <converters:BytesArrayToImageSource x:Key="BytesToImageConverter" />
            <converters:BoolToInverseConverter x:Key="BoolToInverse" />
            <converters:IndexToVisibilityConverter x:Key="IndexToVisibilityConverter" />
            <converters:DateTimeToLocalDateConverter x:Key="DateTimeConverter" />
            <converters:DateTimeToLocalTimeConverter x:Key="DateTimeToTimeConverter" />
            <converters:BoolToYesNoConverter x:Key="BoolToYesNo" />
            <converters:VolumeConverter x:Key="VolConverter" />

        </ResourceDictionary>



    </ContentPage.Resources>
    <Grid x:Name="RootLayout" Margin="0">
        <!--<dx:DXImage
            Aspect="AspectFill"
            Opacity="{AppThemeBinding Light=0,
                                      Dark=0.09}"
            Source="{Binding CurrentPlayingSongView.CoverImageBytes, Converter={converters:BytesArrayToImageSource}}" />-->

        <dx:SafeKeyboardAreaView
            x:Name="myPageSKAV"
            Closed="myPageSKAV_Closed"
            FitKeyboardAreaToContent="SizeToContent"
            IsVisible="True">
            <dx:DXDockLayout x:Name="HomeView" BackgroundColor="Transparent">

                
                <!--<dx:DXScrollView x:Name="MainPageScrollView">-->

                <Grid
                    x:Name="SearchContentView"
                    x:DataType="vm:BaseViewModelAnd"
                    IsVisible="True" RowSpacing="0"
                    Margin="0,0" 
                    RowDefinitions="auto,*,auto">
                    <Grid Grid.Row="0">

                        <dx:DXExpander 
                            
xmlns:dx="http://schemas.devexpress.com/maui"
xmlns:helper="clr-namespace:Dimmer.Utils.AnimsStatics"
xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer"
xmlns:navDrawer="clr-namespace:Syncfusion.Maui.Toolkit.NavigationDrawer;assembly=Syncfusion.Maui.Toolkit"
xmlns:progressBar="clr-namespace:Syncfusion.Maui.Toolkit;assembly=Syncfusion.Maui.Toolkit"
xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit"
xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
xmlns:viewUtils="clr-namespace:Dimmer.Utilities.ViewsUtils;assembly=Dimmer"
xmlns:vm="clr-namespace:Dimmer.ViewModels"
x:Name="TopBeforeColView"
                            
x:FieldModifier="Public">
                            <dx:DXStackLayout>
                                <dx:DXStackLayout.Resources>
                                    <ResourceDictionary>
                                        <converters:DurationConverterFromMsToTimeSpan x:Key="DurationConverter" />
                                        <converters:BytesToMegabytesConverter x:Key="FileSizeConverter" />
                                        <converters:BytesArrayToImageSource x:Key="BytesToImageConverter" />
                                        <converters:BoolToInverseConverter x:Key="BoolToInverse" />
                                        <Style TargetType="dx:DXButton">
                                            <Setter Property="ButtonType" Value="ToolButton" />
                                            <Setter Property="HorizontalContentAlignment" Value="Start" />
                                            <Setter Property="IconHeight" Value="30" />
                                            <Setter Property="IconWidth" Value="30" />
                                            <Setter Property="IconColor" Value="#585858" />
                                        </Style>
                                    </ResourceDictionary>
                                </dx:DXStackLayout.Resources>

                                <dx:DXStackLayout
                BackgroundColor="Transparent"
                CornerRadius="20"
                HorizontalOptions="Center"
                IsVisible="False"
                Orientation="Horizontal">

                                    <dx:DXButton
                    HorizontalOptions="Start"
                    Icon="searchd.png"
                    ShowIcon="True" />

                                    <dx:DXButton
                    HorizontalOptions="Start"
                    Icon="shuffle.png"
                    ShowIcon="True" />

                                    <dx:DXButton
                    HorizontalOptions="Start"
                    Icon="playlistadd.png"
                    ShowIcon="True" />

                                </dx:DXStackLayout>

                                <dx:TextEdit
                x:Name="SearchBy"
                Margin="10"
                x:FieldModifier="Public"
                BorderColor="#585858"
                CornerRadius="20"
                Focused="SearchBy_Focused"
                FocusedBorderColor="DarkSlateBlue"
                PlaceholderColor="DarkSlateBlue"
                PlaceholderText="Search..."
                StartIcon="searchd.png"
                StartIconColor="DarkSlateBlue"
                TextChanged="SearchBy_TextChanged" />
                                <dx:DXStackLayout
                x:Name="OpenedKeyboardToolbar"
                BackgroundColor="Transparent"
                IsVisible="True">

                                    <HorizontalStackLayout
                    Grid.Column="1"
                    BackgroundColor="Transparent"
                    HorizontalOptions="End"
                    Spacing="5"
                    VerticalOptions="Start">
                                        <Label x:Name="SongsCountLabel" 
                           TextColor="{AppThemeBinding Dark=#999999, Light=black}"
                           Text="{Binding SearchResults.Count, StringFormat='Songs : {0}'}" />


                                        <dx:Chip
                        x:Name="Settings"
                        
                        BorderThickness="0"
                        Icon="settings.png"
                        IconColor="DarkSlateBlue"
                        IconSize="35,35"
                        IsIconVisible="True"
                        Tap="Settings_Tap" />

                                        <dx:Chip
                        x:Name="ScrollToCurrSong"
                        BorderThickness="0"
                        Icon="eye.png"
                        IconSize="35,35"
                        IsIconVisible="True"
                        Tap="ScrollToCurrSong_Tap" />







                                    </HorizontalStackLayout>

                                </dx:DXStackLayout>
                                <Label
                x:Name="MyProgressLabel"
                IsVisible="False"
                
                HeightRequest="70"/>
                                <ProgressBar
                x:Name="MyProgressBar"
                IsVisible="False"
                WidthRequest="80" />


                            </dx:DXStackLayout>
                        </dx:DXExpander>

                    </Grid>

                    <Grid Grid.Row="1">
                        <dx:TabView x:Name="MainViewTabView" HeaderPanelPosition="Bottom"
                                    HeaderPanelHeight="50"
                                    SelectedItemIndex="{Binding NowPlayingTabIndex, Mode=TwoWay}"
                               ItemHeaderFontFamily="MatRoundReg" HeaderPanelBackgroundColor="#131314"
                                    >
                            <dx:TabViewItem
                                
                                HeaderText="queue_music">


                                <Grid RowDefinitions="*,auto" BackgroundColor="Transparent">

                                    <dx:DXCollectionView  Grid.Row="0"
                                        x:Name="PlaybackQueueColView"
                                        ItemTemplate="{StaticResource NowPlayingView}"
                                        Orientation="Vertical"
                                                          Loaded="PlaybackQueueColView_Loaded"
                                                          Unloaded="PlaybackQueueColView_Unloaded"
                                                          UseRippleEffect="True"
                                                          RippleColor="{Binding CurrentPlaySongDominantColor}"
                                        ItemSpanCount="{Binding NowPlayingQueueItemSpan}"
                                        IndicatorColor="{Binding CurrentPlayingSongView.CurrentPlaySongDominantColor}"
                                        ItemsSource="{Binding PlaybackQueue}">


                                    </dx:DXCollectionView>


                                    <dx:DXStackLayout Grid.Row="1" VerticalOptions="End"
                                                          BackgroundColor="Transparent">
                                        <dx:DXSlider
                                            MaxValue="3"
                                            MinValue="2"
                                            Value="{Binding NowPlayingQueueItemSpan,Source={RelativeSource AncestorType={x:Type vm:BaseViewModelAnd}}}"
/>
                                        
                                    </dx:DXStackLayout>

                                </Grid>
                            </dx:TabViewItem>
                            
                            <dx:TabViewItem 
                                HeaderText="music_note">

                                <dx:DXStackLayout>
                                    <dx:DXStackLayout.Resources>
                                        <ResourceDictionary>


                                        </ResourceDictionary>
                                    </dx:DXStackLayout.Resources>
                                    <dx:DXCollectionView 
                            
                            x:Name="SongsColView"
                            Grid.Row="0"
                                x:FieldModifier="public"
                                AllowDragDropItems="False"
                                AllowFixedGroupHeaders="True"
                                AllowGroupCollapse="True"
                                                 UseRippleEffect="False"
                                AllowLiveDataShaping="True"
                                BackgroundColor="Transparent"
                                FilteringUIFormShowing="SongsColView_FilteringUIFormShowing"
                                ItemSpacing="10"
            LongPressCommand="{Binding Commands.ShowFilteringUIForm,Source={x:Reference SongsColView}}"
                                ItemsSource="{Binding SearchResults}"
                                Loaded="SongsColView_Loaded"
                               ItemTemplate="{StaticResource OGView}" >
                                    </dx:DXCollectionView>
                                </dx:DXStackLayout>
                            </dx:TabViewItem>
                            <!--                        
                            <dx:TabViewItem >

                                

                                    <Grid RowDefinitions="auto,*">
                                        <Grid.Resources>

                                            <ResourceDictionary>

                                                <DataTemplate x:DataType="models:SongModelView" x:Key="OGView">

                                                    <dx:DXStackLayout>

                                                        <Grid
                                                BackgroundColor="Transparent"
                                                RowDefinitions="60" ColumnSpacing="1"
                                                ColumnDefinitions="auto,*,auto"
                                                
                                                VerticalOptions="Center">
                                                            <syncf:SfEffectsView Grid.Column="0"
                                                      BackgroundColor="Green"
                                            x:Name="ViewSongOnly"                    
                                                                 TouchDown="ViewSongOnly_TouchDown"
                                                           TouchDownCommandParameter="{Binding .}">
                                                                <syncf:SfEffectsView.Triggers>
                                                                    <DataTrigger
Binding="{Binding HasSyncedLyrics}"
TargetType="syncf:SfEffectsView"
Value="True">
                                                                        <Setter Property="BackgroundColor" Value="DarkSlateBlue" />

                                                                    </DataTrigger>
                                                                    <DataTrigger
Binding="{Binding HasSyncedLyrics}"
TargetType="syncf:SfEffectsView"
Value="False">
                                                                        <Setter Property="BackgroundColor" Value="Transparent" />

                                                                    </DataTrigger>
                                                                </syncf:SfEffectsView.Triggers>
                                                                <dx:DXBorder CornerRadius="15" 
                                                             BorderThickness="2">

                                                                    <Image  
                                                         
                                               Source="{Binding CoverImagePath}"/>

                                                                </dx:DXBorder>

                                                            </syncf:SfEffectsView>
                                                            <dx:DXButton
                                                CornerRadius="5"
                                                    x:Name="TitleAndArtists"
                                                    Grid.Column="1" Padding="0"
                                                HorizontalContentAlignment="Start"
                                                    BackgroundColor="Transparent"
                                                Clicked="PlaySongClicked"
                                                PressedTextColor="White"
                                                CommandParameter="{Binding .}"
                                                    VerticalOptions="Center">
                                                                <dx:DXButton.Content>
                                                                    <dx:DXStackLayout>
                                                                        <Label
      x:Name="SongTitleChip"
      Padding="10,0"
      BackgroundColor="Transparent"
      FontAttributes="Bold"
      FontSize="16"
      HorizontalOptions="Start"
      Opacity="0.8"
      LineBreakMode="TailTruncation"
      Text="{Binding Title}"
      TextColor="{AppThemeBinding Dark=White,
                                  Light=black}"
      VerticalOptions="Center" >
                                                                            <Label.Triggers>
                                                                                <DataTrigger TargetType="Label" Binding="{Binding IsCurrentPlayingHighlight}"
               Value="True">
                                                                                    <Setter Property="TextColor" Value="DarkSlateBlue"/>
                                                                                    <Setter Property="FontSize" Value="18"/>
                                                                                </DataTrigger>
                                                                            </Label.Triggers>
                                                                        </Label>
                                                                        <dx:Chip
                                                        x:Name="ArtistsChip"
                                                              Padding="10,0"

                                                        BackgroundColor="Transparent"
                                                        BorderThickness="0"
                                                        
                                                        FontSize="12"
                                                        HorizontalOptions="Start"
                                                        LongPress="ArtistsChip_LongPress"
                                                        LongPressCommandParameter="{Binding ArtistName}"
                                                        Opacity="0.6"
                                                        Text="{Binding ArtistName}"
                                                        TextColor="{AppThemeBinding Dark=White,
                                                                                    Light=black}"
                                                        VerticalOptions="Center" />

                                                                        <dx:Chip
                                                            x:Name="AlbumFilter"
                                                            BackgroundColor="Transparent"
                                                            BorderThickness="0"
                                                            FontAttributes="Italic"
                                                            FontSize="10"
                                                                  Padding="10,0"

                                                            HorizontalOptions="Start"
                                                            LongPress="AlbumFilter_LongPress"
                                                            LongPressCommandParameter="{Binding AlbumName}"
                                                            Opacity="0.5"
                                                            Text="{Binding AlbumName}"
                                                            UseRippleEffect="True"
                                                            VerticalOptions="Center" />



                                                                    </dx:DXStackLayout>

                                                                </dx:DXButton.Content>
                                                            </dx:DXButton>


                                                            <dx:Chip
                                                    x:Name="MoreIcon"
                                                    Grid.Column="2"
                                                    Padding="20"
                                                FontSize="15"
                                                    BorderColor="DarkSlateBlue"
                                                    BorderThickness="0.7"
                                                    CornerRadius="25"
                                                    HorizontalOptions="End"
                                                    IsIconVisible="False"
                                                    LongPress="MoreIcon_LongPress"
                                                    PressedBackgroundColor="DarkSlateBlue"
                                                    PressedBorderColor="DarkSlateBlue"
                                                    Tap="MoreIcon_Tap"
                                                  Text="{Binding DurationInSeconds, Converter={converters:DurationConverterFromMsToTimeSpan}}"
                                                    
                                                TextColor="{AppThemeBinding Dark=White,
                                                                                Light=black}" >

                                                            </dx:Chip>
                                                        </Grid>


                                                    </dx:DXStackLayout>
                                                </DataTemplate>
                                                <Style TargetType="Label">
                                                    <Setter Property="FontFamily" Value="AleySans" />
                                                </Style>
                                            </ResourceDictionary>
                                        </Grid.Resources>
                                        <dx:DXImage Opacity="0.1" Grid.RowSpan="2"
                    ZIndex="-1"
                    Source="{Binding SelectedSong.CoverImagePath}" />
                                        <dx:TabView  Grid.Row="1" ZIndex="1" x:Name="BtmSheetTab"
                     SwipeEnabled="True" HeaderPanelHeight="0" HeaderPanelPosition="Bottom" >

                                        <dx:TabViewItem>
                                            <dx:TabViewItem.Content>

                                                <dx:DXCollectionView Grid.Row="1"
           x:Name="SongsColViewBtmView"
                                         Scrolled="SongsColView_Scrolled"
           IsVisible="True"
           Loaded="MainSongsColView_Loaded" 
               SelectionMode="Single"
               SelectedItem="{Binding SelectedSong}"
               ItemsSource="{Binding PlaybackQueue}"
        VerticalOptions="Start"
                                        
                               ItemTemplate="{StaticResource OGView}" >
                                                    <dx:DXCollectionView.Header>
                                                        <dx:DXStackLayout>
                                                            <dx:DXButton 
                                    IconHeight="50"
                                    IconColor="DarkSlateBlue"
                                    IconWidth="50" HorizontalContentAlignment="End"
                                        ShowIcon="True" ShowContent="False"
                                        Icon="eye.png" 
                                        Command="{Binding SongsColViewNPQ}"/>
                                                            <Label 
                                    HeightRequest="30"
                                        Text="{Binding PlaybackQueue.Count}"/>
                                                        </dx:DXStackLayout>
                                                    </dx:DXCollectionView.Header>
                                                </dx:DXCollectionView>
                                            </dx:TabViewItem.Content>

                                        </dx:TabViewItem>
                                        <dx:TabViewItem>
                                                <dx:TabViewItem.Content>


                                                    <dx:DXStackLayout BackgroundColor="Transparent" 
                         
                          Orientation="Vertical">
                                                        <dx:DXStackLayout.Resources>
                                                            <ResourceDictionary>
                                                                <Style TargetType="dx:DXButton">
                                                                    <Setter Property="ButtonType" Value="ToolButton" />
                                                                    <Setter Property="HorizontalContentAlignment" Value="Start" />

                                                                </Style>
                                                                <Style TargetType="Label">
                                                                    <Setter Property="FontSize" Value="24" />
                                                                    <Setter Property="FontAttributes" Value="Bold" />

                                                                </Style>
                                                            </ResourceDictionary>
                                                        </dx:DXStackLayout.Resources>
                                                        <dx:DXStackLayout BackgroundColor="Transparent" HorizontalOptions="Center"
                                  ItemSpacing="10" Orientation="Horizontal"
                                  VerticalOptions="Center"
                                  >

                                                        </dx:DXStackLayout>

                                                        <dx:DXSeparator />
                                                        <dx:DXButton BackgroundColor="Transparent"
                         Clicked="DXButton_Clicked"
                             Content="View Queue" Icon="musicplaylist.png"
                             />
                                                        <dx:DXButton x:Name="AddToPlaylist"
                             Command="{Binding AddToNextCommand}" Content="Add to Next in Queue"
                             Icon="addplaylist.png"
                             />
                                                        <dx:DXButton x:Name="GoToAlbumBtn"
                             Command="{Binding AddToQueueCommand}"
                                                      Content="Add To End" Icon="album.png"
                             />
                                                        <dx:DXButton x:Name="GotoArtistBtn"
                             Clicked="GotoArtistBtn_Clicked" Content="Go to Artist"
                             Icon="artist.png"
                             />
                                                        <dx:DXButton Command="{Binding OpenEditSongPopupCommand}"
                             CommandParameter="{Binding SelectedSong}"
                             Content="Tag Editor" Icon="clapperboardedit.png"
                             />
                                                        <dx:DXButton Clicked="DXButton_Clicked_3"
                             Command="{Binding OpenFileInFolderCommand}"
                             Content="Song Info" Icon="fileinfo.png"
                             />
                                                        <dx:DXButton Clicked="ClosePopup"
                             Command="{Binding ShareCurrentPlayingAsStoryInCardLikeGradientCommand}"
                             Content="Share" Icon="squareforward.png"
                             />
                                                        <dx:DXButton Command="{Binding DeleteSongsCommand}"
                             CommandParameter="{Binding CurrentPlayingSongView}"
                             Content="Delete" Icon="delete.png"
                             />

                                                    </dx:DXStackLayout>

                                                </dx:TabViewItem.Content>
                                            </dx:TabViewItem>

                                        </dx:TabView>
                                    </Grid>
                                    
                            </dx:TabViewItem>
-->
                          

                            <dx:TabViewItem HeaderText="music_video">

                                <Grid
                                Margin="5"
                                IsVisible="True"
                                RowDefinitions="*,auto,auto">
                                    <dx:DXStackLayout Grid.Row="0" Padding="10">
                                        <Grid>
                                            <Grid.GestureRecognizers>
                                                <PinchGestureRecognizer x:Name="PingGest" PinchUpdated="PingGest_PinchUpdated" />
                                            </Grid.GestureRecognizers>
                                            <dx:DXBorder CornerRadius="20" StyleClass="Elevation2">
                                                <dx:DXImage
                                                Grid.Row="0"
                                                IsVisible="True"
                                                    
                                                Source="{Binding CurrentCoverImagePath}" >
                                                    <dx:DXImage.Triggers>
                                                        <DataTrigger TargetType="dx:DXImage" Value="True"
                                                                 Binding="{Binding AllLines,Converter={converters:IsEnumerableNullOrEmptyConverter}}"
                                                                 >
                                                            <Setter Property="Opacity" Value="0.8"/>
                                                        </DataTrigger>
                                                        <DataTrigger TargetType="dx:DXImage" Value="False"
                                                                 Binding="{Binding AllLines,Converter={converters:IsEnumerableNullOrEmptyConverter}}"
                                                                 >
                                                            <Setter Property="Opacity" Value="0.5"/>
                                                        </DataTrigger>
                                                    </dx:DXImage.Triggers>
                                                </dx:DXImage>

                                            </dx:DXBorder>

                                            <dx:DXCollectionView
                                            x:Name="AllLyricsColView"
                                            HeightRequest="150"
                                            HorizontalOptions="Center"
                                            IsScrollBarVisible="False"
                                            ItemsSource="{Binding AllLines}"
                                            SelectedItem="{Binding CurrentLine}"
                                            SelectionChanged="DXCollectionView_SelectionChanged"
                                            SelectionMode="Single"
                                            VerticalOptions="Center"
                                            ZIndex="1">
                                                <dx:DXCollectionView.SelectedItemTemplate>
                                                    <DataTemplate x:DataType="models:LyricPhraseModelView">
                                                        <dx:DXBorder
                                                        Margin="5"
                                                        Padding="10"
                                                        BackgroundColor="DarkSlateBlue"
                                                        CornerRadius="10"
                                                        HorizontalOptions="Center">
                                                            <Label
                                                            FontAttributes="Bold"
                                                            HorizontalTextAlignment="Center"
                                                            Text="{Binding Text}"
                                                            TextColor="{AppThemeBinding Dark=White, Light=Black}" />

                                                        </dx:DXBorder>
                                                    </DataTemplate>
                                                </dx:DXCollectionView.SelectedItemTemplate>
                                                <dx:DXCollectionView.ItemTemplate>
                                                    <DataTemplate x:DataType="models:LyricPhraseModelView">
                                                        <Border>
                                                            <Label
                                                            FontSize="13"
                                                            HorizontalTextAlignment="Center"
                                                            Text="{Binding Text}"
                                                            TextColor="Black" />

                                                        </Border>
                                                    </DataTemplate>
                                                </dx:DXCollectionView.ItemTemplate>
                                            </dx:DXCollectionView>
                                            <dx:DXBorder VerticalOptions="End" BackgroundColor="{Binding CurrentPlaySongDominantColor}" Opacity="0.8"
                                                     CornerRadius="0,0,10,15">

                                                <Grid ColumnDefinitions="*,*" >
                                                    <dx:DXStackLayout Grid.Column="0"  HorizontalOptions="Start">
                                                        <dx:Chip
     BackgroundColor="Transparent"
     BorderColor="Transparent"
     BorderThickness="0.1"
     
     FontSize="14" 
                                                    TextColor="{AppThemeBinding Light=black,Dark=white}"
     Tap="ArtistChip_Tap"
     TapCommandParameter="{Binding CurrentPlayingSongView}"
     Text="{Binding CurrentPlayingSongView.ReleaseYear}" />
                                                    </dx:DXStackLayout>
                                                    <dx:DXStackLayout Grid.Column="1" HorizontalOptions="End">
                                                        <dx:Chip
     BackgroundColor="Transparent"
     BorderColor="Transparent"
     BorderThickness="0.1"
     
                                                    TextColor="{AppThemeBinding Light=black,Dark=white}"
     FontSize="14"
     Tap="ArtistChip_Tap"
     TapCommandParameter="{Binding CurrentPlayingSongView}"
     Text="{Binding CurrentPlayingSongView.GenreName}" />
                                                    </dx:DXStackLayout>
                                                </Grid>

                                            </dx:DXBorder>
                                        </Grid>

                                    </dx:DXStackLayout>
                                    <dx:DXExpander Grid.Row="1" IsExpanded="True"
                                               x:Name="MediaControlView">
                                        <Grid>

                                            <dx:DXStackLayout Grid.Row="1" IsVisible="True">
                                                <dx:DXStackLayout Margin="0,0,0,0" ItemSpacing="5" BackgroundColor="Transparent">
                                                    <dx:DXStackLayout.Resources>
                                                        <ResourceDictionary>
                                                            <Style TargetType="dx:Chip">
                                                                <Setter Property="TextColor"
                                                            Value="{AppThemeBinding Light=Black, Dark=White}"/>
                                                            </Style>
                                                            <Style TargetType="Label">
                                                                <Setter Property="TextColor"
                                                            Value="{AppThemeBinding Light=Black, Dark=#999999}"/>
                                                            </Style>
                                                        </ResourceDictionary>
                                                    </dx:DXStackLayout.Resources>
                                                 
                                                                <Label
                                                        FontSize="22"
FontAttributes="Bold"                                                        HorizontalTextAlignment="Justify"
                                                        Text="{Binding CurrentPlayingSongView.Title}" >
                                                                    <Label.Triggers>
                                                                        <DataTrigger
         Binding="{Binding IsPlaying}"
         TargetType="Label"
         Value="True">
                                                                            <Setter Property="TextColor" Value="DarkSlateBlue" />
                                                                        </DataTrigger>
                                                                        <DataTrigger
         Binding="{Binding IsPlaying}"
         TargetType="Label"
         Value="False">
                                                                            <Setter Property="TextColor" Value="Grey" />
                                                                        </DataTrigger>
                                                                    </Label.Triggers>
                                                                </Label>
                                                            
                                                    <Label
                                            BackgroundColor="Transparent"
                                            HorizontalTextAlignment="Justify"
                                            
                                            FontSize="16"
                                            FontAttributes="Bold"
                                            Text="{Binding CurrentPlayingSongView.ArtistName}" />
                                                    <Label
                                            BackgroundColor="Transparent"
                                            HorizontalTextAlignment="Justify"
                                                        
                                            
                                            FontSize="13" 
                                            TextColor="{AppThemeBinding Light=Black, Dark= White}"
                                            Text="{Binding CurrentPlayingSongView.AlbumName}" />

                                                    <dx:DXStackLayout HorizontalOptions="Center" Orientation="Horizontal">

                                                        <dx:Chip
                                                BackgroundColor="Transparent"
                                                BorderColor="Transparent"
                                                BorderThickness="0.1"
                                                
                                                FontSize="18"
                                                Icon="heartbroken.png"
                                                IsIconVisible="True"
                                                LongPressCommand="{Binding ToggleFavSongCommand}"
                                                Tap="ArtistChip_Tap">
                                                            <dx:Chip.Triggers>
                                                                <DataTrigger
                                                        Binding="{Binding CurrentPlayingSongView.IsFavorite}"
                                                        TargetType="dx:Chip"
                                                        Value="True">
                                                                    <Setter Property="Icon" Value="heart.png" />
                                                                </DataTrigger>
                                                                <DataTrigger
                                                        Binding="{Binding CurrentPlayingSongView.IsFavorite}"
                                                        TargetType="dx:Chip"
                                                        Value="False">
                                                                    <Setter Property="Icon" Value="heartbroken.png" />
                                                                </DataTrigger>
                                                            </dx:Chip.Triggers>
                                                        </dx:Chip>

                                                    </dx:DXStackLayout>
                                                </dx:DXStackLayout>
                                                <Grid
                                        Grid.Row="2"
                                        RowDefinitions="auto,auto,auto"
                                        RowSpacing="15">

                                                    <Grid
                                            x:Name="ProgressAndPrev"
                                            Grid.Row="0"
                                            BackgroundColor="Transparent"
                                            ColumnDefinitions="0.4*,0.4*,*"
                                            ColumnSpacing="10">

                                                        <dx:DXButton
                                                Grid.Column="0"
                                                BackgroundColor="#343534"
                                                Command="{Binding ToggleRepeatModeCommand}"
                                                HeightRequest="120"
                                                Icon="repeat.png"
                                                IconColor="{AppThemeBinding Dark=#f5f5f5,
                                                                            Light=White}"
                                                IconHeight="40"
                                                IconWidth="40"
                                                Opacity="0.5"
                                                PressedBackgroundColor="{Binding CurrentPlaySongDominantColor}"
                                                ToolTipProperties.Text="{Binding CurrentRepeatMode, StringFormat='{0}'}">
                                                            <dx:DXButton.Triggers>
                                                                <DataTrigger
                                                        Binding="{Binding CurrentRepeatMode}"
                                                        TargetType="dx:DXButton"
                                                        Value="0">
                                                                    <Setter Property="BackgroundColor" Value="DarkSlateBlue" />

                                                                </DataTrigger>
                                                                <DataTrigger
                                                        Binding="{Binding CurrentRepeatMode}"
                                                        TargetType="dx:DXButton"
                                                        Value="1">
                                                                    <Setter Property="BackgroundColor" Value="DarkSlateBlue" />

                                                                </DataTrigger>
                                                                <DataTrigger
                                                        Binding="{Binding CurrentRepeatMode}"
                                                        TargetType="dx:DXButton"
                                                        Value="2">
                                                                    <Setter Property="BackgroundColor" Value="Orange" />

                                                                </DataTrigger>
                                                                <DataTrigger
                                                        Binding="{Binding CurrentRepeatMode}"
                                                        TargetType="dx:DXButton"
                                                        Value="3">
                                                                    <Setter Property="BackgroundColor" Value="DarkBlue" />

                                                                </DataTrigger>
                                                            </dx:DXButton.Triggers>
                                                        </dx:DXButton>

                                                        <dx:DXButton
                                                Grid.Column="1"
                                                BackgroundColor="#343534"
                                                Command="{Binding PreviousTrackCommand}"
                                                HeightRequest="120"
                                                Icon="skipprevious.png"
                                                IconColor="{AppThemeBinding Dark=#f5f5f5,
                                                                            Light=White}"
                                                IconHeight="50"
                                                IconWidth="50"
                                                Opacity="0.5"
                                                PressedBackgroundColor="{Binding CurrentPlaySongDominantColor}" />
                                                        <Grid
                                                Grid.Column="2"
                                                BackgroundColor="Transparent"
                                                ColumnDefinitions="*,*"
                                                RowDefinitions="*,*">
                                                            <dx:DXSlider
                                                    x:Name="ProgressSlider"
                                                    Grid.Row="0"
                                                    Grid.Column="0"
                                                    Grid.ColumnSpan="2"
                                                    BackgroundColor="Transparent"
                                                    MaxValue="{Binding CurrentPlayingSongView.DurationInSeconds}"
                                                    MinValue="0"
                                                    Opacity="0.7"
                                                    TapReleased="ProgressSlider_TapReleased"
                                                    ValueStep="1"
                                                    VerticalOptions="End"
                                                    Value="{Binding CurrentTrackPositionSeconds}">


                                                                <dx:DXSlider.TooltipAppearance>
                                                                    <dx:DXSliderTooltipAppearance
                                                            BackgroundColor="#626680"
                                                            FontAttributes="Bold"
                                                            FontSize="16"
                                                            TextColor="{AppThemeBinding Dark=White,
                                                                                        Light=black}" />
                                                                </dx:DXSlider.TooltipAppearance>

                                                                <dx:DXSlider.TrackAppearance>
                                                                    <dx:DXSliderTrackAppearance
                                                            ActiveBackgroundColor="DarkSlateBlue"
                                                            BackgroundColor="#626680"
                                                            Thickness="12" />
                                                                </dx:DXSlider.TrackAppearance>
                                                                <dx:DXSlider.ThumbAppearance>
                                                                    <dx:DXSliderThumbAppearance
                                                            Width="2"
                                                            Height="35"
                                                            BackgroundColor="#A99BDE" />
                                                                </dx:DXSlider.ThumbAppearance>
                                                            </dx:DXSlider>
                                                            <Label
                                                    Grid.Row="1"
                                                    Grid.Column="0"
                                                    
                                                    FontSize="14"
                                                    Text="{Binding CurrentTrackPositionSeconds, Converter={StaticResource DurationConverter}}"
                                                     />
                                                            <Label
                                                    Grid.Row="1"
                                                    Grid.Column="1"
                                                    
                                                    FontSize="14" 
                                                    HorizontalOptions="End"
                                                    Text="{Binding CurrentPlayingSongView.DurationInSeconds, Converter={StaticResource DurationConverter}}"
                                                    />
                                                        </Grid>

                                                    </Grid>

                                                    <Grid
                                            x:Name="PlayPauseAndNext"
                                            Grid.Row="1"
                                            BackgroundColor="Transparent"
                                            ColumnDefinitions="*,0.4*,0.4*"
                                            ColumnSpacing="10">
                                                        <dx:DXButton
                                                Grid.Column="0"
                                                AnimationDuration="1500"
                                                Command="{Binding PlayPauseToggleCommand}"
                                                HeightRequest="120"
                                                Icon="play.png"
                                                IconColor="{AppThemeBinding Dark=White,Light=Black}"
                                                IconHeight="60"
                                                IconWidth="60"
                                BackgroundColor="{Binding CurrentPlaySongDominantColor}"
                                                Opacity="0.8"
                                                PressedBackgroundColor="{Binding CurrentPlaySongDominantColor}">
                                                            <dx:DXButton.Triggers>

                                                                <DataTrigger
                                                        Binding="{Binding IsPlaying}"
                                                        TargetType="dx:DXButton"
                                                        Value="True">
                                                                    <Setter Property="BorderThickness" Value="2" />
                                                                    <Setter Property="Icon" Value="pause.png" />
                                                                </DataTrigger>
                                                                <DataTrigger
                                                        Binding="{Binding IsPlaying}"
                                                        TargetType="dx:DXButton"
                                                        Value="False">
                                                                    <Setter Property="BorderThickness" Value="0" />
                                                                    <Setter Property="Icon" Value="play.png" />
                                                                </DataTrigger>
                                                            </dx:DXButton.Triggers>
                                                        </dx:DXButton>

                                                        <dx:DXToggleButton
                                                Grid.Column="1"
                                                AnimationDuration="800"
                                                BackgroundColor="{AppThemeBinding Dark=#343534,
                                                                                  Light=grey}"
                                                Command="{Binding ToggleShuffleCommand}"
                                                HeightRequest="120"
                                                Icon="shuffle.png"
                                                IconColor="{AppThemeBinding Dark=#f5f5f5,
                                                                            Light=White}"
                                                IconHeight="40"
                                                IconWidth="40"
                                                IsChecked="{Binding IsShuffleActive}"
                                                Opacity="0.5"
                                PressedBackgroundColor="{Binding CurrentPlaySongDominantColor}"/>

                                                        <dx:DXButton
                                                Grid.Column="2"
                                                AnimationDuration="800"
                                                BackgroundColor="{AppThemeBinding Dark=#343534,
                                                                                  Light=grey}"
                                                Command="{Binding NextTrackCommand}"
                                                HeightRequest="120"
                                                Icon="skipnext.png"
                                                IconColor="{AppThemeBinding Dark=#f5f5f5,
                                                                            Light=White}"
                                                IconHeight="40"
                                                IconWidth="40"
                                                Opacity="0.5"
                                                PressedBackgroundColor="{Binding CurrentPlaySongDominantColor}" />

                                                    </Grid>

                                                </Grid>

                                            </dx:DXStackLayout>

                                            <dx:TabView x:Name="UtilsTabView" IsVisible="False">
                                                <dx:TabViewItem>
                                                    <dx:TabViewItem.Content>
                                                        <VerticalStackLayout>
                                                            <Label Text="Yvan"/>
                                                        </VerticalStackLayout>
                                                    </dx:TabViewItem.Content>
                                                </dx:TabViewItem>
                                            </dx:TabView>
                                        </Grid>
                                    </dx:DXExpander>

                                    <Grid IsVisible="False"
                                            Grid.Row="2"
                                            BackgroundColor="Transparent"
                                            RowDefinitions="auto,*"
                                            VerticalOptions="End">
                                        <dx:DXStackLayout Grid.Row="0" Orientation="Horizontal">
                                            <dx:DXButton
                                                    Clicked="DXButton_Clicked"
                                                    Icon="more1.png"
                                                    IconHeight="40"
                                                    IconWidth="40"
                                            
                                                    IsVisible="True" />
                                            <dx:Chip
                                                    BorderThickness="0"
                                                    Icon="playlistminimalistic3.png"
                                                    IconSize="40,40"
                                                    IsIconVisible="True"
                                                    IsVisible="True"
                                                    Tap="CloseNowPlayingQueue_Tap"
                                                    WidthRequest="55" />
                                        </dx:DXStackLayout>

                                        <Grid Grid.Row="1">
                                            <dx:DXExpander
                                                    x:Name="BottomExpander"
                                                    Grid.Row="1"
                                                    BackgroundColor="Transparent"
                                                    HorizontalExpandMode="FromEndToStart"
                                                    IsExpanded="False"
                                                    VerticalExpandMode="FromCenter">
                                                <dx:DXExpander.Content>
                                                    <dx:DXStackLayout>
                                                        <StackLayout
                                                                HorizontalOptions="Center"
                                                                MinimumWidthRequest="400"
                                                                Orientation="Horizontal"
                                                                Spacing="10">
                                                            <dx:Chip
                                                                    BackgroundColor="Transparent"
                                                                    BorderColor="Black"
                                                                    BorderThickness="1"
                                                                    HeightRequest="90"
                                                                    Icon="shared.png"
                                                                    IconColor="DarkSlateBlue"
                                                                    IconSize="60,60"
                                                                    IsIconVisible="True" />
                                                            <dx:Chip
                                                                    BackgroundColor="Transparent"
                                                                    BorderColor="Black"
                                                                    BorderThickness="1"
                                                                    HeightRequest="90"
                                                                    HorizontalOptions="Start"
                                                                    Icon="shuffle.png"
                                                                    IconColor="DarkSlateBlue"
                                                                    IconSize="60,60"
                                                                    IsIconVisible="True"
                                                                    TapCommand="{Binding ToggleShuffleCommand}" />

                                                            <dx:DXSlider Value="{Binding DeviceVolumeLevel}" />
                                                            <Label HorizontalOptions="Center" Text="App Volume" />

                                                        </StackLayout>
                                                        <dx:DXStackLayout Orientation="Horizontal">
                                                            <dx:TextEdit LabelText="Little Note 🎶" Text="{Binding CurrentNoteToSave}" />
                                                            <dx:DXButton
                                                                    BackgroundColor="#1e1e1e"
                                                                    HeightRequest="60"
                                                                    Icon="addcircle.png"
                                                                    IconHeight="40"
                                                                    IconWidth="40" />
                                                        </dx:DXStackLayout>
                                                    </dx:DXStackLayout>
                                                </dx:DXExpander.Content>
                                            </dx:DXExpander>
                                        </Grid>
                                        <dx:DXExpander
                                                x:Name="BottomExpanderTwo"
                                                Grid.Row="1"
                                                BackgroundColor="Transparent"
                                                CornerRadius="20"
                                                HorizontalExpandMode="FromEndToStart"
                                                IsExpanded="False"
                                                VerticalExpandMode="FromStartToEnd">
                                            <dx:DXExpander.Content>
                                                <Grid BackgroundColor="Transparent" RowDefinitions="*">
                                                    <dx:DXImage Opacity="0.12" Source="{Binding CurrentPlayingSongView.CoverImageBytes, Converter={converters:BytesArrayToImageSource}}" />
                                                    <Grid ColumnDefinitions="*,*" ZIndex="1">
                                                        <StackLayout
                                                                Grid.Column="1"
                                                                BackgroundColor="Transparent"
                                                                HorizontalOptions="End"
                                                                Orientation="Horizontal">

                                                            <dx:Chip
                                                                    x:Name="CloseNowPlayingQueue"
                                                                    BackgroundColor="DarkSlateBlue"
                                                                    BorderThickness="0"
                                                                    FontSize="24"
                                                                    HorizontalOptions="Center"
                                                                    Tap="CloseNowPlayingQueue_Tap"
                                                                    Text="Close"
                                                                    VerticalOptions="End" />
                                                        </StackLayout>

                                                        <dx:Chip
                                                                x:Name="ScrollToSongBtn"
                                                                Grid.Column="0"
                                                                BorderThickness="0"
                                                                FontSize="40"
                                                                HorizontalOptions="End"
                                                                Icon="eye.png"
                                                                IconColor="DarkSlateBlue"
                                                                IconSize="50,50"
                                                                IsIconVisible="True"
                                                                IsVisible="False"
                                                                Tap="CloseNowPlayingQueue_Tap"
                                                                VerticalOptions="End" />


                                                    </Grid>
                                                </Grid>

                                            </dx:DXExpander.Content>
                                        </dx:DXExpander>

                                    </Grid>
                                </Grid>
                            </dx:TabViewItem>
                        </dx:TabView>
                        
                    </Grid>
                    
                  

                    <dx:DXExpander
                        x:Name="BtmBarExp" BackgroundColor="Transparent"
                        
                        Grid.Row="2" 
                        VerticalOptions="End"
                        IsExpanded="True">

                        <dx:DXBorder
                            
    xmlns:navDrawer="clr-namespace:Syncfusion.Maui.Toolkit.NavigationDrawer;assembly=Syncfusion.Maui.Toolkit"
    xmlns:progressBar="clr-namespace:Syncfusion.Maui.Toolkit;assembly=Syncfusion.Maui.Toolkit"
    xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vm="clr-namespace:Dimmer.ViewModels"
    x:Name="BtmBarr"
    x:DataType="vm:BaseViewModelAnd"
    
                            Loaded="BtmBarr_Loaded"
                            Unloaded="BtmBarr_Unloaded"
    >


                            <dx:DXBorder.Resources>

                                <ResourceDictionary>
                                    <converters:DurationConverterFromMsToTimeSpan x:Key="DurationConverter" />
                                    <converters:BytesToMegabytesConverter x:Key="FileSizeConverter" />
                                    <converters:BytesArrayToImageSource x:Key="BytesToImageConverter" />
                                    <converters:BoolToInverseConverter x:Key="BoolToInverse" />
                                </ResourceDictionary>
                            </dx:DXBorder.Resources>


                            <dx:DXBorder.GestureRecognizers>
                                <TapGestureRecognizer x:Name="BtmBarTapGest" Tapped="BtmBarTapGest_Tapped" />
                                
                            </dx:DXBorder.GestureRecognizers>
                            <dx:DXBorder.Content>
                                <dx:DXStackLayout x:FieldModifier="Public" x:Name="BtmBarStackLayout" Padding="0,0" BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#131314}">
                                    <syncf:SfLinearProgressBar 
    Progress="{Binding CurrentTrackPositionPercentage}" TrackFill="Transparent" BackgroundColor="Transparent"
                ProgressFill="DarkSlateBlue" Maximum="100"/>
                                    <Grid
                Padding="0,0"
                BackgroundColor="Transparent"
                ColumnDefinitions="auto,*"
                ColumnSpacing="5">
                                        <StackLayout Grid.Column="0" Orientation="Horizontal">
                                            <dx:DXImage
                        Aspect="AspectFit"
                        HeightRequest="70"
                        Source="{Binding CurrentPlayingSongView.CoverImagePath}" />
                                        </StackLayout>
                                        <Grid Grid.Column="1" ColumnDefinitions="*,auto">

                                            <Grid.GestureRecognizers>
                                                <PanGestureRecognizer PanUpdated="PanGesture_PanUpdated"/>
                                            </Grid.GestureRecognizers>
                                            <StackLayout
                        Grid.Column="0"
                        BackgroundColor="Transparent"
                        HorizontalOptions="Start"
                        Orientation="Vertical">
                                                <Label
                            FontSize="23"
                            LineBreakMode="TailTruncation"
                            Text="{Binding CurrentPlayingSongView.Title}"
                            TextColor="{Binding CurrentPlayingSongView.CurrentPlaySongDominantColor}" />
                                                <Label
                            FontAttributes="Italic"
                            FontSize="14"
                            LineBreakMode="WordWrap"
                            TextColor="{AppThemeBinding Light=Black, Dark= White}"
                            Text="{Binding CurrentPlayingSongView.ArtistName}" />
                                            </StackLayout>

                                            <dx:Chip
                        x:Name="DurationAndSearchChip"
                        Grid.Column="1"
                        BorderThickness="0" DoubleTap="DurationAndSearchChip_LongPress"
                        Tap="DurationAndSearchChip_LongPress"
                        LongPress="DurationAndSearchChip_LongPress">
                                                <dx:Chip.ContentTemplate>
                                                    <DataTemplate>
                                                        <VerticalStackLayout>
                                                            <Label
                                        FontSize="16"
                                        HorizontalOptions="End"
                                        Text="{Binding CurrentTrackPositionSeconds, Converter={x:StaticResource DurationConverter}}"
                                        VerticalOptions="Center">
                                                                <Label.Triggers>
                                                                    <DataTrigger
                                                Binding="{Binding IsPlaying}"
                                                TargetType="Label"
                                                Value="True">
                                                                        <Setter Property="FontAttributes" Value="Bold" />
                                                                        <Setter Property="TextColor" Value="{Binding CurrentPlayingSongView.CurrentPlaySongDominantColor}" />
                                                                    </DataTrigger>
                                                                    <DataTrigger
                                                Binding="{Binding IsPlaying}"
                                                TargetType="Label"
                                                Value="False">
                                                                        <Setter Property="FontAttributes" Value="None" />
                                                                        <Setter Property="TextColor" Value="{AppThemeBinding Light=Black, Dark=White}" />
                                                                    </DataTrigger>
                                                                </Label.Triggers>
                                                            </Label>

                                                            <Label
                                        FontSize="10"
                                        HorizontalOptions="End"
                                        Text="{Binding CurrentPlayingSongView.PlayCompletedCount}" />
                                                        </VerticalStackLayout>
                                                    </DataTemplate>
                                                </dx:Chip.ContentTemplate>

                                            </dx:Chip>
                                        </Grid>
                                    </Grid>
                                </dx:DXStackLayout>
                            </dx:DXBorder.Content>

                        </dx:DXBorder>



                    </dx:DXExpander>
                </Grid>
            </dx:DXDockLayout>
        </dx:SafeKeyboardAreaView>
      
  
    </Grid>

    <!--</dx:DXScrollView>-->

</ContentPage>
