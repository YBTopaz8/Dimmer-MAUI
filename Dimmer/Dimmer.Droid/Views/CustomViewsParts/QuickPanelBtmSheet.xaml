<?xml version="1.0" encoding="utf-8" ?>
<dx:BottomSheet xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Dimmer.Views.CustomViewsParts.QuickPanelBtmSheet"
             xmlns:converters="clr-namespace:Dimmer.Utilities.TypeConverters;assembly=Dimmer"
xmlns:customViewParts="clr-namespace:Dimmer.Views.CustomViewsParts"
xmlns:dx="http://schemas.devexpress.com/maui"
xmlns:helper="clr-namespace:Dimmer.Utils.AnimsStatics"
xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer"
xmlns:navDrawer="clr-namespace:Syncfusion.Maui.Toolkit.NavigationDrawer;assembly=Syncfusion.Maui.Toolkit"
xmlns:progressBar="clr-namespace:Syncfusion.Maui.Toolkit;assembly=Syncfusion.Maui.Toolkit"
xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit"
xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
xmlns:viewUtils="clr-namespace:Dimmer.Utilities.ViewsUtils;assembly=Dimmer"
xmlns:vm="clr-namespace:Dimmer.ViewModels"
x:Name="myPage" AllowedState="HalfExpanded" HalfExpandedRatio="0.6"
                
x:DataType="vm:BaseViewModelAnd"
x:FieldModifier="Public">

    <dx:BottomSheet.Resources>
        <ResourceDictionary>

            <DataTemplate x:DataType="models:SongModelView" x:Key="OGView">

                <dx:DXStackLayout>

                    <Grid
                                                BackgroundColor="Transparent"
                                                RowDefinitions="60" ColumnSpacing="1"
                                                ColumnDefinitions="auto,*,auto"
                                                
                                                VerticalOptions="Center">
                        <syncf:SfEffectsView Grid.Column="0"
                                                      BackgroundColor="Green"
                                            x:Name="ViewSongOnly"                    
                                                                 TouchDown="ViewSongOnly_TouchDown"
                                                           TouchDownCommandParameter="{Binding .}">
                            <syncf:SfEffectsView.Triggers>
                                <DataTrigger
Binding="{Binding HasSyncedLyrics}"
TargetType="syncf:SfEffectsView"
Value="True">
                                    <Setter Property="BackgroundColor" Value="DarkSlateBlue" />

                                </DataTrigger>
                                <DataTrigger
Binding="{Binding HasSyncedLyrics}"
TargetType="syncf:SfEffectsView"
Value="False">
                                    <Setter Property="BackgroundColor" Value="Transparent" />

                                </DataTrigger>
                            </syncf:SfEffectsView.Triggers>
                            <dx:DXBorder CornerRadius="15" 
                                                             BorderThickness="2">

                                <Image  
                                                         
                                               Source="{Binding CoverImagePath}"/>

                            </dx:DXBorder>

                        </syncf:SfEffectsView>
                        <dx:DXButton
                                                CornerRadius="5"
                                                    x:Name="TitleAndArtists"
                                                    Grid.Column="1" Padding="0"
                                                HorizontalContentAlignment="Start"
                                                    BackgroundColor="Transparent"
                                                Clicked="PlaySongClicked"
                                                PressedTextColor="White"
                                                CommandParameter="{Binding .}"
                                                    VerticalOptions="Center">
                            <dx:DXButton.Content>
                                <dx:DXStackLayout>
                                    <Label
      x:Name="SongTitleChip"
      Padding="10,0"
      BackgroundColor="Transparent"
      FontAttributes="Bold"
      FontSize="16"
      HorizontalOptions="Start"
      Opacity="0.8"
      LineBreakMode="TailTruncation"
      Text="{Binding Title}"
      TextColor="{AppThemeBinding Dark=White,
                                  Light=black}"
      VerticalOptions="Center" >
                                        <Label.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding IsCurrentPlayingHighlight}"
               Value="True">
                                                <Setter Property="TextColor" Value="DarkSlateBlue"/>
                                                <Setter Property="FontSize" Value="18"/>
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                    <dx:Chip
                                                        x:Name="ArtistsChip"
                                                              Padding="10,0"

                                                        BackgroundColor="Transparent"
                                                        BorderThickness="0"
                                                        
                                                        FontSize="12"
                                                        HorizontalOptions="Start"
                                                        LongPress="ArtistsChip_LongPress"
                                                        LongPressCommandParameter="{Binding ArtistName}"
                                                        Opacity="0.6"
                                                        Text="{Binding ArtistName}"
                                                        TextColor="{AppThemeBinding Dark=White,
                                                                                    Light=black}"
                                                        VerticalOptions="Center" />

                                    <dx:Chip
                                                            x:Name="AlbumFilter"
                                                            BackgroundColor="Transparent"
                                                            BorderThickness="0"
                                                            FontAttributes="Italic"
                                                            FontSize="10"
                                                                  Padding="10,0"

                                                            HorizontalOptions="Start"
                                                            LongPress="AlbumFilter_LongPress"
                                                            LongPressCommandParameter="{Binding AlbumName}"
                                                            Opacity="0.5"
                                                            Text="{Binding AlbumName}"
                                                            UseRippleEffect="True"
                                                            VerticalOptions="Center" />



                                </dx:DXStackLayout>

                            </dx:DXButton.Content>
                        </dx:DXButton>


                        <dx:Chip
                                                    x:Name="MoreIcon"
                                                    Grid.Column="2"
                                                    Padding="20"
                                                FontSize="15"
                                                    BorderColor="DarkSlateBlue"
                                                    BorderThickness="0.7"
                                                    CornerRadius="25"
                                                    HorizontalOptions="End"
                                                    IsIconVisible="False"
                                                    LongPress="MoreIcon_LongPress"
                                                    PressedBackgroundColor="DarkSlateBlue"
                                                    PressedBorderColor="DarkSlateBlue"
                                                    Tap="MoreIcon_Tap"
                                                  Text="{Binding DurationInSeconds, Converter={converters:DurationConverterFromMsToTimeSpan}}"
                                                    
                                                TextColor="{AppThemeBinding Dark=White,
                                                                                Light=black}" >

                        </dx:Chip>
                    </Grid>


                </dx:DXStackLayout>
            </DataTemplate>
            <Style TargetType="Label">
                <Setter Property="FontFamily" Value="AleySans" />
            </Style>
        </ResourceDictionary>
    </dx:BottomSheet.Resources>

    <Grid RowDefinitions="auto,*">
       
        <dx:DXImage Opacity="0.1" Grid.RowSpan="2"
                    ZIndex="-1"
                    Source="{Binding BaseVM.SelectedSong.CoverImagePath}" />
        <dx:TabView  Grid.Row="1" ZIndex="1" x:Name="BtmSheetTab"
                     SwipeEnabled="True" HeaderPanelHeight="0" HeaderPanelPosition="Bottom" >
            <dx:TabViewItem>
                <dx:TabViewItem.Content>

               
        <dx:DXStackLayout BackgroundColor="Transparent" 
                         
                          Orientation="Vertical">
            <dx:DXStackLayout.Resources>
                <ResourceDictionary>
                    <Style TargetType="dx:DXButton">
                        <Setter Property="ButtonType" Value="ToolButton" />
                        <Setter Property="HorizontalContentAlignment" Value="Start" />

                    </Style>
                    <Style TargetType="Label">
                        <Setter Property="FontSize" Value="24" />
                        <Setter Property="FontAttributes" Value="Bold" />

                    </Style>
                </ResourceDictionary>
            </dx:DXStackLayout.Resources>
            <dx:DXStackLayout BackgroundColor="Transparent" HorizontalOptions="Center"
                                  ItemSpacing="10" Orientation="Horizontal"
                                  VerticalOptions="Center"
                                  >
              
                <!--<toolkit:AvatarView ImageSource="{Binding CurrentPlayingSongView.CoverImagePath}"
                     HeightRequest="100" WidthRequest="100"
                     CornerRadius="15" BorderWidth="0"/>-->
            </dx:DXStackLayout>

            <dx:DXSeparator />
            <dx:DXButton BackgroundColor="Transparent"
                         Clicked="DXButton_Clicked"
                             Content="View Queue" Icon="musicplaylist.png"
                             />
            <dx:DXButton x:Name="AddToPlaylist"
                             Command="{Binding BaseVM.AddToNextCommand}" Content="Add to Next in Queue"
                             Icon="addplaylist.png"
                             />
            <dx:DXButton x:Name="GoToAlbumBtn"
                             Command="{Binding BaseVM.AddToQueueCommand}"
                                                      Content="Add To End" Icon="album.png"
                             />
            <dx:DXButton x:Name="GotoArtistBtn"
                             Clicked="GotoArtistBtn_Clicked" Content="Go to Artist"
                             Icon="artist.png"
                             />
            <dx:DXButton Command="{Binding OpenEditSongPopupCommand}"
                             CommandParameter="{Binding BaseVM.SelectedSong}"
                             Content="Tag Editor" Icon="clapperboardedit.png"
                             />
            <dx:DXButton Clicked="DXButton_Clicked_3"
                             Command="{Binding BaseVM.OpenFileInFolderCommand}"
                             Content="Song Info" Icon="fileinfo.png"
                             />
            <dx:DXButton Clicked="ClosePopup"
                             Command="{Binding BaseVM.ShareCurrentPlayingAsStoryInCardLikeGradientCommand}"
                             Content="Share" Icon="squareforward.png"
                             />
            <dx:DXButton Command="{Binding BaseVM.DeleteSongsCommand}"
                             CommandParameter="{Binding CurrentPlayingSongView}"
                             Content="Delete" Icon="delete.png"
                             />

        </dx:DXStackLayout>

                </dx:TabViewItem.Content>
            </dx:TabViewItem>

            <dx:TabViewItem>
                <dx:TabViewItem.Content>
                    
                    <dx:DXCollectionView Grid.Row="1"
           x:Name="SongsColView"
                                         Scrolled="SongsColView_Scrolled"
           IsVisible="True"
           Loaded="MainSongsColView_Loaded" 
               SelectionMode="Single"
               SelectedItem="{Binding BaseVM.SelectedSong}"
               ItemsSource="{Binding BaseVM.PlaybackQueue}"
        VerticalOptions="Start"
                                        
                               ItemTemplate="{StaticResource OGView}" >
                        <dx:DXCollectionView.Header>
                            <dx:DXStackLayout>
                                <dx:DXButton 
                                    IconHeight="50"
                                    IconColor="DarkSlateBlue"
                                    IconWidth="50" HorizontalContentAlignment="End"
                                        ShowIcon="True" ShowContent="False"
                                        Icon="eye.png" 
                                        Command="{Binding SongsColViewNPQ}"/>
                                <Label 
                                    HeightRequest="30"
                                        Text="{Binding BaseVM.PlaybackQueue.Count}"/>
                            </dx:DXStackLayout>
                        </dx:DXCollectionView.Header>
                    </dx:DXCollectionView>
                </dx:TabViewItem.Content>

            </dx:TabViewItem>
        </dx:TabView>
    </Grid>

</dx:BottomSheet>