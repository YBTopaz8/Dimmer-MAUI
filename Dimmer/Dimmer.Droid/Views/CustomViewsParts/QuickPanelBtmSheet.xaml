<?xml version="1.0" encoding="utf-8" ?>
<dx:BottomSheet
    x:Class="Dimmer.Views.CustomViewsParts.QuickPanelBtmSheet"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:Dimmer.Utilities.TypeConverters;assembly=Dimmer"
    xmlns:customViewParts="clr-namespace:Dimmer.Views.CustomViewsParts"
    xmlns:dx="http://schemas.devexpress.com/maui"
    xmlns:helper="clr-namespace:Dimmer.Utils.AnimsStatics"
    xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer"
    xmlns:navDrawer="clr-namespace:Syncfusion.Maui.Toolkit.NavigationDrawer;assembly=Syncfusion.Maui.Toolkit"
    xmlns:progressBar="clr-namespace:Syncfusion.Maui.Toolkit;assembly=Syncfusion.Maui.Toolkit"
    xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:viewUtils="clr-namespace:Dimmer.Utilities.ViewsUtils;assembly=Dimmer"
    xmlns:vm="clr-namespace:Dimmer.ViewModels"
    x:Name="myPage"
    x:DataType="vm:BaseViewModelAnd"
    x:FieldModifier="Public"
    AllowedState="HalfExpanded"
    HalfExpandedRatio="0.6">

    <dx:BottomSheet.Resources>
        <ResourceDictionary>

            <DataTemplate x:Key="OGView" x:DataType="models:SongModelView">

                <dx:DXStackLayout>

                    <Grid
                        BackgroundColor="Transparent"
                        ColumnDefinitions="auto,*,auto"
                        ColumnSpacing="1"
                        RowDefinitions="60"
                        VerticalOptions="Center">
                        <syncf:SfEffectsView
                            x:Name="ViewSongOnly"
                            Grid.Column="0"
                            BackgroundColor="Green"
                            TouchDown="ViewSongOnly_TouchDown"
                            TouchDownCommandParameter="{Binding .}">
                            <syncf:SfEffectsView.Triggers>
                                <DataTrigger
                                    Binding="{Binding HasSyncedLyrics}"
                                    TargetType="syncf:SfEffectsView"
                                    Value="True">
                                    <Setter Property="BackgroundColor" Value="DarkSlateBlue" />

                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding HasSyncedLyrics}"
                                    TargetType="syncf:SfEffectsView"
                                    Value="False">
                                    <Setter Property="BackgroundColor" Value="Transparent" />

                                </DataTrigger>
                            </syncf:SfEffectsView.Triggers>
                            <dx:DXBorder BorderThickness="2" CornerRadius="15">

                                <Image Source="{Binding CoverImagePath}" />

                            </dx:DXBorder>

                        </syncf:SfEffectsView>
                        <dx:DXButton
                            x:Name="TitleAndArtists"
                            Grid.Column="1"
                            Padding="0"
                            HorizontalContentAlignment="Start"
                            BackgroundColor="Transparent"
                            Clicked="PlaySongClicked"
                            CommandParameter="{Binding .}"
                            CornerRadius="5"
                            PressedTextColor="White"
                            VerticalOptions="Center">
                            <dx:DXButton.Content>
                                <dx:DXStackLayout>
                                    <Label
                                        x:Name="SongTitleChip"
                                        Padding="10,0"
                                        BackgroundColor="Transparent"
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        HorizontalOptions="Start"
                                        LineBreakMode="TailTruncation"
                                        Opacity="0.8"
                                        Text="{Binding Title}"
                                        TextColor="{AppThemeBinding Dark=White,
                                                                    Light=black}"
                                        VerticalOptions="Center">
                                        <Label.Triggers>
                                            <DataTrigger
                                                Binding="{Binding IsCurrentPlayingHighlight}"
                                                TargetType="Label"
                                                Value="True">
                                                <Setter Property="TextColor" Value="DarkSlateBlue" />
                                                <Setter Property="FontSize" Value="18" />
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                    <dx:Chip
                                        x:Name="ArtistsChip"
                                        Padding="10,0"
                                        BackgroundColor="Transparent"
                                        BorderThickness="0"
                                        FontSize="12"
                                        HorizontalOptions="Start"
                                        LongPress="ArtistsChip_LongPress"
                                        LongPressCommandParameter="{Binding ArtistName}"
                                        Opacity="0.6"
                                        Text="{Binding ArtistName}"
                                        TextColor="{AppThemeBinding Dark=White,
                                                                    Light=black}"
                                        VerticalOptions="Center" />

                                    <dx:Chip
                                        x:Name="AlbumFilter"
                                        Padding="10,0"
                                        BackgroundColor="Transparent"
                                        BorderThickness="0"
                                        FontAttributes="Italic"
                                        FontSize="10"
                                        HorizontalOptions="Start"
                                        LongPress="AlbumFilter_LongPress"
                                        LongPressCommandParameter="{Binding AlbumName}"
                                        Opacity="0.5"
                                        Text="{Binding AlbumName}"
                                        UseRippleEffect="True"
                                        VerticalOptions="Center" />



                                </dx:DXStackLayout>

                            </dx:DXButton.Content>
                        </dx:DXButton>


                        <dx:Chip
                            x:Name="MoreIcon"
                            Grid.Column="2"
                            Padding="20"
                            BorderColor="DarkSlateBlue"
                            BorderThickness="0.7"
                            CornerRadius="25"
                            FontSize="15"
                            HorizontalOptions="End"
                            IsIconVisible="False"
                            LongPress="MoreIcon_LongPress"
                            PressedBackgroundColor="DarkSlateBlue"
                            PressedBorderColor="DarkSlateBlue"
                            Tap="MoreIcon_Tap"
                            Text="{Binding DurationInSeconds, Converter={converters:DurationConverterFromMsToTimeSpan}}"
                            TextColor="{AppThemeBinding Dark=White,
                                                        Light=black}" />
                    </Grid>


                </dx:DXStackLayout>
            </DataTemplate>
            <Style TargetType="Label">
                <Setter Property="FontFamily" Value="AleySans" />
            </Style>
        </ResourceDictionary>
    </dx:BottomSheet.Resources>

    <Grid RowDefinitions="auto,*">

        <dx:DXImage
            Grid.RowSpan="2"
            Opacity="0.1"
            Source="{Binding SelectedSong.CoverImagePath}"
            ZIndex="-1" />
        <dx:TabView
            x:Name="BtmSheetTab"
            Grid.Row="1"
            HeaderPanelHeight="0"
            HeaderPanelPosition="Bottom"
            SwipeEnabled="True"
            ZIndex="1">
            <dx:TabViewItem>
                <dx:TabViewItem.Content>


                    <dx:DXStackLayout BackgroundColor="Transparent" Orientation="Vertical">
                        <dx:DXStackLayout.Resources>
                            <ResourceDictionary>
                                <Style TargetType="dx:DXButton">
                                    <Setter Property="ButtonType" Value="ToolButton" />
                                    <Setter Property="HorizontalContentAlignment" Value="Start" />

                                </Style>
                                <Style TargetType="Label">
                                    <Setter Property="FontSize" Value="24" />
                                    <Setter Property="FontAttributes" Value="Bold" />

                                </Style>
                            </ResourceDictionary>
                        </dx:DXStackLayout.Resources>
                        <dx:DXStackLayout
                            BackgroundColor="Transparent"
                            HorizontalOptions="Center"
                            ItemSpacing="10"
                            Orientation="Horizontal"
                            VerticalOptions="Center">

                            <!--<toolkit:AvatarView ImageSource="{Binding CurrentPlayingSongView.CoverImagePath}"
                     HeightRequest="100" WidthRequest="100"
                     CornerRadius="15" BorderWidth="0"/>-->
                        </dx:DXStackLayout>

                        <dx:DXSeparator />
                        <dx:DXButton
                            BackgroundColor="Transparent"
                            Clicked="DXButton_Clicked"
                            Content="View Queue"
                            Icon="musicplaylist.png" />
                        <dx:DXButton
                            x:Name="AddToPlaylist"
                            Command="{Binding AddToNextCommand}"
                            Content="Add to Next in Queue"
                            Icon="addplaylist.png" />
                        <dx:DXButton
                            x:Name="GoToAlbumBtn"
                            Command="{Binding AddToQueueCommand}"
                            Content="Add To End"
                            Icon="album.png" />
                        <dx:DXButton
                            x:Name="GotoArtistBtn"
                            Clicked="GotoArtistBtn_Clicked"
                            Content="Go to Artist"
                            Icon="artist.png" />
                        <dx:DXButton
                            Command="{Binding OpenEditSongPopupCommand}"
                            CommandParameter="{Binding SelectedSong}"
                            Content="Tag Editor"
                            Icon="clapperboardedit.png" />
                        <dx:DXButton
                            Clicked="DXButton_Clicked_3"
                            Command="{Binding OpenFileInFolderCommand}"
                            Content="Song Info"
                            Icon="fileinfo.png" />
                        <dx:DXButton
                            Clicked="ClosePopup"
                            Command="{Binding ShareCurrentPlayingAsStoryInCardLikeGradientCommand}"
                            Content="Share"
                            Icon="squareforward.png" />
                        <dx:DXButton
                            Command="{Binding DeleteSongsCommand}"
                            CommandParameter="{Binding CurrentPlayingSongView}"
                            Content="Delete"
                            Icon="delete.png" />

                    </dx:DXStackLayout>

                </dx:TabViewItem.Content>
            </dx:TabViewItem>

            <dx:TabViewItem>
                <dx:TabViewItem.Content>

                    <dx:DXCollectionView
                        x:Name="SongsColView"
                        Grid.Row="1"
                        IsVisible="True"
                        ItemTemplate="{StaticResource OGView}"
                        ItemsSource="{Binding PlaybackQueue}"
                        Loaded="MainSongsColView_Loaded"
                        Scrolled="SongsColView_Scrolled"
                        SelectedItem="{Binding SelectedSong}"
                        SelectionMode="Single"
                        VerticalOptions="Start">
                        <dx:DXCollectionView.Header>
                            <dx:DXStackLayout>
                                <dx:DXButton
                                    HorizontalContentAlignment="End"
                                    Command="{Binding SongsColViewNPQ}"
                                    Icon="eye.png"
                                    IconColor="DarkSlateBlue"
                                    IconHeight="50"
                                    IconWidth="50"
                                    ShowContent="False"
                                    ShowIcon="True" />
                                <Label HeightRequest="30" Text="{Binding PlaybackQueue.Count}" />
                            </dx:DXStackLayout>
                        </dx:DXCollectionView.Header>
                    </dx:DXCollectionView>
                </dx:TabViewItem.Content>

            </dx:TabViewItem>
        </dx:TabView>
    </Grid>

</dx:BottomSheet>