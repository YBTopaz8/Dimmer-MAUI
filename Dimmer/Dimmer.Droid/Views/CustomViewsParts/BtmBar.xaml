<?xml version="1.0" encoding="utf-8" ?>
<dx:DXBorder
    x:Class="Dimmer.Views.CustomViewsParts.BtmBar"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:Dimmer.Utilities.TypeConverters;assembly=Dimmer"
    xmlns:dx="http://schemas.devexpress.com/maui"
    xmlns:models="clr-namespace:Dimmer.Data.ModelView;assembly=Dimmer"
    xmlns:navDrawer="clr-namespace:Syncfusion.Maui.Toolkit.NavigationDrawer;assembly=Syncfusion.Maui.Toolkit"
    xmlns:progressBar="clr-namespace:Syncfusion.Maui.Toolkit;assembly=Syncfusion.Maui.Toolkit"
    xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vm="clr-namespace:Dimmer.ViewModels"
    x:Name="BtmBarr"
    Padding="5"
    x:DataType="vm:BaseViewModelAnd"
    CornerRadius="20"
    Loaded="BtmBarr_Loaded"
    Unloaded="BtmBarr_Unloaded">


    <dx:DXBorder.Resources>

        <ResourceDictionary>
            <converters:DurationConverterFromMsToTimeSpan x:Key="DurationConverter" />
            <converters:BytesToMegabytesConverter x:Key="FileSizeConverter" />
            <converters:BytesArrayToImageSource x:Key="BytesToImageConverter" />
            <converters:BoolToInverseConverter x:Key="BoolToInverse" />
        </ResourceDictionary>
    </dx:DXBorder.Resources>


    <dx:DXBorder.GestureRecognizers>
        <TapGestureRecognizer x:Name="BtmBarTapGest" Tapped="BtmBarTapGest_Tapped" />
        <PanGestureRecognizer x:Name="PanGesture" PanUpdated="PanGesture_PanUpdated" />
    </dx:DXBorder.GestureRecognizers>
    <dx:DXBorder.Content>
        <StackLayout
            x:Name="BtmBarStackLayout"
            Padding="0,0"
            x:FieldModifier="Public"
            BackgroundColor="{AppThemeBinding Light=#F5F5F5,
                                              Dark=#242629}">
            <syncf:SfLinearProgressBar
                BackgroundColor="Transparent"
                Progress="{Binding CurrentTrackPositionPercentage}"
                ProgressFill="DarkSlateBlue"
                TrackFill="Transparent" />
            <Grid
                Padding="0,0"
                BackgroundColor="Transparent"
                ColumnDefinitions="auto,*"
                ColumnSpacing="5">
                <StackLayout Grid.Column="0" Orientation="Horizontal">
                    <dx:DXImage
                        Aspect="AspectFit"
                        HeightRequest="70"
                        Source="{Binding CurrentPlayingSongView.CoverImagePath}" />
                </StackLayout>
                <Grid Grid.Column="1" ColumnDefinitions="*,auto">


                    <StackLayout
                        Grid.Column="0"
                        BackgroundColor="Transparent"
                        HorizontalOptions="Start"
                        Orientation="Vertical">
                        <Label
                            FontSize="23"
                            LineBreakMode="TailTruncation"
                            Text="{Binding CurrentPlayingSongView.Title}"
                            TextColor="{Binding CurrentPlayingSongView.CurrentPlaySongDominantColor}" />
                        <Label
                            FontAttributes="Italic"
                            FontSize="14"
                            LineBreakMode="WordWrap"
                            Text="{Binding CurrentPlayingSongView.ArtistName}"
                            TextColor="{AppThemeBinding Light=Black,
                                                        Dark=White}" />
                    </StackLayout>

                    <dx:Chip
                        x:Name="DurationAndSearchChip"
                        Grid.Column="1"
                        BorderThickness="0"
                        DoubleTap="DurationAndSearchChip_LongPress"
                        LongPress="DurationAndSearchChip_LongPress"
                        Tap="DurationAndSearchChip_LongPress">
                        <dx:Chip.ContentTemplate>
                            <DataTemplate>
                                <VerticalStackLayout>
                                    <Label
                                        FontSize="16"
                                        HorizontalOptions="End"
                                        Text="{Binding CurrentTrackPositionSeconds, Converter={x:StaticResource DurationConverter}}"
                                        VerticalOptions="Center">
                                        <Label.Triggers>
                                            <DataTrigger
                                                Binding="{Binding IsPlaying}"
                                                TargetType="Label"
                                                Value="True">
                                                <Setter Property="FontAttributes" Value="Bold" />
                                                <Setter Property="TextColor" Value="{Binding CurrentPlayingSongView.CurrentPlaySongDominantColor}" />
                                            </DataTrigger>
                                            <DataTrigger
                                                Binding="{Binding IsPlaying}"
                                                TargetType="Label"
                                                Value="False">
                                                <Setter Property="FontAttributes" Value="None" />
                                                <Setter Property="TextColor" Value="{AppThemeBinding Light=Black, Dark=White}" />
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>

                                    <Label
                                        FontSize="10"
                                        HorizontalOptions="End"
                                        Text="{Binding CurrentPlayingSongView.PlayCompletedCount}" />
                                </VerticalStackLayout>
                            </DataTemplate>
                        </dx:Chip.ContentTemplate>

                    </dx:Chip>
                </Grid>
            </Grid>
        </StackLayout>
    </dx:DXBorder.Content>

</dx:DXBorder>

