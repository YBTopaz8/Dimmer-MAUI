<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="Dimmer_MAUI.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:Dimmer_MAUI"
    xmlns:viewsD="clr-namespace:Dimmer_MAUI.Views.Desktop"    
    xmlns:vm="clr-namespace:Dimmer_MAUI.ViewModels"
    x:DataType="vm:HomePageVM"         
    x:Name="myPage"
    
    Shell.FlyoutBehavior="Flyout"
    FlyoutIsPresented="{Binding IsFlyoutPresented, Mode=TwoWay}"
    xmlns:syncf="http://schemas.syncfusion.com/maui/toolkit" 
    xmlns:converters="clr-namespace:Dimmer_MAUI.Utilities.TypeConverters"
    xmlns:models="clr-namespace:Dimmer_MAUI.Utilities.Models" 
    Shell.ForegroundColor="DarkSlateBlue"
    Shell.TabBarTitleColor="White"    
    BackgroundColor="Red"
    
    Shell.TabBarUnselectedColor="Gray"
    Shell.FlyoutWidth="350"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    Shell.NavBarIsVisible="False"     
    >
    

    <!--Shell.TabBarUnselectedColor="Gray"-->

    <Shell.FlyoutHeader >
        <VerticalStackLayout VerticalOptions="End" Spacing="10" 
                                   Margin="10,0">
            <VerticalStackLayout.Resources>
                <ResourceDictionary>
                    <converters:DurationConverterFromMsToTimeSpan x:Key="DurationConverter"/>
                    <converters:BoolToInverseConverter x:Key="BoolToInverse"/>

                    <Style TargetType="Label">
                        <Setter Property="HorizontalTextAlignment" Value="Center"/>
                        <Setter Property="FontSize" Value="16"/>
                    </Style>

                    <Style TargetType="Border">
                        <Setter Property="StrokeShape" Value="RoundRectangle 20"/>
                        <Setter Property="HeightRequest" Value="50"/>
                        <Setter Property="VisualStateManager.VisualStateGroups">
                            <VisualStateGroupList>
                                <VisualStateGroup Name="CommonStates">
                                    <VisualState Name="Normal">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="Transparent"/>
                                            <Setter Property="Stroke" Value="Transparent"/>
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState Name="PointerOver">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="DarkSlateBlue"/>
                                            <Setter Property="Stroke" Value="DarkSlateBlue"/>
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateGroupList>
                        </Setter>

                    </Style>


                </ResourceDictionary>
            </VerticalStackLayout.Resources>
            <toolkit:AvatarView ImageSource="{Binding TemporarilyPickedSong.CoverImagePath}" 
                          Text="{Binding TemporarilyPickedSong.Title}" 
                          WidthRequest="245" HeightRequest="215" 
                          BorderWidth="0" CornerRadius="15">
                <toolkit:AvatarView.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding ToggleNowPlayingBtmSheetCommand}"/>
                </toolkit:AvatarView.GestureRecognizers>
                <toolkit:AvatarView.Triggers>
                    <DataTrigger TargetType="toolkit:AvatarView" Binding="{Binding CurrentQueue}" Value="0">
                        <Setter Property="StrokeThickness" Value="0"/>
                    </DataTrigger>
                    <DataTrigger TargetType="toolkit:AvatarView" Binding="{Binding CurrentQueue}" Value="1">
                        <Setter Property="StrokeThickness" Value="2"/>
                    </DataTrigger>
                </toolkit:AvatarView.Triggers>
            </toolkit:AvatarView>

            <Label Text="{Binding TemporarilyPickedSong.Title}" 
      LineBreakMode="HeadTruncation" FontSize="13"/>
            <Label Text="{Binding TemporarilyPickedSong.ArtistName}" 
      LineBreakMode="TailTruncation" Opacity="0.6" />
            <Label Text="{Binding TemporarilyPickedSong.AlbumName}" 
             LineBreakMode="HeadTruncation"/>


        </VerticalStackLayout>
    </Shell.FlyoutHeader>
    
    
    
    <Shell.FlyoutContent>

        <Grid RowDefinitions="450" x:Name="FlyoutBody"
              >
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="PlaySong_Tapped" x:Name="PlaySong" NumberOfTapsRequired="2"/>

                <PointerGestureRecognizer PointerEntered="UserHoverOnSongInColView" 
                               />

            </Grid.GestureRecognizers>
            <Grid.Resources>
                <converters:DurationConverterFromMsToTimeSpan x:Key="DurationConverter"/>

                <converters:BoolToInverseConverter x:Key="BoolToInverse"/>
                <converters:BytesToMegabytesConverter x:Key="FileSizeConverter"/>

            </Grid.Resources>

            <CollectionView ItemsSource="{Binding PartOfNowPlayingSongs}" Margin="5,5" Grid.Row="1"
                            HeightRequest="450" Header="Songs Queue" VerticalOptions="End" 
                            VerticalScrollBarVisibility="Never" RemainingItemsThreshold="15"  
                            x:Name="SongsColView" Loaded="SongsColView_Loaded">
    
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="3"/>
                </CollectionView.ItemsLayout>
    
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:SongModelView">
                        <Border>
                            <syncf:SfEffectsView ToolTipProperties.Text="{Binding Title}" TouchDown="SfEffectsView_TouchDown"
                                                 TouchDownEffects="Ripple,Selection">
                                <FlexLayout JustifyContent="SpaceBetween" Margin="10,0">
                                    <FlexLayout.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="PlaySong_Tapped" x:Name="PlaySong" NumberOfTapsRequired="2"/>

                                    </FlexLayout.GestureRecognizers>
                                    <VerticalStackLayout BackgroundColor="Transparent">
                                        <Label Text="{Binding Title}" FontSize="18"/>
                                        <Label Text="{Binding ArtistName}" FontSize="13" TextColor="Gray"/>

                                    </VerticalStackLayout>

                                    <VerticalStackLayout BackgroundColor="Transparent">
                                        <Label Text="{Binding DurationInSeconds, Converter={StaticResource DurationConverter}}"/>
                                        <Image WidthRequest="20" IsVisible="{Binding HasLyrics}" 
                                               Source="lyrics.png" >

                                        </Image>
                                    </VerticalStackLayout>
                                </FlexLayout>
                            </syncf:SfEffectsView>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

    </Grid>


    </Shell.FlyoutContent>

    
    
    
    <Shell.FlyoutFooter>
        <VerticalStackLayout VerticalOptions="End" IsVisible="True">
            <VerticalStackLayout.Resources>
                <ResourceDictionary>
                    <converters:DurationConverterFromMsToTimeSpan x:Key="DurationConverter"/>
                    <converters:BoolToInverseConverter x:Key="BoolToInverse"/>

                    <Style TargetType="Label">
                        <Setter Property="HorizontalTextAlignment" Value="Center"/>
                        <Setter Property="FontSize" Value="16"/>
                    </Style>

                    <Style TargetType="Border">
                        <Setter Property="StrokeShape" Value="RoundRectangle 20"/>
                        <Setter Property="HeightRequest" Value="50"/>
                        <Setter Property="VisualStateManager.VisualStateGroups">
                            <VisualStateGroupList>
                                <VisualStateGroup Name="CommonStates">
                                    <VisualState Name="Normal">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="Transparent"/>
                                            <Setter Property="Stroke" Value="Transparent"/>
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState Name="PointerOver">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="DarkSlateBlue"/>
                                            <Setter Property="Stroke" Value="DarkSlateBlue"/>
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateGroupList>
                        </Setter>

                    </Style>


                </ResourceDictionary>
            </VerticalStackLayout.Resources>
            <Image Source="onlinecloud.gif"  IsVisible="False"
                   HeightRequest="30" HorizontalOptions="Start"/>



            <syncf:SfTabView x:Name="tabView" IndicatorPlacement="Top"  HeightRequest="310"
                             TabBarPlacement="Bottom" ContentTransitionDuration="250">
                <syncf:SfTabView.Items>
                    <syncf:SfTabItem TextColor="White" Header="Over View">

                        <syncf:SfTabItem.Content>
                            <ScrollView>
                                
                            <VerticalStackLayout Grid.Row="0" IsVisible="True" BackgroundColor="Red"
                                 Spacing="10" Padding="10"  
                                 >
                                <VerticalStackLayout.Resources>
                                    <ResourceDictionary>

                                        <Style TargetType="syncf:SfEffectsView">
                                            <Setter Property="TouchDownEffects" Value="Ripple"/>

                                            <Setter Property="RippleBackground" Value="DarkSlateBlue"/>
                                            <Setter Property="RippleAnimationDuration" Value="350"/>

                                        </Style>

                                        <Style TargetType="Label">
                                            <Setter Property="Margin" Value="10" />
                                        </Style>

                                        <Style TargetType="Border">

                                            <Setter Property="BackgroundColor" Value="#1D1932"/>
                                            <Setter Property="Stroke" Value="Transparent"/>
                                            <Setter Property="StrokeShape" Value="RoundRectangle 8"/>
                                        </Style>
                                    </ResourceDictionary>
                                </VerticalStackLayout.Resources>

                                <FlexLayout JustifyContent="SpaceBetween" Grid.Row="1" x:Name="MultiSelectView"
    VerticalOptions="End" IsVisible="False"
    Padding="10,5">

                                    <Label Text="{Binding MultiSelectText}" VerticalTextAlignment="Center"/>

                                    <Button x:Name="DltImgBtn" HorizontalOptions="End" Text="Delete"
Command="{Binding DeleteFileCommand}"  CommandParameter="{Binding MySelectedSong}">

                                    </Button>
                                </FlexLayout>

                                <Border x:Name="GoToSong">
                                    <syncf:SfEffectsView TouchDownCommand="{Binding NavToSingleSongShellCommand}">
                                        <Label Text="Song Overview" />
                                    </syncf:SfEffectsView>
                                </Border>

                                <Border x:Name="MultiSelect">
                                    <syncf:SfEffectsView TouchUpEffects="Selection,Ripple"
                    TouchDown="MultiSelect_TouchDown">
                                        <Label Text="Toggle MultiSelection"/>
                                    </syncf:SfEffectsView>
                                </Border>

                                <Border IsVisible="False">
                                    <syncf:SfEffectsView TouchDownCommand="{Binding BindingContext.OpenRepeatSetterPopupCommand, Source={x:Reference myPage}}" >
                                        <Label Text="Set Repeat Count"/>
                                    </syncf:SfEffectsView>
                                </Border>

                                <Border>
                                    <toolkit:Expander x:Name="UtilsExp">
                                        <toolkit:Expander.Header>
                                            <syncf:SfEffectsView 
                            TouchDownEffects="Highlight" BackgroundColor="#1D1932"
                            HighlightBackground="DarkSlateBlue">

                                                <Label Text="Utilities" HorizontalOptions="Start"
                            HeightRequest="20" FontAttributes="Bold"/>
                                            </syncf:SfEffectsView>
                                        </toolkit:Expander.Header>
                                        <toolkit:Expander.Content>

                                            <VerticalStackLayout>

                                                <syncf:SfEffectsView TouchDownCommand="{Binding OpenEditSongPopupCommand}">
                                                    <Label Text="Edit Song" />
                                                </syncf:SfEffectsView>
                                                <syncf:SfEffectsView TouchDownCommand="{Binding DeleteFileCommand}"  
                                        TouchDownCommandParameter="{Binding MySelectedSong}">
                                                    <Label Text="Remove From Device"/>
                                                </syncf:SfEffectsView>
                                                <syncf:SfEffectsView TouchDownCommand="{Binding OpenSongFolderCommand}">
                                                    <Label Text="View File Explorer"/>
                                                </syncf:SfEffectsView>
                                            </VerticalStackLayout>

                                        </toolkit:Expander.Content>

                                    </toolkit:Expander>

                                </Border>

                                <Border>
                                    <toolkit:Expander>
                                        <toolkit:Expander.Header>
                                            <syncf:SfEffectsView
                            TouchDownEffects="Highlight"
                            BackgroundColor="#1D1932"
                            HighlightBackground="DarkSlateBlue">
                                                <Label Text="Search On...*" FontAttributes="Bold"/>
                                            </syncf:SfEffectsView>
                                        </toolkit:Expander.Header>
                                        <toolkit:Expander.Content>

                                            <VerticalStackLayout>

                                                <syncf:SfEffectsView TouchDownCommand="{Binding CntxtMenuSearchCommand}">
                                                    <syncf:SfEffectsView.TouchDownCommandParameter>
                                                        <x:Int32>0</x:Int32>
                                                    </syncf:SfEffectsView.TouchDownCommandParameter>
                                                    <Label Text="Google"/>
                                                </syncf:SfEffectsView>
                                                <syncf:SfEffectsView TouchDownCommand="{Binding CntxtMenuSearchCommand}">
                                                    <syncf:SfEffectsView.TouchDownCommandParameter>
                                                        <x:Int32>1</x:Int32>
                                                    </syncf:SfEffectsView.TouchDownCommandParameter>
                                                    <Label Text="YouTube"/>
                                                </syncf:SfEffectsView>
                                                <syncf:SfEffectsView TouchDownCommand="{Binding CntxtMenuSearchCommand}">
                                                    <syncf:SfEffectsView.TouchDownCommandParameter>
                                                        <x:Int32>2</x:Int32>
                                                    </syncf:SfEffectsView.TouchDownCommandParameter>
                                                    <Label Text="Spotify"/>
                                                </syncf:SfEffectsView>
                                            </VerticalStackLayout>

                                        </toolkit:Expander.Content>

                                    </toolkit:Expander>

                                </Border>
                                <Border>
                                    <syncf:SfEffectsView >
                                        <Label Text="Add To Playlist"/>
                                    </syncf:SfEffectsView>
                                </Border>

                            </VerticalStackLayout>

                            </ScrollView>

                        </syncf:SfTabItem.Content>
                    </syncf:SfTabItem>
                    
                    <syncf:SfTabItem Header="Lyrics">
                        <syncf:SfTabItem.Content>
                            <Grid>
                                <CollectionView x:Name="LyricsColView" IsVisible="True" HeightRequest="500"
    
ItemsSource="{Binding MySelectedSong.SyncLyrics}" 
SelectionMode="Single" SelectedItem="{Binding CurrentLyricPhrase}"
EmptyView="No Syncronized Lyrics ..." >
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="models:LyricPhraseModel">

                                            <Label Text="{Binding Text}" FontSize="{Binding NowPlayingLyricsFontSize}" />



                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>

                            </Grid>
                          
                        </syncf:SfTabItem.Content>
                    </syncf:SfTabItem>

                    
                </syncf:SfTabView.Items>
            </syncf:SfTabView>
         
            

        </VerticalStackLayout>
        
        
    </Shell.FlyoutFooter>
    
    <FlyoutItem FlyoutDisplayOptions="AsSingleItem" x:Name="shelltabbar" >
        
        <Tab Title="Home" x:Name="homeTab" Icon="house.png">
            
            <ShellContent
                ContentTemplate="{DataTemplate viewsD:MainPageD}">
                
            </ShellContent>
        </Tab>

        <Tab Title="Artists" x:Name="ArtistTab" Icon="lyricist.png">
            <ShellContent ContentTemplate="{DataTemplate viewsD:ArtistsPageD}"/>
        </Tab>
        <Tab Title="Albums" x:Name="albumTab" Icon="musicalbum.png">
            <ShellContent ContentTemplate="{DataTemplate viewsD:AlbumsPageD}"/>
        </Tab>

        <Tab Title="Playlists" x:Name="playlistsTab" Icon="playlist.png">
            <ShellContent 
                ContentTemplate="{DataTemplate viewsD:PlaylistsPageD}"
                Route="PlaylistsPageD"/>
            
        </Tab>
        <Tab Title="Stats" x:Name="statsTab" Icon="chart.png">
            <ShellContent ContentTemplate="{DataTemplate viewsD:FullStatsPageD}"
                Route="FullStatsD"/>
        </Tab>
        <Tab Title="Settings" x:Name="settingsTab" Icon="settings.png">
            <ShellContent ContentTemplate="{DataTemplate viewsD:SettingsPageD}"
                Route="SettingsPageD"/>
        </Tab>

        <!--<Tab>
            <ShellContent Title="Exit"/>
        </Tab>-->
    </FlyoutItem>

</Shell>
